<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manage Teachers - Hillview School</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <style>
      .action-buttons {
        display: flex;
        gap: 5px;
      }
      .edit-btn {
        display: inline-block;
        padding: 5px 10px;
        background-color: #4a6741;
        color: white;
        text-decoration: none;
        border-radius: 3px;
        font-size: 0.8rem;
      }
      .edit-btn:hover {
        background-color: #3a5331;
      }
      .delete-btn {
        padding: 5px 10px;
        background-color: #dc3545;
        color: white;
        border: none;
        border-radius: 3px;
        cursor: pointer;
        font-size: 0.8rem;
      }
      .delete-btn:hover {
        background-color: #c82333;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="manage-container">
        <header class="page-header">
          <h1>Manage Teachers</h1>
          <div class="nav-links">
            <a href="{{ url_for('classteacher.dashboard') }}"
              >Back to Dashboard</a
            >
            |
            <a href="{{ url_for('auth.logout_route') }}">Logout</a>
          </div>
        </header>

        <!-- Message container for notifications -->
        <div id="message-container">
          {% if error_message %}
          <div class="message message-error">{{ error_message }}</div>
          {% endif %} {% if success_message %}
          <div class="message message-success">{{ success_message }}</div>
          {% endif %}
        </div>

        <div class="manage-section">
          <h2>Add New Teacher</h2>
          <form
            method="POST"
            action="{{ url_for('classteacher.manage_teachers') }}"
          >
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <div class="form-group">
              <label for="username">Username:</label>
              <input
                type="text"
                id="username"
                name="username"
                required
                class="form-control"
              />
            </div>
            <div class="form-group">
              <label for="password">Password:</label>
              <input
                type="password"
                id="password"
                name="password"
                required
                class="form-control"
              />
            </div>
            <div class="form-group">
              <label for="role">Role:</label>
              <select id="role" name="role" required class="form-control">
                <option value="teacher">Teacher</option>
                <option value="classteacher">Class Teacher</option>
              </select>
            </div>
            <button type="submit" name="add_teacher" class="btn btn-primary">
              Add Teacher
            </button>
          </form>
        </div>

        <div class="manage-section">
          <h2>Existing Teachers</h2>
          <table class="data-table">
            <thead>
              <tr>
                <th>Username</th>
                <th>Role</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for teacher in teachers %}
              <tr>
                <td>{{ teacher.username }}</td>
                <td>{{ teacher.role|title }}</td>
                <td>
                  <form
                    method="POST"
                    action="{{ url_for('classteacher.manage_teachers') }}"
                    style="display: inline"
                  >
                    <input
                      type="hidden"
                      name="csrf_token"
                      value="{{ csrf_token() }}"
                    />
                    <input
                      type="hidden"
                      name="teacher_id"
                      value="{{ teacher.id }}"
                    />
                    <button
                      type="submit"
                      name="delete_teacher"
                      class="delete-btn"
                      onclick="return confirm('Are you sure you want to delete this teacher? This will also remove all their assignments.')"
                    >
                      Delete
                    </button>
                  </form>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="manage-section">
          <h2>Class Teacher Assignments</h2>
          <table class="data-table">
            <thead>
              <tr>
                <th>Teacher</th>
                <th>Grade</th>
                <th>Stream</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for assignment in class_teacher_assignments %}
              <tr>
                <td>
                  {% if assignment is mapping %} {{ assignment.teacher_username
                  }} {% else %} {{ assignment.teacher.username }} {% endif %}
                </td>
                <td>
                  {% if assignment is mapping %} {{ assignment.grade_level }} {%
                  else %} {{ assignment.grade.level }} {% endif %}
                </td>
                <td>
                  {% if assignment is mapping %} {{ assignment.stream_name if
                  assignment.stream_name else 'All Streams' }} {% else %} {{
                  assignment.stream.name if assignment.stream else 'All Streams'
                  }} {% endif %}
                </td>
                <td>
                  <div class="action-buttons">
                    <form
                      method="POST"
                      action="{{ url_for('classteacher.manage_teachers') }}"
                      style="display: inline"
                    >
                      <input
                        type="hidden"
                        name="csrf_token"
                        value="{{ csrf_token() }}"
                      />
                      <input
                        type="hidden"
                        name="assignment_id"
                        value="{% if assignment is mapping %}{{ assignment.id }}{% else %}{{ assignment.id }}{% endif %}"
                      />
                      <input
                        type="hidden"
                        name="assignment_type"
                        value="class_teacher"
                      />
                      <button
                        type="submit"
                        name="delete_assignment"
                        class="delete-btn"
                        onclick="return confirm('Are you sure you want to remove this class teacher assignment?')"
                      >
                        Delete
                      </button>
                    </form>
                    <a
                      href="{{ url_for('bulk_assignments.edit_assignment', assignment_id=assignment.id if assignment is not mapping else assignment.id, assignment_type='class_teacher') }}"
                      class="edit-btn"
                    >
                      Edit
                    </a>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="manage-section">
          <h2>Subject Assignments</h2>
          <table class="data-table">
            <thead>
              <tr>
                <th>Teacher</th>
                <th>Subject</th>
                <th>Education Level</th>
                <th>Grade</th>
                <th>Stream</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              {% for assignment in subject_assignments %}
              <tr>
                <td>
                  {% if assignment is mapping %} {{ assignment.teacher_username
                  }} {% else %} {{ assignment.teacher.username }} {% endif %}
                </td>
                <td>
                  {% if assignment is mapping %} {{ assignment.subject_name }}
                  {% else %} {{ assignment.subject.name }} {% endif %}
                </td>
                <td>
                  {% if assignment is mapping %} {{
                  assignment.education_level|replace('_', ' ')|title if
                  assignment.education_level else 'N/A' }} {% else %} {{
                  assignment.subject.education_level|replace('_', ' ')|title if
                  assignment.subject.education_level else 'N/A' }} {% endif %}
                </td>
                <td>
                  {% if assignment is mapping %} {{ assignment.grade_level }} {%
                  else %} {{ assignment.grade.level }} {% endif %}
                </td>
                <td>
                  {% if assignment is mapping %} {{ assignment.stream_name if
                  assignment.stream_name else 'All Streams' }} {% else %} {{
                  assignment.stream.name if assignment.stream else 'All Streams'
                  }} {% endif %}
                </td>
                <td>
                  <div class="action-buttons">
                    <form
                      method="POST"
                      action="{{ url_for('classteacher.manage_teachers') }}"
                      style="display: inline"
                    >
                      <input
                        type="hidden"
                        name="csrf_token"
                        value="{{ csrf_token() }}"
                      />
                      <input
                        type="hidden"
                        name="assignment_id"
                        value="{% if assignment is mapping %}{{ assignment.id }}{% else %}{{ assignment.id }}{% endif %}"
                      />
                      <input
                        type="hidden"
                        name="assignment_type"
                        value="subject"
                      />
                      <button
                        type="submit"
                        name="delete_assignment"
                        class="delete-btn"
                        onclick="return confirm('Are you sure you want to remove this subject assignment?')"
                      >
                        Delete
                      </button>
                    </form>
                    <a
                      href="{{ url_for('bulk_assignments.edit_assignment', assignment_id=assignment.id if assignment is not mapping else assignment.id, assignment_type='subject') }}"
                      class="edit-btn"
                    >
                      Edit
                    </a>
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <div class="manage-section">
          <h2>Assign Subjects to Teachers</h2>
          <p>
            Use the
            <a href="{{ url_for('bulk_assignments.bulk_assignments') }}"
              >Teacher Assignments</a
            >
            page to assign subjects to teachers.
          </p>
        </div>
      </div>
    </div>

    <script>
      // Auto-hide messages after 5 seconds
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(function () {
          const messages = document.querySelectorAll(".message");
          messages.forEach((message) => {
            message.style.display = "none";
          });
        }, 5000);
      });
    </script>
  </body>
</html>
