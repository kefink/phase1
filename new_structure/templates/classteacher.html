<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="csrf-token" content="{{ csrf_token() }}" />
    <title>
      Class Teacher Dashboard - {{ school_info.school_name|default('Hillview
      School') }}
    </title>

    <!-- Essential Resources Only -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Solar Theme CSS -->
    <style>
      :root {
        /* Solar Theme Colors */
        --primary-color: #268bd2;
        --secondary-color: #2aa198;
        --success-color: #859900;
        --warning-color: #b58900;
        --danger-color: #dc322f;
        --info-color: #6c71c4;

        /* Solar Background Colors */
        --bg-color: #002b36;
        --bg-secondary: #073642;
        --card-bg: #073642;
        --card-hover: #0e4a58;

        /* Solar Text Colors */
        --text-primary: #839496;
        --text-secondary: #586e75;
        --text-bright: #93a1a1;
        --text-emphasis: #eee8d5;

        /* Solar Accent Colors */
        --orange: #cb4b16;
        --red: #dc322f;
        --magenta: #d33682;
        --violet: #6c71c4;
        --blue: #268bd2;
        --cyan: #2aa198;
        --green: #859900;

        /* UI Elements */
        --border-color: #0e4a58;
        --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4),
          0 2px 4px -1px rgba(0, 0, 0, 0.25);
        --radius: 0.5rem;
        --glass-border: rgba(147, 161, 161, 0.1);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background: var(--bg-color);
        color: var(--text-primary);
        line-height: 1.6;
        min-height: 100vh;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
      }

      .header {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        padding: 1.5rem;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        margin-bottom: 2rem;
      }

      .header h1 {
        font-size: 1.875rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
        color: var(--text-emphasis);
      }

      .header p {
        color: var(--text-secondary);
      }

      .alert {
        padding: 1rem;
        border-radius: var(--radius);
        margin-bottom: 1rem;
        border-left: 4px solid;
        background: var(--card-bg);
        border: 1px solid var(--border-color);
      }

      .alert-success {
        background: rgba(133, 153, 0, 0.1);
        color: var(--green);
        border-left-color: var(--green);
      }

      .alert-info {
        background: rgba(38, 139, 210, 0.1);
        color: var(--blue);
        border-left-color: var(--blue);
      }

      .alert-warning {
        background: rgba(181, 137, 0, 0.1);
        color: var(--orange);
        border-left-color: var(--orange);
      }

      .alert-danger {
        background: rgba(220, 50, 47, 0.1);
        color: var(--red);
        border-left-color: var(--red);
      }

      .actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
      }

      .action-card {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        padding: 2rem;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        text-decoration: none;
        color: var(--text-bright);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
      }

      .action-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          135deg,
          rgba(147, 161, 161, 0.05) 0%,
          rgba(88, 110, 117, 0.05) 100%
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .action-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        background: var(--card-hover);
        text-decoration: none;
        color: var(--text-bright);
        border-color: var(--primary-color);
      }

      .action-card:hover::before {
        opacity: 1;
      }

      .action-card.primary {
        background: linear-gradient(
          135deg,
          var(--primary-color) 0%,
          var(--cyan) 100%
        );
        color: var(--text-emphasis);
        border-color: var(--primary-color);
      }

      .action-card.primary:hover {
        color: var(--text-emphasis);
        background: linear-gradient(135deg, #1e6ba8 0%, #238e86 100%);
      }

      .action-icon {
        font-size: 2.5rem;
        margin-bottom: 1rem;
        display: block;
        color: inherit;
      }

      .action-card h3 {
        font-size: 1.25rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .action-card p {
        color: var(--text-secondary);
        font-size: 0.875rem;
      }

      .action-card.primary p {
        color: rgba(238, 232, 213, 0.9);
      }

      .stats-overview {
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        padding: 1.5rem;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        margin-bottom: 2rem;
      }

      .stats-overview h3 {
        color: var(--text-emphasis);
        margin-bottom: 1rem;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1.5rem;
      }

      .stat-item {
        text-align: center;
        padding: 1.5rem;
        background: linear-gradient(
          135deg,
          rgba(147, 161, 161, 0.03),
          rgba(38, 139, 210, 0.05)
        );
        border-radius: var(--radius);
        border: 1px solid var(--glass-border);
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0, 43, 54, 0.1);
      }

      .stat-item:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 25px rgba(38, 139, 210, 0.15);
        border-color: var(--primary-color);
        background: linear-gradient(
          135deg,
          rgba(147, 161, 161, 0.05),
          rgba(38, 139, 210, 0.1)
        );
      }

      .stat-icon {
        font-size: 2rem;
        margin-bottom: 0.75rem;
        display: block;
        opacity: 0.8;
      }

      .stat-value {
        font-size: 2.5rem;
        font-weight: 700;
        color: var(--cyan);
        margin-bottom: 0.5rem;
        text-shadow: 0 0 10px rgba(42, 161, 152, 0.3);
        line-height: 1;
      }

      .stat-label {
        color: var(--text-secondary);
        font-size: 0.875rem;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Enhanced Subjects Container */
      .subjects-stat {
        position: relative;
        overflow: visible;
      }

      .subjects-container {
        margin-top: 0.75rem;
        max-height: 200px;
        position: relative;
      }

      .subjects-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 0.5rem;
        max-height: 140px;
        overflow-y: auto;
        padding-right: 4px;
        transition: max-height 0.3s ease;
      }

      .subjects-grid.expanded {
        max-height: 300px;
      }

      /* Custom Scrollbar */
      .subjects-grid::-webkit-scrollbar {
        width: 6px;
      }

      .subjects-grid::-webkit-scrollbar-track {
        background: rgba(147, 161, 161, 0.1);
        border-radius: 3px;
      }

      .subjects-grid::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, var(--primary-color), var(--cyan));
        border-radius: 3px;
        transition: background 0.3s ease;
      }

      .subjects-grid::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(180deg, var(--cyan), var(--primary-color));
      }

      /* Subject Tags */
      .subject-tag {
        background: linear-gradient(135deg, 
          rgba(38, 139, 210, 0.1), 
          rgba(42, 161, 152, 0.1));
        border: 1px solid rgba(38, 139, 210, 0.2);
        border-radius: 8px;
        padding: 0.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        min-height: 50px;
        display: flex;
        flex-direction: column;
        justify-content: center;
      }

      .subject-tag::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, 
          transparent, 
          rgba(38, 139, 210, 0.1), 
          transparent);
        transition: left 0.5s ease;
      }

      .subject-tag:hover::before {
        left: 100%;
      }

      .subject-tag:hover {
        transform: translateY(-2px);
        border-color: var(--primary-color);
        background: linear-gradient(135deg, 
          rgba(38, 139, 210, 0.15), 
          rgba(42, 161, 152, 0.15));
        box-shadow: 0 4px 12px rgba(38, 139, 210, 0.2);
      }

      .subject-name {
        font-size: 0.75rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
        line-height: 1.2;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .subject-grade {
        font-size: 0.65rem;
        color: var(--text-secondary);
        opacity: 0.8;
        font-weight: 500;
      }

      .stream {
        background: var(--primary-color);
        color: white;
        padding: 1px 4px;
        border-radius: 4px;
        margin-left: 0.25rem;
        font-size: 0.6rem;
        font-weight: 600;
      }

      /* Toggle Button */
      .subjects-toggle {
        text-align: center;
        margin-top: 0.5rem;
        padding-top: 0.5rem;
        border-top: 1px solid rgba(147, 161, 161, 0.2);
      }

      .toggle-btn {
        background: linear-gradient(135deg, var(--primary-color), var(--cyan));
        color: white;
        border: none;
        padding: 0.4rem 0.8rem;
        border-radius: 20px;
        font-size: 0.7rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.3rem;
        margin: 0 auto;
        min-width: 80px;
        justify-content: center;
      }

      .toggle-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(38, 139, 210, 0.3);
      }

      .toggle-icon {
        transition: transform 0.3s ease;
        font-size: 0.6rem;
      }

      .toggle-btn.expanded .toggle-icon {
        transform: rotate(180deg);
      }

      /* Students Styling */
      .students-stat {
        overflow: visible;
      }

      .students-container {
        margin-top: 0.75rem;
        max-width: 100%;
      }

      .students-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 0.4rem;
        max-height: 240px;
        overflow-y: auto;
        padding: 0.5rem;
        border-top: 1px solid rgba(147, 161, 161, 0.2);
        background: rgba(0, 43, 54, 0.02);
        border-radius: 8px;
        scrollbar-width: thin;
        scrollbar-color: rgba(38, 139, 210, 0.3) transparent;
      }

      .students-grid::-webkit-scrollbar {
        width: 6px;
      }

      .students-grid::-webkit-scrollbar-track {
        background: transparent;
      }

      .students-grid::-webkit-scrollbar-thumb {
        background: rgba(38, 139, 210, 0.3);
        border-radius: 3px;
      }

      .students-grid::-webkit-scrollbar-thumb:hover {
        background: rgba(38, 139, 210, 0.5);
      }

      .student-card {
        background: linear-gradient(135deg, 
          rgba(238, 232, 213, 0.1), 
          rgba(147, 161, 161, 0.05));
        border: 1px solid rgba(147, 161, 161, 0.2);
        border-radius: 6px;
        padding: 0.5rem;
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
        overflow: hidden;
      }

      .student-card:hover {
        transform: translateY(-2px);
        border-color: var(--green);
        background: linear-gradient(135deg, 
          rgba(133, 153, 0, 0.1), 
          rgba(181, 137, 0, 0.1));
        box-shadow: 0 4px 12px rgba(133, 153, 0, 0.2);
      }

      .student-name {
        font-size: 0.72rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 0.25rem;
        line-height: 1.2;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .student-details {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.6rem;
        color: var(--text-secondary);
        gap: 0.25rem;
      }

      .student-admission {
        font-family: 'Courier New', monospace;
        background: rgba(42, 161, 152, 0.1);
        padding: 1px 4px;
        border-radius: 3px;
        font-weight: 500;
      }

      .student-class {
        background: rgba(38, 139, 210, 0.1);
        padding: 1px 4px;
        border-radius: 3px;
        font-weight: 500;
        white-space: nowrap;
      }

      .students-toggle {
        background: linear-gradient(135deg, var(--green), var(--yellow));
        color: var(--base03);
        border: none;
        padding: 0.4rem 0.8rem;
        border-radius: 20px;
        font-size: 0.7rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 0.3rem;
        margin: 0.5rem auto 0;
        min-width: 100px;
        justify-content: center;
      }

      .students-toggle:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(133, 153, 0, 0.3);
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .subjects-grid {
          grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
          gap: 0.4rem;
          max-height: 120px;
        }

        .subject-tag {
          padding: 0.4rem;
          min-height: 45px;
        }

        .subject-name {
          font-size: 0.7rem;
        }

        .subject-grade {
          font-size: 0.6rem;
        }
      }

      @media (max-width: 480px) {
        .subjects-grid {
          grid-template-columns: 1fr 1fr;
          gap: 0.3rem;
        }

        .subject-tag {
          padding: 0.3rem;
          min-height: 40px;
        }
      }

      .notice {
        background: rgba(181, 137, 0, 0.1);
        border: 1px solid var(--warning-color);
        color: var(--warning-color);
        padding: 1rem;
        border-radius: var(--radius);
        margin-bottom: 2rem;
      }

      @media (max-width: 768px) {
        .container {
          padding: 1rem;
        }

        .actions-grid {
          grid-template-columns: 1fr;
        }

        .action-card {
          padding: 1.5rem;
        }

        .header h1 {
          font-size: 1.5rem;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <!-- Error Messages -->
      {% if error_message %}
      <div class="alert alert-danger">
        <strong><i class="fas fa-exclamation-triangle"></i> Error:</strong> {{
        error_message|safe }}
      </div>
      {% endif %} {% if confirmation_message %}
      <div class="alert alert-success">
        <strong><i class="fas fa-check-circle"></i> Success:</strong> {{
        confirmation_message|safe }}
      </div>
      {% endif %}

      <!-- Flask Flash Messages -->
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %}
      <div
        class="alert {% if category == 'error' %}alert-danger{% elif category == 'success' %}alert-success{% elif category == 'warning' %}alert-warning{% else %}alert-info{% endif %}"
      >
        <strong>
          {% if category == 'error' %}<i
            class="fas fa-exclamation-triangle"
          ></i>
          Error: {% elif category == 'success' %}<i
            class="fas fa-check-circle"
          ></i>
          Success: {% elif category == 'warning' %}<i
            class="fas fa-exclamation-circle"
          ></i>
          Warning: {% else %}<i class="fas fa-info-circle"></i> Info: {% endif
          %}
        </strong>
        {{ message }}
      </div>
      {% endfor %} {% endif %} {% endwith %}

      <!-- Teacher Assignment Status -->
      {% if not has_assignments %}
      <div class="alert alert-info">
        <strong><i class="fas fa-info-circle"></i> Note:</strong> You are not
        currently assigned to any class stream. You can still manage students
        and view reports for all grades and streams.
      </div>
      {% elif stream %}
      <div class="alert alert-success">
        <i class="fas fa-check-circle"></i>
        <strong>Assigned Class:</strong> Grade {{ grade }} {{ stream }}
      </div>
      {% endif %}

      <!-- Header -->
      <div class="header">
        <h1>Class Teacher Dashboard</h1>
        <p>Welcome back! Choose an action to get started.</p>
      </div>

      <!-- Quick Stats -->
      <div class="stats-overview">
        <h3
          style="
            margin-bottom: 1rem;
            color: var(--text-primary);
            font-weight: 600;
          "
        >
          üìä Quick Overview
        </h3>
        <div class="stats-grid">
          <div class="stat-item students-stat">
            <div class="stat-icon">üë•</div>
            <div class="stat-value">
              {% if my_students %} {{ my_students|length }} {% elif
              class_teacher_assignments %} {% set student_count = 0 %} {% for
              assignment in class_teacher_assignments %} {% set student_count =
              student_count + (assignment.estimated_students or 25) %} {% endfor
              %} {{ student_count }} {% else %} {{ total_students or 0 }} {%
              endif %}
            </div>
            <div class="stat-label">My Students</div>
            {% if my_students %}
            <div class="students-container">
              <div class="students-grid" id="students-grid">
                {% for student in my_students[:12] %}
                <div class="student-card">
                  <div class="student-name">{{ student.first_name }} {{ student.last_name }}</div>
                  <div class="student-details">
                    <span class="student-admission">{{ student.admission_number }}</span>
                    <span class="student-class">{{ student.grade_level }}{{ ' ' + student.stream_name if student.stream_name }}</span>
                  </div>
                </div>
                {% endfor %}
              </div>
              {% if my_students|length > 12 %}
              <div class="students-toggle" onclick="toggleStudents()">
                <span id="students-toggle-text">Show {{ my_students|length - 12 }} More Students</span>
                <span class="toggle-icon" id="students-toggle-icon">‚ñº</span>
              </div>
              <div class="students-grid hidden" id="students-grid-more">
                {% for student in my_students[12:] %}
                <div class="student-card">
                  <div class="student-name">{{ student.first_name }} {{ student.last_name }}</div>
                  <div class="student-details">
                    <span class="student-admission">{{ student.admission_number }}</span>
                    <span class="student-class">{{ student.grade_level }}{{ ' ' + student.stream_name if student.stream_name }}</span>
                  </div>
                </div>
                {% endfor %}
              </div>
              {% endif %}
            </div>
            {% endif %}
          </div>
          <div class="stat-item subjects-stat">
            <div class="stat-icon">üìö</div>
            <div class="stat-value">
              {% if subject_assignments %} {{ subject_assignments|length }} {%
              elif class_teacher_assignments %} {{
              class_teacher_assignments|length }} {% else %} 0 {% endif %}
            </div>
            <div class="stat-label">Subjects Taught</div>
            {% if subject_assignments %}
            <div class="subjects-container">
              <div class="subjects-grid" data-total="{{ subject_assignments|length }}">
                {% for assignment in subject_assignments %}
                  <div class="subject-tag" title="{{ assignment.subject_name }} - {{ assignment.grade_level }}{% if assignment.stream_name %} {{ assignment.stream_name }}{% endif %}">
                    <div class="subject-name">{{ assignment.subject_name }}</div>
                    <div class="subject-grade">{{ assignment.grade_level }}{% if assignment.stream_name %}<span class="stream">{{ assignment.stream_name }}</span>{% endif %}</div>
                  </div>
                {% endfor %}
              </div>
              {% if subject_assignments|length > 6 %}
              <div class="subjects-toggle">
                <button class="toggle-btn" onclick="toggleSubjects(this)">
                  <span class="toggle-text">Show All</span>
                  <span class="toggle-icon">‚ñº</span>
                </button>
              </div>
              {% endif %}
            </div>
            {% endif %}
          </div>
          <div class="stat-item">
            <div class="stat-icon">üè´</div>
            <div class="stat-value">
              {{ class_teacher_assignments|length if class_teacher_assignments
              else 0 }}
            </div>
            <div class="stat-label">Class Assignments</div>
          </div>
          <div class="stat-item">
            <div class="stat-icon">üìä</div>
            <div class="stat-value">
              {{ recent_reports|length if recent_reports else 0 }}
            </div>
            <div class="stat-label">Recent Reports</div>
          </div>
        </div>
      </div>

      <!-- Notice for New Implementation -->
      <div class="notice">
        <div style="display: flex; align-items: center; gap: 0.5rem">
          <span style="font-size: 1.2rem">üåü</span>
          <strong>Enhanced Dashboard:</strong> This streamlined dashboard
          focuses on your core teaching responsibilities with improved
          navigation and real-time data display.
        </div>
      </div>

      <!-- Main Actions -->
      <div class="actions-grid">
        <a
          href="{{ url_for('classteacher.class_overview') }}"
          class="action-card primary"
        >
          <i class="fas fa-tachometer-alt action-icon"></i>
          <h3>Class Overview</h3>
          <p>View all subjects and upload status for your classes</p>
        </a>

        <a
          href="{{ url_for('classteacher.upload_marks') }}"
          class="action-card"
        >
          <i class="fas fa-upload action-icon"></i>
          <h3>Upload Marks</h3>
          <p>Add student marks for tests and assignments</p>
        </a>

        <a href="{{ url_for('classteacher.all_reports') }}" class="action-card">
          <i class="fas fa-chart-line action-icon"></i>
          <h3>View Reports</h3>
          <p>Browse existing reports and performance data</p>
        </a>

        <a
          href="{{ url_for('classteacher.dashboard') }}#generate-section"
          class="action-card"
        >
          <i class="fas fa-file-pdf action-icon"></i>
          <h3>Generate Reports</h3>
          <p>Create marksheets and performance reports</p>
        </a>

        <a
          href="{{ url_for('classteacher.manage_students') }}"
          class="action-card"
        >
          <i class="fas fa-users action-icon"></i>
          <h3>Manage Students</h3>
          <p>View and manage student information</p>
        </a>

        <a
          href="{{ url_for('classteacher.analytics_dashboard') }}"
          class="action-card"
        >
          <i class="fas fa-analytics action-icon"></i>
          <h3>Analytics</h3>
          <p>View detailed performance analytics</p>
        </a>

        <a
          href="{{ url_for('classteacher.dashboard') }}#settings-section"
          class="action-card"
        >
          <i class="fas fa-cogs action-icon"></i>
          <h3>Settings</h3>
          <p>Configure grades, subjects, and preferences</p>
        </a>
      </div>

      <!-- Quick Actions Footer -->
      <div
        style="
          text-align: center;
          margin-top: 3rem;
          padding: 1.5rem;
          background: rgba(147, 161, 161, 0.02);
          border-radius: var(--radius);
          border-top: 2px solid var(--primary-color);
          color: var(--text-secondary);
        "
      >
        <p style="margin-bottom: 0.5rem; font-weight: 500">
          üìö Class Teacher Portal ‚Ä¢ Solar Theme
        </p>
        <p style="font-size: 0.9rem">
          Need help?
          <a
            href="#"
            style="
              color: var(--primary-color);
              text-decoration: none;
              font-weight: 500;
            "
            >üìû Contact Support</a
          >
          |
          <a
            href="#"
            style="
              color: var(--primary-color);
              text-decoration: none;
              font-weight: 500;
            "
            >üìñ User Guide</a
          >
          |
          <a
            href="{{ url_for('auth.logout_route') }}"
            style="color: var(--red); text-decoration: none; font-weight: 500"
            >üö™ Logout</a
          >
        </p>
      </div>

      <!-- Upload Section (hidden by default) -->
      <div id="upload-section" style="display: none; margin-top: 2rem">
        <div
          style="
            background: var(--card-bg);
            padding: 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
          "
        >
          <h3 style="margin-bottom: 1rem">Quick Upload Access</h3>
          <p style="color: var(--text-secondary); margin-bottom: 1.5rem">
            Choose your upload method or access template downloads.
          </p>
          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
              gap: 1rem;
            "
          >
            <a
              href="{{ url_for('classteacher.download_marks_template') }}"
              style="
                padding: 1rem;
                background: var(--primary-color);
                color: white;
                text-decoration: none;
                border-radius: var(--radius);
                text-align: center;
              "
            >
              <i class="fas fa-download"></i><br />
              Download Template
            </a>
            <a
              href="{{ url_for('classteacher.download_student_template') }}"
              style="
                padding: 1rem;
                background: var(--success-color);
                color: white;
                text-decoration: none;
                border-radius: var(--radius);
                text-align: center;
              "
            >
              <i class="fas fa-users"></i><br />
              Student Template
            </a>
            <a
              href="{{ url_for('classteacher.download_subject_template') }}"
              style="
                padding: 1rem;
                background: var(--warning-color);
                color: white;
                text-decoration: none;
                border-radius: var(--radius);
                text-align: center;
              "
            >
              <i class="fas fa-book"></i><br />
              Subject Template
            </a>
          </div>
        </div>
      </div>

      <!-- Generate Section (hidden by default) -->
      <div id="generate-section" style="display: none; margin-top: 2rem">
        <div
          style="
            background: var(--card-bg);
            padding: 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
          "
        >
          <h3 style="margin-bottom: 1rem">Quick Generate Access</h3>
          <p style="color: var(--text-secondary); margin-bottom: 1.5rem">
            Generate reports and marksheets for different terms and grades.
          </p>
          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
              gap: 1rem;
            "
          >
            <a
              href="{{ url_for('classteacher.dashboard') }}"
              onclick="alert('Please use the main dashboard to access grade marksheet generation with proper parameters.'); return false;"
              style="
                padding: 1rem;
                background: var(--primary-color);
                color: white;
                text-decoration: none;
                border-radius: var(--radius);
                text-align: center;
              "
            >
              <i class="fas fa-file-pdf"></i><br />
              Grade Marksheet
            </a>
            <a
              href="{{ url_for('classteacher.download_class_list') }}"
              style="
                padding: 1rem;
                background: var(--success-color);
                color: white;
                text-decoration: none;
                border-radius: var(--radius);
                text-align: center;
              "
            >
              <i class="fas fa-list"></i><br />
              Class List
            </a>
          </div>
        </div>
      </div>

      <!-- Settings Section (hidden by default) -->
      <div id="settings-section" style="display: none; margin-top: 2rem">
        <div
          style="
            background: var(--card-bg);
            padding: 2rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
          "
        >
          <h3 style="margin-bottom: 1rem">Quick Settings</h3>
          <p style="color: var(--text-secondary); margin-bottom: 1.5rem">
            Access system configuration and preferences.
          </p>
          <div
            style="
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
              gap: 1rem;
            "
          >
            <a
              href="{{ url_for('classteacher.clear_cache') }}"
              style="
                padding: 1rem;
                background: var(--warning-color);
                color: white;
                text-decoration: none;
                border-radius: var(--radius);
                text-align: center;
              "
            >
              <i class="fas fa-sync"></i><br />
              Clear Cache
            </a>
            <!-- Debug link removed - route doesn't exist -->
          </div>
        </div>
      </div>
    </div>

    <!-- Enhanced JavaScript -->
    <script>
      // Toggle subjects display function
      function toggleSubjects(button) {
        const container = button.closest('.subjects-container');
        const grid = container.querySelector('.subjects-grid');
        const toggleText = button.querySelector('.toggle-text');
        const toggleIcon = button.querySelector('.toggle-icon');
        
        if (button.classList.contains('expanded')) {
          // Collapse
          grid.classList.remove('expanded');
          button.classList.remove('expanded');
          toggleText.textContent = 'Show All';
          toggleIcon.style.transform = 'rotate(0deg)';
        } else {
          // Expand
          grid.classList.add('expanded');
          button.classList.add('expanded');
          toggleText.textContent = 'Show Less';
          toggleIcon.style.transform = 'rotate(180deg)';
        }
      }

      // Toggle students display function
      function toggleStudents() {
        const moreGrid = document.getElementById('students-grid-more');
        const toggleText = document.getElementById('students-toggle-text');
        const toggleIcon = document.getElementById('students-toggle-icon');
        
        if (moreGrid.classList.contains('hidden')) {
          // Show more students
          moreGrid.classList.remove('hidden');
          toggleText.textContent = 'Show Less';
          toggleIcon.style.transform = 'rotate(180deg)';
        } else {
          // Hide extra students
          moreGrid.classList.add('hidden');
          const totalStudents = {{ my_students|length if my_students else 0 }};
          const extraCount = totalStudents - 12;
          toggleText.textContent = `Show ${extraCount} More Students`;
          toggleIcon.style.transform = 'rotate(0deg)';
        }
      }

      document.addEventListener("DOMContentLoaded", function () {
        console.log("Simplified Class Teacher Dashboard loaded");

        // Add click analytics and handle section toggling
        document.querySelectorAll(".action-card").forEach((card) => {
          card.addEventListener("click", function (e) {
            const action = this.querySelector("h3").textContent;
            console.log("User clicked:", action);

            // Handle anchor links for sections
            const href = this.getAttribute("href");
            if (href && href.includes("#")) {
              e.preventDefault();
              const sectionId = href.split("#")[1];
              toggleSection(sectionId);
            }
          });
        });

        // Handle browser navigation to sections
        if (window.location.hash) {
          const sectionId = window.location.hash.substring(1);
          toggleSection(sectionId);
        }
      });

      function toggleSection(sectionId) {
        // Hide all sections first
        const sections = [
          "upload-section",
          "generate-section",
          "settings-section",
        ];
        sections.forEach((id) => {
          const element = document.getElementById(id);
          if (element) {
            element.style.display = "none";
          }
        });

        // Show the requested section
        const targetSection = document.getElementById(sectionId);
        if (targetSection) {
          targetSection.style.display = "block";
          targetSection.scrollIntoView({ behavior: "smooth" });

          // Update URL hash
          history.pushState(null, null, "#" + sectionId);
        }
      }

      // Function to hide all sections (for reset)
      function hideAllSections() {
        const sections = [
          "upload-section",
          "generate-section",
          "settings-section",
        ];
        sections.forEach((id) => {
          const element = document.getElementById(id);
          if (element) {
            element.style.display = "none";
          }
        });
        history.pushState(null, null, window.location.pathname);
      }
    </script>
  </body>
</html>
