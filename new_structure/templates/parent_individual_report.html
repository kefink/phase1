<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
      Individual Report - {{ student_name }} - {{ school_info.school_name or
      'Hillview School' }}
    </title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      :root {
        --solar-primary: #b58900;
               <button onclick="window.print()" class="action-btn btn-primary">
          <i class="fas fa-print"></i>
          Print Report
        </button>

        <a
          href="{{ url_for('parent.download_report', student_id=student_id, report_id=report_id) if student_id and report_id else '#' }}"
          class="action-btn btn-success"
        >secondary: #cb4b16;
        --solar-accent: #2aa198;
        --solar-bg: #fdf6e3;
        --solar-surface: #eee8d5;
        --solar-text: #657b83;
        --solar-text-dark: #073642;
        --solar-shadow: rgba(181, 137, 0, 0.1);
      }

      body {
        background: linear-gradient(
          135deg,
          var(--solar-bg) 0%,
          var(--solar-surface) 100%
        );
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        color: var(--solar-text);
        margin: 0;
        padding: 20px;
        min-height: 100vh;
      }

      .container {
        max-width: 900px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        box-shadow: 0 20px 40px var(--solar-shadow);
        overflow: hidden;
      }

      .report-header {
        background: linear-gradient(
          135deg,
          var(--solar-primary),
          var(--solar-secondary)
        );
        color: white;
        padding: 30px;
        text-align: center;
      }

      .school-logo {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        margin: 0 auto 15px;
        background: white;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .school-name {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 5px;
      }

      .school-info {
        font-size: 0.9rem;
        opacity: 0.9;
      }

      .report-title {
        font-size: 1.3rem;
        font-weight: 600;
        margin-top: 20px;
      }

      .student-info {
        background: white;
        padding: 25px;
        border-bottom: 3px solid var(--solar-surface);
      }

      .student-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .detail-item {
        background: var(--solar-surface);
        padding: 15px;
        border-radius: 10px;
        border-left: 4px solid var(--solar-accent);
      }

      .detail-label {
        font-size: 0.9rem;
        color: var(--solar-text);
        margin-bottom: 5px;
      }

      .detail-value {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--solar-text-dark);
      }

      .performance-summary {
        background: linear-gradient(135deg, #f8f9fa, #e9ecef);
        padding: 20px;
        border-radius: 15px;
        margin: 20px 0;
        text-align: center;
      }

      .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 20px;
      }

      .summary-item {
        background: white;
        padding: 15px;
        border-radius: 10px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .summary-value {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--solar-primary);
        margin-bottom: 5px;
      }

      .summary-label {
        font-size: 0.9rem;
        color: var(--solar-text);
      }

      .subjects-section {
        padding: 25px;
      }

      .section-title {
        font-size: 1.3rem;
        font-weight: 600;
        color: var(--solar-text-dark);
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--solar-surface);
      }

      .subjects-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 30px;
        background: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .subjects-table th {
        background: var(--solar-primary);
        color: white;
        padding: 15px 10px;
        text-align: center;
        font-weight: 600;
      }

      .subjects-table td {
        padding: 12px 10px;
        text-align: center;
        border-bottom: 1px solid #f0f0f0;
      }

      .subjects-table tr:nth-child(even) {
        background: #f8f9fa;
      }

      .subjects-table tr:hover {
        background: var(--solar-surface);
      }

      .subject-name {
        text-align: left !important;
        font-weight: 600;
        color: var(--solar-text-dark);
      }

      .grade-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
      }

      .grade-ee {
        background: #d4edda;
        color: #155724;
      }
      .grade-me {
        background: #d1ecf1;
        color: #0c5460;
      }
      .grade-ae {
        background: #fff3cd;
        color: #856404;
      }
      .grade-be {
        background: #f8d7da;
        color: #721c24;
      }

      .remarks-section {
        background: white;
        padding: 25px;
        border-top: 3px solid var(--solar-surface);
      }

      .teacher-comment {
        background: var(--solar-surface);
        padding: 15px;
        border-radius: 10px;
        margin-bottom: 15px;
        border-left: 4px solid var(--solar-accent);
      }

      .comment-header {
        font-weight: 600;
        color: var(--solar-text-dark);
        margin-bottom: 8px;
      }

      .comment-text {
        color: var(--solar-text);
        line-height: 1.5;
      }

      .actions-section {
        padding: 25px;
        background: #f8f9fa;
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .action-btn {
        padding: 12px 24px;
        border: none;
        border-radius: 25px;
        font-weight: 600;
        text-decoration: none;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }

      .btn-primary {
        background: var(--solar-primary);
        color: white;
      }

      .btn-primary:hover {
        background: var(--solar-secondary);
        transform: translateY(-2px);
        box-shadow: 0 5px 15px var(--solar-shadow);
      }

      .btn-secondary {
        background: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background: #5a6268;
        transform: translateY(-2px);
      }

      .grade-scale {
        background: white;
        padding: 20px;
        border-radius: 15px;
        margin-top: 20px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .scale-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
      }

      .scale-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px;
        border-radius: 8px;
        background: var(--solar-surface);
      }

      @media print {
        body {
          background: white;
        }
        .container {
          box-shadow: none;
        }
        .actions-section {
          display: none;
        }
      }

      @media (max-width: 768px) {
        .container {
          margin: 10px;
          border-radius: 15px;
        }

        .student-details {
          grid-template-columns: 1fr;
        }

        .subjects-table {
          font-size: 0.9rem;
        }

        .actions-section {
          flex-direction: column;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Report Header -->
      <div class="report-header">
        <div class="school-logo">
          {% if school_info.logo %}
          <img
            src="{{ school_info.logo }}"
            alt="School Logo"
            style="width: 60px; height: 60px; border-radius: 50%"
          />
          {% else %}
          <i
            class="fas fa-graduation-cap"
            style="font-size: 2rem; color: var(--solar-primary)"
          ></i>
          {% endif %}
        </div>
        <div class="school-name">
          {{ school_info.school_name or 'Hillview School' }}
        </div>
        <div class="school-info">
          {% if school_info.address %}{{ school_info.address }}<br />{% endif %}
          {% if school_info.phone %}{{ school_info.phone }}{% endif %} {% if
          school_info.email %} | {{ school_info.email }}{% endif %}
        </div>
        <div class="report-title">
          Academic Report - {{ term.replace('_', ' ').title() }} {{
          academic_year or '2025' }}
        </div>
      </div>

      <!-- Student Information -->
      <div class="student-info">
        <div class="student-details">
          <div class="detail-item">
            <div class="detail-label">Student Name</div>
            <div class="detail-value">{{ student_name }}</div>
          </div>

          <div class="detail-item">
            <div class="detail-label">Admission Number</div>
            <div class="detail-value">{{ admission_no or 'N/A' }}</div>
          </div>

          <div class="detail-item">
            <div class="detail-label">Grade & Stream</div>
            <div class="detail-value">{{ grade }} {{ stream }}</div>
          </div>

          <div class="detail-item">
            <div class="detail-label">Assessment Type</div>
            <div class="detail-value">
              {{ assessment_type.replace('_', ' ').title() }}
            </div>
          </div>
        </div>

        <!-- Performance Summary -->
        <div class="performance-summary">
          <h3 style="margin-top: 0; color: var(--solar-text-dark)">
            Performance Summary
          </h3>
          <div class="summary-grid">
            <div class="summary-item">
              <div class="summary-value">
                {{ "%.1f"|format(avg_percentage) if avg_percentage else 'N/A'
                }}%
              </div>
              <div class="summary-label">Overall Average</div>
            </div>

            <div class="summary-item">
              <div class="summary-value">{{ total or 0 }}</div>
              <div class="summary-label">Total Marks</div>
            </div>

            <div class="summary-item">
              <div class="summary-value">{{ total_possible_marks or 0 }}</div>
              <div class="summary-label">Possible Marks</div>
            </div>

            <div class="summary-item">
              <div class="summary-value">{{ mean_points or 'N/A' }}</div>
              <div class="summary-label">Mean Points</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Subjects Performance -->
      <div class="subjects-section">
        <h2 class="section-title">
          <i class="fas fa-book"></i>
          Subject Performance
        </h2>

        {% if table_data %}
        <table class="subjects-table">
          <thead>
            <tr>
              <th style="text-align: left">Subject</th>
              {% if assessment_type.lower() == 'end_term' %}
              <th>Entrance</th>
              <th>Mid Term</th>
              <th>End Term</th>
              <th>Average</th>
              {% else %}
              <th>{{ assessment_type.replace('_', ' ').title() }}</th>
              {% endif %}
              <th>Grade</th>
              <th>Remarks</th>
              <th>Teacher</th>
            </tr>
          </thead>
          <tbody>
            {% for row in table_data %}
            <tr>
              <td class="subject-name">{{ row.subject }}</td>
              {% if assessment_type.lower() == 'end_term' %}
              <td>{{ row.entrance | int if row.entrance != 0 else '-' }}</td>
              <td>{{ row.mid_term | int if row.mid_term != 0 else '-' }}</td>
              <td>{{ row.end_term | int if row.end_term != 0 else '-' }}</td>
              <td>
                <strong>{{ row.avg | int if row.avg != 0 else '-' }}</strong>
              </td>
              {% else %}
              <td>
                <strong
                  >{{ row.current_assessment | int if row.current_assessment !=
                  0 else '-' }}</strong
                >
              </td>
              {% endif %}
              <td>
                {% if row.grade %}
                <span class="grade-badge grade-{{ row.grade.lower()[:2] }}"
                  >{{ row.grade }}</span
                >
                {% else %}
                <span class="grade-badge">-</span>
                {% endif %}
              </td>
              <td>
                {{ row.remarks | replace(' (TBD)', '') if row.remarks else '-'
                }}
              </td>
              <td>
                {% if subject_teachers and subject_teachers.get(row.subject) %}
                {{ subject_teachers.get(row.subject).full_name or
                subject_teachers.get(row.subject).username }} {% else %} Not
                Assigned {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <div
          style="text-align: center; padding: 40px; color: var(--solar-text)"
        >
          <i
            class="fas fa-info-circle"
            style="font-size: 2rem; margin-bottom: 10px"
          ></i>
          <p>No subject data available for this report.</p>
        </div>
        {% endif %}

        <!-- Grading Scale -->
        <div class="grade-scale">
          <h3 style="margin-top: 0; color: var(--solar-text-dark)">
            Grading Scale
          </h3>
          <div class="scale-grid">
            <div class="scale-item">
              <span class="grade-badge grade-ee">EE</span>
              <span>Exceeding Expectation (75-100%)</span>
            </div>
            <div class="scale-item">
              <span class="grade-badge grade-me">ME</span>
              <span>Meeting Expectation (41-74%)</span>
            </div>
            <div class="scale-item">
              <span class="grade-badge grade-ae">AE</span>
              <span>Approaching Expectation (21-40%)</span>
            </div>
            <div class="scale-item">
              <span class="grade-badge grade-be">BE</span>
              <span>Below Expectation (0-20%)</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Remarks Section -->
      <div class="remarks-section">
        <h2 class="section-title">
          <i class="fas fa-comments"></i>
          Teacher Remarks & Recommendations
        </h2>

        {% if class_teacher_comment %}
        <div class="teacher-comment">
          <div class="comment-header">Class Teacher Comment</div>
          <div class="comment-text">{{ class_teacher_comment }}</div>
        </div>
        {% endif %} {% if headteacher_comment %}
        <div class="teacher-comment">
          <div class="comment-header">Head Teacher Comment</div>
          <div class="comment-text">{{ headteacher_comment }}</div>
        </div>
        {% endif %} {% if general_remarks %}
        <div class="teacher-comment">
          <div class="comment-header">General Remarks</div>
          <div class="comment-text">{{ general_remarks }}</div>
        </div>
        {% endif %} {% if term_info and term_info.next_term_opening_date %}
        <div class="teacher-comment">
          <div class="comment-header">Next Term Information</div>
          <div class="comment-text">
            <strong>Next term begins on:</strong> {{
            term_info.next_term_opening_date }}
          </div>
        </div>
        {% endif %}
      </div>

      <!-- Actions Section -->
      <div class="actions-section">
        <a
          href="{{ url_for('parent.child_reports', child_id=student_id) if student_id else '#' }}"
          class="action-btn btn-secondary"
        >
          <i class="fas fa-arrow-left"></i>
          Back to Reports
        </a>

        <button onclick="window.print()" class="action-btn btn-primary">
          <i class="fas fa-print"></i>
          Print Report
        </button>

        <a
          href="{{ url_for('parent.download_report', student_id=student_id, report_id=report_id) if student_id and report_id else '#' }}"
          class="action-btn btn-primary"
        >
          <i class="fas fa-download"></i>
          Download PDF
        </a>
      </div>
    </div>

    <script>
      // Add smooth animations for grade badges
      document.addEventListener("DOMContentLoaded", function () {
        const badges = document.querySelectorAll(".grade-badge");
        badges.forEach((badge, index) => {
          setTimeout(() => {
            badge.style.opacity = "0";
            badge.style.transform = "scale(0.8)";
            badge.style.transition = "all 0.3s ease";

            setTimeout(() => {
              badge.style.opacity = "1";
              badge.style.transform = "scale(1)";
            }, 100);
          }, index * 50);
        });
      });
    </script>
  </body>
</html>
