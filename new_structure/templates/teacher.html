<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher Dashboard - {{ school_info.school_name|default('School Management System') }}</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        /* Dark Green Teal Theme - Ultra Compact */
        :root {
            --primary-color: #134e4a;
            --secondary-color: #0f766e;
            --accent-color: #14b8a6;
            --success-color: #059669;
            --warning-color: #d97706;
            --danger-color: #dc2626;
            --info-color: #0891b2;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --text-muted: #9ca3af;
            --border-color: #e5e7eb;
            --background-light: #f9fafb;
            --background-white: #ffffff;
            --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 2px 4px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 4px 8px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 8px 16px rgba(0, 0, 0, 0.15);
            --radius-sm: 3px;
            --radius-md: 4px;
            --radius-lg: 6px;
            --radius-xl: 8px;
            --spacing-xs: 0.125rem;
            --spacing-sm: 0.25rem;
            --spacing-md: 0.5rem;
            --spacing-lg: 0.75rem;
            --spacing-xl: 1rem;
            --spacing-2xl: 1.25rem;
            --transition-fast: all 0.1s ease-in-out;
            --transition-normal: all 0.2s ease-in-out;
            --gradient-primary: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            --gradient-success: linear-gradient(135deg, var(--success-color) 0%, #047857 100%);
            --gradient-warning: linear-gradient(135deg, var(--warning-color) 0%, #b45309 100%);
            --gradient-danger: linear-gradient(135deg, var(--danger-color) 0%, #b91c1c 100%);
        }

        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Enhanced Navbar */
        .navbar {
            background: var(--gradient-primary);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow-lg);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            padding: var(--spacing-md) var(--spacing-xl);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-brand {
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            transition: var(--transition-fast);
        }

        .navbar-brand:hover {
            color: rgba(255, 255, 255, 0.9);
            transform: translateY(-1px);
        }

        .navbar-brand::before {
            content: "üè´";
            font-size: 1.75rem;
        }

        .navbar-nav {
            display: flex;
            list-style: none;
            gap: var(--spacing-lg);
            align-items: center;
        }

        .nav-link {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-weight: 500;
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateY(-1px);
        }

        .logout-btn {
            background: var(--gradient-danger);
            color: white;
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
            box-shadow: var(--shadow-sm);
        }

        .logout-btn:hover {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            color: white;
        }

        /* Ultra Compact Container */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: calc(60px + var(--spacing-md)) var(--spacing-md) var(--spacing-md);
        }

        /* Ultra Compact Page Header */
        .page-header {
            text-align: center;
            margin-bottom: var(--spacing-lg);
            padding: var(--spacing-md);
            background: var(--background-white);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }

        .page-title {
            font-size: 1.5rem;
            font-weight: 600;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: var(--spacing-xs);
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 500;
        }

        /* Ultra Compact Dashboard Cards */
        .dashboard-card {
            background: var(--background-white);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            margin-bottom: var(--spacing-md);
            overflow: hidden;
            transition: var(--transition-fast);
        }

        .dashboard-card:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .card-header {
            background: var(--gradient-primary);
            color: white;
            padding: var(--spacing-sm) var(--spacing-md);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .card-header span {
            font-size: 0.95rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .card-header span::before {
            content: "üìö";
            font-size: 1rem;
        }

        .card-header small {
            opacity: 0.9;
            font-size: 0.75rem;
            font-weight: 400;
        }

        .card-header button {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: var(--spacing-xs);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition-fast);
        }

        .card-header button:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        /* Ultra Compact Form Styling */
        .login-form {
            padding: var(--spacing-md);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-sm);
            align-items: end;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-xs);
        }

        .form-group label {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.2px;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .form-group label::before {
            content: "üìã";
            font-size: 0.8rem;
        }

        .form-group select,
        .form-group input {
            padding: var(--spacing-xs) var(--spacing-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            font-weight: 500;
            background: var(--background-white);
            color: var(--text-primary);
            transition: var(--transition-fast);
            box-shadow: var(--shadow-sm);
        }

        .form-group select:focus,
        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(19, 78, 74, 0.1);
            transform: translateY(-1px);
        }

        .form-group select:hover,
        .form-group input:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-md);
        }

        /* Ultra Compact Button Styling */
        .btn {
            background: var(--gradient-primary);
            color: white;
            padding: var(--spacing-xs) var(--spacing-md);
            border: none;
            border-radius: var(--radius-sm);
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-fast);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            text-decoration: none;
            box-shadow: var(--shadow-sm);
            min-height: 32px;
        }

        .btn:hover {
            background: linear-gradient(135deg, var(--secondary-color) 0%, #0d5d56 100%);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
            color: white;
        }

        .btn i {
            font-size: 0.85rem;
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            padding: var(--spacing-sm) var(--spacing-lg);
            border-radius: var(--radius-md);
            font-weight: 600;
            text-decoration: none;
            transition: var(--transition-fast);
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .btn-outline:hover {
            background: var(--primary-color);
            color: white;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Enhanced Alert Styling */
        .alert {
            padding: var(--spacing-lg);
            border-radius: var(--radius-lg);
            margin: var(--spacing-lg) 0;
            border-left: 4px solid;
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-md);
        }

        .alert-danger {
            background: linear-gradient(135deg, #fef2f2 0%, #ffffff 100%);
            border-left-color: var(--danger-color);
            color: var(--danger-color);
        }

        .alert-danger::before {
            content: "‚ö†Ô∏è";
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .alert strong {
            font-weight: 700;
        }
        /* Ocean Marble Performance indicator styles */
        .percentage-cell {
            font-weight: bold;
            padding: 8px 12px;
            border-radius: var(--radius-md);
            text-align: center;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: 1px solid rgba(238, 232, 178, 0.2);
            transition: all var(--transition-fast);
        }

        .percentage-cell.excellent {
            background: var(--color-glass-sage);
            color: var(--color-cream);
            border-color: var(--color-sage-green);
        }

        .percentage-cell.good {
            background: var(--color-glass-mint);
            color: var(--color-deep-teal);
            border-color: var(--color-mint);
        }

        .percentage-cell.average {
            background: var(--color-glass-gold);
            color: var(--color-dark-teal);
            border-color: var(--color-gold);
        }

        .percentage-cell.below-average {
            background: var(--color-glass-teal);
            color: var(--color-cream);
            border-color: var(--color-deep-teal);
        }

        /* Ocean Marble Composite subject styles */
        .composite-subject-entry-improved {
            width: 100%;
            padding: var(--space-md);
            border-radius: var(--radius-md);
            background: var(--color-glass-teal);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: var(--glass-border);
        }

        .composite-components-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: var(--space-md);
            width: 100%;
        }

        .component-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: var(--color-glass-sage);
            border-radius: var(--radius-md);
            padding: var(--space-md);
            border: var(--glass-border-gold);
            margin: 2px;
            min-height: 80px;
            justify-content: space-between;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            transition: all var(--transition-fast);
        }

        .component-column.overall-column {
            background: var(--color-glass-mint);
            border-color: var(--color-sage-green);
            font-weight: bold;
        }

        .mark-input-container {
            width: 100%;
            margin-bottom: 8px;
        }

        .component-mark {
            width: 100%;
            padding: var(--space-sm) var(--space-md);
            border: var(--glass-border-gold);
            border-radius: var(--radius-sm);
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            background: var(--color-glass-teal);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            color: var(--color-text-primary);
            transition: all var(--transition-fast);
        }

        .component-mark:focus {
            border-color: var(--color-gold);
            outline: none;
            box-shadow: 0 0 0 3px rgba(193, 141, 82, 0.3);
            background: var(--color-glass-sage);
            transform: translateY(-2px);
        }

        .component-percentage {
            font-size: 13px;
            color: var(--color-gold);
            font-weight: bold;
            background: var(--color-glass-cream);
            padding: 4px 8px;
            border-radius: var(--radius-sm);
            min-height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(193, 141, 82, 0.3);
        }

        .overall-percentage {
            font-size: 16px;
            color: var(--color-sage-green);
            font-weight: bold;
            background: var(--color-glass-mint);
            padding: 8px 12px;
            border-radius: var(--radius-sm);
            border: var(--glass-border-gold);
            min-height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .component-label {
            font-size: 12px;
            font-weight: bold;
            color: var(--color-gold);
            text-align: center;
            margin-bottom: 5px;
            padding: 4px 8px;
            background: var(--color-glass-cream);
            border-radius: var(--radius-sm);
            border: var(--glass-border-gold);
        }

        /* Ocean Marble Composite Configuration Section Styles */
        .composite-config-section {
            background: var(--color-glass-teal);
            backdrop-filter: var(--glass-blur-strong);
            -webkit-backdrop-filter: var(--glass-blur-strong);
            border: var(--glass-border-gold);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            margin: var(--space-xl) 0;
            box-shadow: var(--glass-shadow-strong);
            position: relative;
            overflow: hidden;
        }

        .composite-config-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--color-glass-cream) 0%, var(--color-glass-sage) 100%);
            opacity: 0.2;
            pointer-events: none;
            z-index: -1;
        }

        .composite-config-header {
            text-align: center;
            margin-bottom: var(--space-lg);
        }

        .composite-config-header h4 {
            color: var(--color-text-accent);
            margin: 0 0 var(--space-sm) 0;
            font-size: 18px;
            text-shadow: 0 2px 4px rgba(8, 27, 27, 0.5);
        }

        .composite-config-header p {
            color: var(--color-text-secondary);
            margin: 0;
            font-size: 14px;
        }

        .component-config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            align-items: end;
        }

        .component-config-item {
            display: flex;
            flex-direction: column;
        }

        .component-config-item label {
            font-weight: bold;
            color: var(--color-text-accent);
            margin-bottom: var(--space-sm);
            font-size: 14px;
            text-shadow: 0 1px 2px rgba(8, 27, 27, 0.3);
        }

        .component-config-item input {
            padding: var(--space-sm) var(--space-md);
            border: var(--glass-border-gold);
            border-radius: var(--radius-sm);
            font-size: 16px;
            text-align: center;
            background: var(--color-glass-sage);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            color: var(--color-text-primary);
            transition: all var(--transition-fast);
        }

        .component-config-item input:focus {
            border-color: var(--color-gold);
            outline: none;
            box-shadow: 0 0 0 3px rgba(193, 141, 82, 0.3);
            background: var(--color-glass-mint);
            transform: translateY(-2px);
        }

        .component-config-item.total-display {
            text-align: center;
        }

        .total-marks-display {
            background: linear-gradient(135deg, var(--color-gold), var(--color-sage-green));
            color: var(--color-cream);
            padding: var(--space-md);
            border-radius: var(--radius-sm);
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            min-height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: var(--glass-border-gold);
            box-shadow: var(--glass-shadow);
        }

        .simplified-mark-entry {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        .mark-percentage {
            font-size: 12px;
            color: #666;
            font-weight: bold;
        }

        .component-headers {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-top: 5px;
            font-size: 11px;
            font-weight: normal;
        }

        .component-header-item {
            text-align: center;
            padding: 2px;
            background-color: #e9ecef;
            border-radius: 3px;
        }

        .component-header-item.overall-header {
            background-color: #dee2e6;
            font-weight: bold;
        }

        .table-wrapper {
            overflow-x: auto;
            margin: 20px 0;
        }

        .table-wrapper table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
        }

        .table-wrapper th,
        .table-wrapper td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            vertical-align: middle;
        }

        .table-wrapper th {
            background-color: #f8f9fa;
            font-weight: bold;
        }

        .composite-subject-header {
            background-color: #2196f3 !important;
            color: white !important;
            font-weight: bold;
        }

        .component-headers {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 5px;
            margin-top: 8px;
            font-size: 12px;
            font-weight: bold;
            color: white;
        }

        .component-header-item {
            text-align: center;
            padding: 4px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .component-header-item.overall-header {
            background-color: rgba(255, 255, 255, 0.3);
            font-weight: bold;
        }

        .class-average {
            font-size: 1.1em;
            padding: var(--space-md);
            border-radius: var(--radius-md);
            text-align: center;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border: var(--glass-border);
            font-weight: 600;
            transition: all var(--transition-fast);
        }

        .class-average.excellent {
            background: var(--color-glass-sage);
            color: var(--color-cream);
            border-color: var(--color-sage-green);
        }

        .class-average.good {
            background: var(--color-glass-mint);
            color: var(--color-deep-teal);
            border-color: var(--color-mint);
        }

        .class-average.average {
            background: var(--color-glass-gold);
            color: var(--color-dark-teal);
            border-color: var(--color-gold);
        }

        .class-average.below-average {
            background: var(--color-glass-teal);
            color: var(--color-cream);
            border-color: var(--color-deep-teal);
        }

        /* Ocean Marble Input validation styles */
        input[type="number"]:invalid {
            border-color: var(--color-error);
            box-shadow: 0 0 0 3px rgba(255, 107, 107, 0.25);
        }

        input[type="number"]:valid {
            border-color: var(--color-sage-green);
            box-shadow: 0 0 0 3px rgba(90, 143, 118, 0.25);
        }

        /* Ocean Marble Table styling improvements */
        table {
            margin-top: var(--space-lg);
        }

        table th, table td {
            padding: var(--space-md);
            text-align: center;
        }

        table tfoot td {
            background: var(--color-glass-sage);
            font-weight: bold;
            color: var(--color-text-primary);
        }

        /* Ocean Marble Subject information styling */
        .subject-info {
            margin-top: var(--space-sm);
            padding: var(--space-md);
            background: var(--color-glass-cream);
            border: var(--glass-border-gold);
            border-radius: var(--radius-sm);
            font-size: 0.9em;
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
        }

        .subject-info strong {
            color: var(--color-gold);
        }

        .subject-info br {
            margin-bottom: 4px;
        }

        /* Ocean Marble Composite subject styling */
        .composite-info {
            background: linear-gradient(135deg, var(--color-sage-green) 0%, var(--color-deep-teal) 100%);
            color: var(--color-cream);
            padding: var(--space-xl);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-xl);
            text-align: center;
            border: var(--glass-border-gold);
            box-shadow: var(--glass-shadow);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
        }

        .composite-info h4 {
            margin: 0 0 var(--space-md) 0;
            font-size: 1.2em;
            text-shadow: 0 2px 4px rgba(8, 27, 27, 0.5);
        }

        .composite-info p {
            margin: 0;
            opacity: 0.9;
        }

        .subject-type-info {
            margin-bottom: 15px;
        }

        /* Component input styling */
        .component-input-cell {
            text-align: center;
            padding: 8px;
        }

        .component-input-cell input {
            width: 80px;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 4px;
            padding: 5px;
            font-size: 14px;
        }

        .component-input-cell input:focus {
            border-color: #2196f3;
            outline: none;
            box-shadow: 0 0 5px rgba(33, 150, 243, 0.3);
        }

        /* Clean composite subject entry styling */
        .composite-subject-entry-clean {
            width: 100%;
            padding: 10px;
        }

        .composite-components-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            align-items: center;
            justify-items: center;
        }

        .composite-components-row .component-input-cell {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            min-width: 100px;
        }

        .composite-components-row .component-input-cell input {
            width: 70px;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 6px;
            text-align: center;
            font-size: 14px;
            font-weight: bold;
            background: white;
        }

        .composite-components-row .component-input-cell input:focus {
            border-color: #4a90e2;
            outline: none;
            box-shadow: 0 0 5px rgba(74, 144, 226, 0.3);
        }

        .composite-components-row .component-percentage {
            font-size: 12px;
            font-weight: bold;
            color: #4a90e2;
            background: white;
            padding: 4px 8px;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            min-width: 45px;
            text-align: center;
        }

        .composite-components-row .overall-cell {
            background: linear-gradient(135deg, #e8f4fd, #d1ecf1);
            border: 2px solid #4a90e2;
            padding: 15px;
            border-radius: 8px;
        }

        .composite-components-row .overall-percentage {
            font-size: 16px;
            font-weight: bold;
            color: #2c3e50;
            text-align: center;
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            border: 2px solid #4a90e2;
            min-width: 60px;
        }

        /* Ocean Marble Enhanced Subject Report Styling */
        .enhanced-subject-report-section {
            background: var(--color-glass-teal);
            backdrop-filter: var(--glass-blur-strong);
            -webkit-backdrop-filter: var(--glass-blur-strong);
            border: var(--glass-border-gold);
            border-radius: var(--radius-xl);
            padding: var(--space-xxl);
            margin: var(--space-xxl) 0;
            box-shadow: var(--glass-shadow-strong);
            position: relative;
            overflow: hidden;
        }

        .enhanced-subject-report-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, var(--color-glass-cream) 0%, var(--color-glass-sage) 100%);
            opacity: 0.2;
            pointer-events: none;
            z-index: -1;
        }

        .subject-report-header {
            text-align: center;
            margin-bottom: var(--space-xl);
        }

        .subject-report-header h3 {
            color: var(--color-text-accent);
            font-size: 24px;
            margin-bottom: var(--space-lg);
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(8, 27, 27, 0.5);
        }

        .report-details-card {
            background: var(--color-glass-sage);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            box-shadow: var(--glass-shadow);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--space-lg);
            margin-bottom: var(--space-xl);
            border: var(--glass-border);
        }

        .report-detail-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .detail-label {
            font-size: 12px;
            color: var(--color-text-muted);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: var(--space-sm);
        }

        .detail-value {
            font-size: 16px;
            color: var(--color-text-primary);
            font-weight: bold;
            background: var(--color-glass-cream);
            padding: var(--space-sm) var(--space-md);
            border-radius: var(--radius-sm);
            border: var(--glass-border-gold);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
        }

        .subject-report-actions {
            text-align: center;
        }

        .enhanced-report-btn {
            background: linear-gradient(135deg, var(--color-gold), var(--color-sage-green));
            color: var(--color-cream);
            padding: var(--space-lg) var(--space-xxl);
            font-size: 16px;
            font-weight: bold;
            border: var(--glass-border-gold);
            border-radius: var(--radius-lg);
            text-decoration: none;
            display: inline-block;
            transition: all var(--transition-fast);
            box-shadow: var(--glass-shadow);
            backdrop-filter: var(--glass-blur);
            -webkit-backdrop-filter: var(--glass-blur);
        }

        .enhanced-report-btn:hover {
            background: linear-gradient(135deg, var(--color-sage-green), var(--color-mint));
            transform: translateY(-4px);
            box-shadow: var(--glass-shadow-hover);
            color: var(--color-cream);
            text-decoration: none;
            border-color: var(--color-gold);
        }

        .report-description {
            color: var(--color-text-secondary);
            font-size: 14px;
            margin-top: var(--space-lg);
            line-height: 1.5;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Ultra Compact Table Styling */
        .table-wrapper {
            background: var(--background-white);
            border-radius: var(--radius-md);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            margin: var(--spacing-md) 0;
        }

        .table-wrapper table {
            width: 100%;
            border-collapse: collapse;
            margin: 0;
        }

        .table-wrapper th {
            background: var(--gradient-primary);
            color: white;
            padding: var(--spacing-xs) var(--spacing-sm);
            text-align: center;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.2px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .table-wrapper th::before {
            content: "üìä";
            margin-right: var(--spacing-xs);
            font-size: 0.8rem;
        }

        .table-wrapper td {
            padding: var(--spacing-xs);
            border-bottom: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-primary);
            font-weight: 500;
            transition: var(--transition-fast);
            font-size: 0.8rem;
        }

        .table-wrapper tr:nth-child(even) {
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
        }

        .table-wrapper tr:nth-child(odd) {
            background: var(--background-white);
        }

        .table-wrapper tr:hover {
            background: linear-gradient(135deg, #f0fdfa 0%, #ccfbf1 100%);
            transform: scale(1.002);
            box-shadow: var(--shadow-sm);
        }

        .table-wrapper tr:hover td {
            color: var(--primary-color);
        }

        /* Ultra Compact Marks Entry Styling */
        .pupils-list {
            padding: var(--spacing-md);
        }

        .pupils-list h3 {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
            text-align: center;
            padding: var(--spacing-sm);
            background: var(--gradient-primary);
            color: white;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-sm);
        }

        .pupils-list h3::before {
            content: "üìù";
            margin-right: var(--spacing-xs);
            font-size: 1.2rem;
        }

        /* Enhanced Student Mark Input */
        .student-mark {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            font-weight: 600;
            text-align: center;
            background: var(--background-white);
            color: var(--text-primary);
            transition: var(--transition-fast);
            box-shadow: var(--shadow-sm);
        }

        .student-mark:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
            transform: translateY(-2px);
            background: linear-gradient(135deg, #eff6ff 0%, #ffffff 100%);
        }

        .student-mark:hover {
            border-color: var(--primary-color);
            box-shadow: var(--shadow-md);
        }

        /* Enhanced Composite Subject Styling */
        .composite-subject-entry-clean {
            width: 100%;
            padding: var(--spacing-lg);
            background: linear-gradient(135deg, #f8fafc 0%, #ffffff 100%);
            border-radius: var(--radius-lg);
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }

        .composite-components-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: var(--spacing-lg);
            align-items: center;
            justify-items: center;
        }

        .component-input-cell {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-lg);
            background: var(--background-white);
            border-radius: var(--radius-lg);
            border: 2px solid var(--border-color);
            min-width: 120px;
            transition: var(--transition-fast);
            box-shadow: var(--shadow-sm);
        }

        .component-input-cell:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .component-input-cell input {
            width: 80px;
            padding: var(--spacing-sm);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            text-align: center;
            font-size: 1rem;
            font-weight: 600;
            background: var(--background-white);
            color: var(--text-primary);
            transition: var(--transition-fast);
        }

        .component-input-cell input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            background: linear-gradient(135deg, #eff6ff 0%, #ffffff 100%);
        }

        .component-percentage {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--primary-color);
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-sm);
            border: 1px solid rgba(59, 130, 246, 0.2);
            min-width: 50px;
            text-align: center;
            box-shadow: var(--shadow-sm);
        }

        .overall-cell {
            background: var(--gradient-primary) !important;
            border: 2px solid var(--primary-color) !important;
            padding: var(--spacing-lg);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }

        .overall-percentage {
            font-size: 1.125rem;
            font-weight: 700;
            color: white;
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: var(--spacing-sm) var(--spacing-md);
            border-radius: var(--radius-md);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-width: 70px;
            backdrop-filter: blur(10px);
        }

        /* Enhanced Subject Info */
        .subject-info {
            margin-top: var(--spacing-md);
            padding: var(--spacing-lg);
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid var(--info-color);
            border-radius: var(--radius-lg);
            font-size: 0.875rem;
            color: var(--text-primary);
            box-shadow: var(--shadow-md);
        }

        .subject-info::before {
            content: "‚ÑπÔ∏è";
            margin-right: var(--spacing-sm);
            font-size: 1.25rem;
        }

        .subject-info strong {
            color: var(--info-color);
            font-weight: 700;
        }

        /* Enhanced Composite Configuration */
        .composite-config-section {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border: 2px solid var(--primary-color);
            border-radius: var(--radius-xl);
            padding: var(--spacing-2xl);
            margin: var(--spacing-xl) 0;
            box-shadow: var(--shadow-xl);
            position: relative;
            overflow: hidden;
        }

        .composite-config-section::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--gradient-primary);
            opacity: 0.05;
            pointer-events: none;
            z-index: 0;
        }

        .composite-config-header {
            text-align: center;
            margin-bottom: var(--spacing-xl);
            position: relative;
            z-index: 1;
        }

        .composite-config-header h4 {
            color: var(--primary-color);
            margin: 0 0 var(--spacing-sm) 0;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .composite-config-header p {
            color: var(--text-secondary);
            margin: 0;
            font-size: 1rem;
            font-weight: 500;
        }

        .component-config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: var(--spacing-lg);
            align-items: end;
            position: relative;
            z-index: 1;
        }

        .component-config-item {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .component-config-item label {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: var(--spacing-sm);
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .component-config-item input {
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            font-size: 1rem;
            text-align: center;
            background: var(--background-white);
            color: var(--text-primary);
            transition: var(--transition-fast);
            font-weight: 600;
            box-shadow: var(--shadow-sm);
        }

        .component-config-item input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
            transform: translateY(-2px);
        }

        .total-marks-display {
            background: var(--gradient-primary);
            color: white;
            padding: var(--spacing-md);
            border-radius: var(--radius-lg);
            font-size: 1.25rem;
            font-weight: 700;
            text-align: center;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid var(--primary-color);
            box-shadow: var(--shadow-md);
        }

        /* Enhanced Recent Reports */
        .table-responsive {
            background: var(--background-white);
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }

        .table-responsive table {
            width: 100%;
            border-collapse: collapse;
        }

        .table-responsive th {
            background: var(--gradient-primary);
            color: white;
            padding: var(--spacing-lg);
            text-align: center;
            font-weight: 600;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table-responsive td {
            padding: var(--spacing-lg);
            border-bottom: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-primary);
            font-weight: 500;
        }

        .table-responsive tr:hover {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
        }

        .badge {
            background: var(--gradient-success);
            color: white;
            padding: var(--spacing-xs) var(--spacing-sm);
            border-radius: var(--radius-md);
            font-size: 0.875rem;
            font-weight: 600;
            box-shadow: var(--shadow-sm);
        }

        /* Enhanced Footer */
        footer {
            background: var(--gradient-primary);
            color: white;
            text-align: center;
            padding: var(--spacing-xl);
            margin-top: var(--spacing-2xl);
            font-weight: 500;
        }

        footer::before {
            content: "üè´";
            margin-right: var(--spacing-sm);
            font-size: 1.25rem;
        }
    </style>
</head>
<body>
    <!-- Error Message Section -->
    {% if error_message %}
    <div class="alert alert-danger" style="background: var(--white); color: var(--error-color); padding: var(--spacing-md); margin: var(--spacing-md) 0; border-radius: var(--border-radius); border: 1px solid var(--error-color); box-shadow: var(--shadow-sm);">
        <strong>Error:</strong> {{ error_message }}
    </div>
    {% endif %}

    <nav class="navbar">
        <a href="#" class="navbar-brand">{{ school_info.school_name|default('School Management System') }}</a>
        <ul class="navbar-nav">
            <li class="nav-item">
                <a href="{{ url_for('teacher.dashboard') }}" class="nav-link">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </a>
            </li>
            <li class="nav-item">
                <a href="{{ url_for('auth.logout_route') }}" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </a>
            </li>
        </ul>
    </nav>

    <div class="container">
        <!-- Modern Page Header -->
        <div class="page-header">
            <h1 class="page-title">Teacher Dashboard</h1>
            <p class="page-subtitle">Manage student marks and generate comprehensive reports</p>
        </div>

        <!-- Role-Based Assignments Section -->
        {% if assignment_summary and assignment_summary.teacher %}
        <div class="dashboard-card" style="margin-bottom: var(--spacing-xl);">
            <div class="card-header">
                <span>üìö My Assignments</span>
                <small>{{ assignment_summary.role.title() }} Dashboard</small>
            </div>
            <div style="padding: var(--spacing-lg);">
                <!-- Assignment Summary Stats -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-md); margin-bottom: var(--spacing-lg);">
                    <div style="background: var(--gradient-success); color: white; padding: var(--spacing-md); border-radius: var(--radius-md); text-align: center; box-shadow: var(--shadow-sm);">
                        <div style="font-size: 1.5rem; font-weight: 700;">{{ total_subjects_taught }}</div>
                        <div style="font-size: 0.85rem; opacity: 0.9;">Subjects Taught</div>
                    </div>
                    {% if can_manage_classes %}
                    <div style="background: var(--gradient-primary); color: white; padding: var(--spacing-md); border-radius: var(--radius-md); text-align: center; box-shadow: var(--shadow-sm);">
                        <div style="font-size: 1.5rem; font-weight: 700;">{{ assignment_summary.total_classes_managed }}</div>
                        <div style="font-size: 0.85rem; opacity: 0.9;">Classes Managed</div>
                    </div>
                    {% endif %}
                    <div style="background: var(--gradient-warning); color: white; padding: var(--spacing-md); border-radius: var(--radius-md); text-align: center; box-shadow: var(--shadow-sm);">
                        <div style="font-size: 1.5rem; font-weight: 700;">{{ assignment_summary.grades_involved|length if assignment_summary.grades_involved else 0 }}</div>
                        <div style="font-size: 0.85rem; opacity: 0.9;">Grades Involved</div>
                    </div>
                </div>

                <!-- Class Teacher Assignments (if any) -->
                {% if can_manage_classes and class_teacher_assignments %}
                <div style="margin-bottom: var(--spacing-lg);">
                    <h4 style="color: var(--primary-color); margin-bottom: var(--spacing-md); font-size: 1rem; font-weight: 600;">üè´ Class Teacher Responsibilities</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-sm);">
                        {% for assignment in class_teacher_assignments %}
                        <div style="background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border: 2px solid var(--primary-color); border-radius: var(--radius-md); padding: var(--spacing-md); text-align: center;">
                            <div style="font-weight: 600; color: var(--primary-color);">{{ assignment.grade_level }}</div>
                            {% if assignment.stream_name %}
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">Stream {{ assignment.stream_name }}</div>
                            {% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

                <!-- Subject Assignments -->
                {% if subject_assignments %}
                <div>
                    <h4 style="color: var(--primary-color); margin-bottom: var(--spacing-md); font-size: 1rem; font-weight: 600;">üìñ Subject Teaching Assignments</h4>
                    <div style="max-height: 200px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: var(--radius-md);">
                        <table style="width: 100%; border-collapse: collapse;">
                            <thead>
                                <tr style="background: var(--gradient-primary); color: white;">
                                    <th style="padding: var(--spacing-sm); text-align: left; font-size: 0.8rem;">Subject</th>
                                    <th style="padding: var(--spacing-sm); text-align: center; font-size: 0.8rem;">Grade</th>
                                    <th style="padding: var(--spacing-sm); text-align: center; font-size: 0.8rem;">Stream</th>
                                    <th style="padding: var(--spacing-sm); text-align: center; font-size: 0.8rem;">Role</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for assignment in subject_assignments[:10] %}
                                <tr style="border-bottom: 1px solid var(--border-color); {% if loop.index % 2 == 0 %}background: var(--background-light);{% endif %}">
                                    <td style="padding: var(--spacing-sm); font-weight: 500;">{{ assignment.subject_name }}</td>
                                    <td style="padding: var(--spacing-sm); text-align: center;">{{ assignment.grade_level }}</td>
                                    <td style="padding: var(--spacing-sm); text-align: center;">{{ assignment.stream_name or 'All' }}</td>
                                    <td style="padding: var(--spacing-sm); text-align: center;">
                                        {% if assignment.is_class_teacher %}
                                        <span style="background: var(--gradient-success); color: white; padding: 2px 6px; border-radius: var(--radius-sm); font-size: 0.7rem;">Class Teacher</span>
                                        {% else %}
                                        <span style="background: var(--gradient-warning); color: white; padding: 2px 6px; border-radius: var(--radius-sm); font-size: 0.7rem;">Subject Teacher</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                                {% if subject_assignments|length > 10 %}
                                <tr>
                                    <td colspan="4" style="padding: var(--spacing-sm); text-align: center; color: var(--text-secondary); font-style: italic;">
                                        ... and {{ subject_assignments|length - 10 }} more assignments
                                    </td>
                                </tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
                {% endif %}

                <!-- Quick Access Note -->
                <div style="margin-top: var(--spacing-lg); padding: var(--spacing-md); background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); border-radius: var(--radius-md); border: 1px solid var(--info-color);">
                    <div style="font-size: 0.85rem; color: var(--text-secondary);">
                        <strong style="color: var(--info-color);">üìå Quick Access:</strong>
                        The form below is filtered to show only subjects and grades you're assigned to teach.
                        {% if assignment_summary.role == 'teacher' %}
                        As a subject teacher, you can upload marks for your assigned subjects only.
                        {% elif assignment_summary.role == 'classteacher' %}
                        As a class teacher, you can upload marks for all your subjects and manage your assigned classes.
                        {% elif assignment_summary.role == 'headteacher' %}
                        As a headteacher, you have full access to all subjects and classes in the system.
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Debug Panel -->
        <div id="debug-panel" class="dashboard-card" style="background: var(--white); border: 1px solid var(--border-color); margin-bottom: var(--spacing-xl); display: none;">
            <div class="card-header" style="background: var(--primary-color); color: var(--white);">
                <span>üîß Debug Information</span>
                <button onclick="toggleDebug()" style="float: right; background: none; border: none; color: var(--white);">Hide</button>
            </div>
            <div id="debug-content" style="padding: var(--spacing-lg); font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; color: var(--text-dark);">
                <div id="debug-messages"></div>
            </div>
        </div>

        <div class="dashboard-card">
            <div class="card-header">
                <span>Upload Class Marks</span>
                <small>Complete all fields to process marks</small>
                <button onclick="toggleDebug()" style="float: right; background: none; border: none; color: var(--primary-color); text-decoration: underline;">Show Debug</button>
            </div>

            {% if error_message %}
            <div class="alert alert-danger" style="background: var(--white); color: var(--error-color); padding: var(--spacing-md); margin: var(--spacing-md) 0; border-radius: var(--border-radius); border: 1px solid var(--error-color); box-shadow: var(--shadow-sm);">
                <strong>Error:</strong> {{ error_message }}
                <br><br>
                <a href="{{ url_for('teacher.reset_form') }}" class="btn" style="background: var(--error-color); color: var(--white); margin-top: var(--spacing-md);">
                    üîÑ Reset Form
                </a>
            </div>
            {% endif %}

            {% if not show_students %}
            <!-- Enhanced form with education level filtering -->
            <form id="upload-form" method="POST" action="{{ url_for('teacher.dashboard') }}" class="login-form">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>

                <!-- Enhanced Education Level Selection -->
                <div class="form-group">
                    <label for="education_level">
                        <i class="fas fa-graduation-cap"></i>
                        Education Level
                    </label>
                    <select id="education_level" name="education_level" required onchange="updateSubjectsByEducationLevel()">
                        <option value="">üéØ Select Education Level</option>
                        <option value="lower_primary" {% if education_level == 'lower_primary' %}selected{% endif %}>üéì Lower Primary (Grades 1-3)</option>
                        <option value="upper_primary" {% if education_level == 'upper_primary' %}selected{% endif %}>üìö Upper Primary (Grades 4-6)</option>
                        <option value="junior_secondary" {% if education_level == 'junior_secondary' %}selected{% endif %}>üè´ Junior Secondary (Grades 7-9)</option>
                    </select>
                </div>

                <!-- Enhanced Subject Selection (filtered by education level) -->
                <div class="form-group">
                    <label for="subject">
                        <i class="fas fa-book"></i>
                        Subject
                    </label>
                    <select id="subject" name="subject" required onchange="handleSubjectSelection()">
                        <option value="">üìñ Select Subject</option>
                        <!-- Subjects will be populated based on education level -->
                    </select>
                    <div id="subject-info" class="subject-info" style="display: none;">
                        <small id="subject-details"></small>
                    </div>
                </div>

                <div class="form-group">
                    <label for="term">
                        <i class="fas fa-calendar-alt"></i>
                        Term
                    </label>
                    <select id="term" name="term" required>
                        <option value="">üìÖ Select Term</option>
                        {% for term_option in terms %}
                        <option value="{{ term_option }}" {% if term == term_option %}selected{% endif %}>üìÜ {{ term_option }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="assessment_type">
                        <i class="fas fa-clipboard-check"></i>
                        Assessment Type
                    </label>
                    <select id="assessment_type" name="assessment_type" required>
                        <option value="">üìù Select Assessment Type</option>
                        {% for assessment_option in assessment_types %}
                        <option value="{{ assessment_option }}" {% if assessment_type == assessment_option %}selected{% endif %}>üìä {{ assessment_option }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group" id="total-marks-group">
                    <label for="total_marks">
                        <i class="fas fa-calculator"></i>
                        Total Marks (Out Of)
                    </label>
                    <input type="number" id="total_marks" name="total_marks" min="1" value="{{ total_marks if total_marks else '' }}" required>
                </div>

                <!-- Composite Subject Configuration (shown only for English/Kiswahili) -->
                <div id="composite-config" class="composite-config-section" style="display: none;">
                    <div class="composite-config-header">
                        <h4>üìö Composite Subject Configuration</h4>
                        <p>Set maximum marks for each component:</p>
                    </div>

                    <div id="english-config" class="component-config" style="display: none;">
                        <div class="component-config-grid">
                            <div class="component-config-item">
                                <label for="grammar_max">Grammar (Max Marks)</label>
                                <input type="number" id="grammar_max" name="grammar_max" value="{{ grammar_max_marks }}" min="1" max="1000"
                                       oninput="updateComponentMaxMarks()">
                            </div>
                            <div class="component-config-item">
                                <label for="composition_max">Composition (Max Marks)</label>
                                <input type="number" id="composition_max" name="composition_max" value="{{ composition_max_marks }}" min="1" max="1000"
                                       oninput="updateComponentMaxMarks()">
                            </div>
                            <div class="component-config-item total-display">
                                <label>Total Max Marks</label>
                                <div id="english_total_display" class="total-marks-display">{{ grammar_max_marks|int + composition_max_marks|int }}</div>
                            </div>
                        </div>
                    </div>

                    <div id="kiswahili-config" class="component-config" style="display: none;">
                        <div class="component-config-grid">
                            <div class="component-config-item">
                                <label for="lugha_max">Lugha (Max Marks)</label>
                                <input type="number" id="lugha_max" name="lugha_max" value="{{ lugha_max_marks }}" min="1" max="1000"
                                       oninput="updateComponentMaxMarks()">
                            </div>
                            <div class="component-config-item">
                                <label for="insha_max">Insha (Max Marks)</label>
                                <input type="number" id="insha_max" name="insha_max" value="{{ insha_max_marks }}" min="1" max="1000"
                                       oninput="updateComponentMaxMarks()">
                            </div>
                            <div class="component-config-item total-display">
                                <label>Total Max Marks</label>
                                <div id="kiswahili_total_display" class="total-marks-display">{{ lugha_max_marks|int + insha_max_marks|int }}</div>
                            </div>
                        </div>
                    </div>
                </div>



                <div class="form-group">
                    <label for="grade">
                        <i class="fas fa-layer-group"></i>
                        Grade
                    </label>
                    <select id="grade" name="grade" required onchange="updateStreams()">
                        <option value="">üìö Select Grade</option>
                        {% for grade_option in grades %}
                        <option value="{{ grade_option }}" {% if grade == grade_option %}selected{% endif %}>üéì {{ grade_option }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label for="stream">
                        <i class="fas fa-users"></i>
                        Stream
                    </label>
                    <select id="stream" name="stream" required>
                        <option value="">üèõÔ∏è Select Stream</option>
                        <!-- Streams will be populated dynamically via JavaScript -->
                    </select>
                </div>

                <div class="form-group" style="grid-column: span 2; text-align: center;">
                    <button type="submit" name="upload_marks" value="1" class="btn" id="upload-btn" onclick="debugFormSubmission()">
                        <i class="fas fa-upload"></i>
                        Upload Marks
                    </button>
                </div>
            </form>
            {% else %}
            <!-- Enhanced form for entering student marks with composite subject support -->
            <div id="pupils-list" class="pupils-list" style="grid-column: span 2;">
                <h3>Enter Marks for {{ subject }} - Grade {{ grade }} Stream {{ stream }}</h3>
                <div id="subject-type-info" class="subject-type-info"></div>

                <form method="POST" action="{{ url_for('teacher.dashboard') }}">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                    <!-- Keep existing form fields as hidden fields -->
                    <input type="hidden" name="education_level" value="{{ education_level }}">
                    <input type="hidden" name="subject" value="{{ subject }}">
                    <input type="hidden" name="grade" value="{{ grade }}">
                    <input type="hidden" name="stream" value="{{ stream }}">
                    <input type="hidden" name="term" value="{{ term }}">
                    <input type="hidden" name="assessment_type" value="{{ assessment_type }}">
                    <input type="hidden" name="total_marks" value="{{ total_marks }}">

                    <!-- Hidden fields for composite subject configuration -->
                    <input type="hidden" id="hidden_grammar_max" name="grammar_max_marks" value="{{ grammar_max_marks }}">
                    <input type="hidden" id="hidden_composition_max" name="composition_max_marks" value="{{ composition_max_marks }}">
                    <input type="hidden" id="hidden_lugha_max" name="lugha_max_marks" value="{{ lugha_max_marks }}">
                    <input type="hidden" id="hidden_insha_max" name="insha_max_marks" value="{{ insha_max_marks }}">

                    <!-- Proven table structure adapted from classteacher -->
                    <div class="table-wrapper">
                        <table>
                            <thead>
                                <tr>
                                    <th>Student Name</th>
                                    {% set subject_obj = namespace(obj=none) %}
                                    {% if education_level and subject %}
                                        {% for s in subjects_by_education_level[education_level] %}
                                            {% if s == subject %}
                                                {% set subject_obj.obj = {'name': subject, 'id': loop.index, 'is_composite': subject in ['ENGLISH', 'KISWAHILI']} %}
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                    <th class="{% if subject_obj.obj and subject_obj.obj.is_composite %}composite-subject-header{% endif %}" data-subject-id="{{ subject_obj.obj.id if subject_obj.obj else '' }}">
                                        {{ subject }}
                                        <div style="font-size: 12px; font-weight: normal; margin-top: 5px;">
                                            <span class="subject-info">Max Raw: {{ total_marks }}</span>
                                        </div>
                                        {% if subject_obj.obj and subject_obj.obj.is_composite %}
                                        <div class="component-headers">
                                            {% if subject == 'ENGLISH' %}
                                            <div class="component-header-item">Grammar</div>
                                            <div class="component-header-item">Composition</div>
                                            {% elif subject == 'KISWAHILI' %}
                                            <div class="component-header-item">Lugha</div>
                                            <div class="component-header-item">Insha</div>
                                            {% endif %}
                                            <div class="component-header-item overall-header">Overall</div>
                                        </div>
                                        {% endif %}
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for student in students %}
                                <tr>
                                    <td>{{ student.name }}</td>
                                    <td>
                                        {% if subject in ['ENGLISH', 'KISWAHILI'] %}
                                        <!-- Composite subject entry - clean layout without repetitive labels -->
                                        <div class="composite-subject-entry-clean">
                                            <div class="composite-components-row">
                                                {% if subject == 'ENGLISH' %}
                                                <!-- Grammar input -->
                                                <div class="component-input-cell">
                                                    <input type="number"
                                                        name="component_{{ student.name.replace(' ', '_') }}_1"
                                                        value=""
                                                        min="0"
                                                        max="{{ grammar_max_marks }}"
                                                        placeholder="0-{{ grammar_max_marks }}"
                                                        required
                                                        class="student-mark component-mark grammar-input"
                                                        data-student="{{ student.name.replace(' ', '_') }}"
                                                        data-subject="2"
                                                        data-component="1"
                                                        data-component-weight="0.6"
                                                        data-max-mark="{{ grammar_max_marks }}"
                                                        oninput="updateComponentPercentage(this); calculateOverallSubjectMark('{{ student.name.replace(' ', '_') }}', '2')">
                                                    <div class="component-percentage" id="component_percentage_{{ student.name.replace(' ', '_') }}_2_1">0%</div>
                                                </div>
                                                <!-- Composition input -->
                                                <div class="component-input-cell">
                                                    <input type="number"
                                                        name="component_{{ student.name.replace(' ', '_') }}_2"
                                                        value=""
                                                        min="0"
                                                        max="{{ composition_max_marks }}"
                                                        placeholder="0-{{ composition_max_marks }}"
                                                        required
                                                        class="student-mark component-mark composition-input"
                                                        data-student="{{ student.name.replace(' ', '_') }}"
                                                        data-subject="2"
                                                        data-component="2"
                                                        data-component-weight="0.4"
                                                        data-max-mark="{{ composition_max_marks }}"
                                                        oninput="updateComponentPercentage(this); calculateOverallSubjectMark('{{ student.name.replace(' ', '_') }}', '2')">
                                                    <div class="component-percentage" id="component_percentage_{{ student.name.replace(' ', '_') }}_2_2">0%</div>
                                                </div>
                                                {% elif subject == 'KISWAHILI' %}
                                                <!-- Lugha input -->
                                                <div class="component-input-cell">
                                                    <input type="number"
                                                        name="component_{{ student.name.replace(' ', '_') }}_3"
                                                        value=""
                                                        min="0"
                                                        max="{{ lugha_max_marks }}"
                                                        placeholder="0-{{ lugha_max_marks }}"
                                                        required
                                                        class="student-mark component-mark lugha-input"
                                                        data-student="{{ student.name.replace(' ', '_') }}"
                                                        data-subject="7"
                                                        data-component="3"
                                                        data-component-weight="0.6"
                                                        data-max-mark="{{ lugha_max_marks }}"
                                                        oninput="updateComponentPercentage(this); calculateOverallSubjectMark('{{ student.name.replace(' ', '_') }}', '7')">
                                                    <div class="component-percentage" id="component_percentage_{{ student.name.replace(' ', '_') }}_7_3">0%</div>
                                                </div>
                                                <!-- Insha input -->
                                                <div class="component-input-cell">
                                                    <input type="number"
                                                        name="component_{{ student.name.replace(' ', '_') }}_4"
                                                        value=""
                                                        min="0"
                                                        max="{{ insha_max_marks }}"
                                                        placeholder="0-{{ insha_max_marks }}"
                                                        required
                                                        class="student-mark component-mark insha-input"
                                                        data-student="{{ student.name.replace(' ', '_') }}"
                                                        data-subject="7"
                                                        data-component="4"
                                                        data-component-weight="0.4"
                                                        data-max-mark="{{ insha_max_marks }}"
                                                        oninput="updateComponentPercentage(this); calculateOverallSubjectMark('{{ student.name.replace(' ', '_') }}', '7')">
                                                    <div class="component-percentage" id="component_percentage_{{ student.name.replace(' ', '_') }}_7_4">0%</div>
                                                </div>
                                                {% endif %}
                                                <!-- Overall percentage -->
                                                <div class="component-input-cell overall-cell">
                                                    <div class="overall-percentage" id="overall_percentage_{{ student.name.replace(' ', '_') }}_{{ '2' if subject == 'ENGLISH' else '7' }}">0%</div>
                                                </div>
                                            </div>

                                            <!-- Hidden fields for the overall subject mark (calculated from components) -->
                                            <input type="hidden"
                                                name="mark_{{ student.name.replace(' ', '_') }}_{{ '2' if subject == 'ENGLISH' else '7' }}"
                                                id="overall_mark_{{ student.name.replace(' ', '_') }}_{{ '2' if subject == 'ENGLISH' else '7' }}"
                                                value="0">
                                            <input type="hidden"
                                                name="hidden_percentage_{{ student.name.replace(' ', '_') }}_{{ '2' if subject == 'ENGLISH' else '7' }}"
                                                id="hidden_percentage_{{ student.name.replace(' ', '_') }}_{{ '2' if subject == 'ENGLISH' else '7' }}"
                                                value="0">
                                        </div>
                                        {% else %}
                                        <!-- Regular subject entry -->
                                        <div class="simplified-mark-entry">
                                            <div class="mark-input-container">
                                                <input type="number"
                                                    name="mark_{{ student.name.replace(' ', '_') }}_1"
                                                    value="0"
                                                    min="0"
                                                    max="{{ total_marks }}"
                                                    required
                                                    class="student-mark"
                                                    data-student="{{ student.name.replace(' ', '_') }}"
                                                    data-subject="1"
                                                    data-max-mark="{{ total_marks }}"
                                                    oninput="updateRegularSubjectPercentage(this)">
                                            </div>
                                            <div class="mark-percentage" id="percentage_{{ student.name.replace(' ', '_') }}_1">0%</div>
                                        </div>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="text-center mt-3">
                        <button type="submit" name="submit_marks" value="1" class="btn">
                            <i class="fas fa-check-circle"></i>
                            Submit Marks
                        </button>
                    </div>
                </form>
            </div>
            {% endif %}
        </div>

        <div class="dashboard-card mt-4">
            <div class="card-header">
                <span>Recent Reports</span>
                <a href="#" class="btn-outline">View All</a>
            </div>
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr>
                            <th>Grade</th>
                            <th>Stream</th>
                            <th>Term</th>
                            <th>Assessment</th>
                            <th>Class Average</th>
                            <th>Date</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if recent_reports %}
                        {% for report in recent_reports %}
                        <tr>
                            <td>{{ report.grade }}</td>
                            <td>{{ report.stream }}</td>
                            <td>{{ report.term }}</td>
                            <td>{{ report.assessment_type }}</td>
                            <td>
                                <span class="badge" style="background-color: #28a745; color: white; padding: 4px 8px; border-radius: 4px;">
                                    {{ report.class_average }}%
                                </span>
                            </td>
                            <td>{{ report.date }}</td>
                            <td>
                                <a href="{{ url_for('classteacher.preview_class_report', grade=report.grade, stream=report.stream, term=report.term, assessment_type=report.assessment_type) }}" class="btn" style="background-color: #007BFF;">
                                    Preview
                                </a>
                                <a href="{{ url_for('classteacher.download_class_report', grade=report.grade, stream=report.stream, term=report.term, assessment_type=report.assessment_type) }}" class="btn" style="background-color: #28A745; margin-left: 5px;">
                                    Download
                                </a>
                            </td>
                        </tr>
                        {% endfor %}
                        {% else %}
                        <tr>
                            <td colspan="7" style="text-align: center;">No recent reports available.</td>
                        </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Enhanced Subject Report Section -->
        {% if show_subject_report %}
        <div class="enhanced-subject-report-section">
            <div class="subject-report-header">
                <h3>üìà Enhanced Subject Report</h3>
                <div class="report-details-card">
                    <div class="report-detail-item">
                        <span class="detail-label">Subject:</span>
                        <span class="detail-value">{{ subject }}</span>
                    </div>
                    <div class="report-detail-item">
                        <span class="detail-label">Grade & Stream:</span>
                        <span class="detail-value">{{ grade }} - {{ stream }}</span>
                    </div>
                    <div class="report-detail-item">
                        <span class="detail-label">Assessment:</span>
                        <span class="detail-value">{{ term }} | {{ assessment_type }}</span>
                    </div>
                </div>
            </div>
            <div class="subject-report-actions">
                <a href="{{ url_for('teacher.generate_subject_report',
                         subject=subject,
                         grade=grade,
                         stream=stream,
                         term=term,
                         assessment_type=assessment_type) }}"
                   class="btn btn-primary enhanced-report-btn" target="_blank">
                    üìä Generate Subject Analysis Report
                </a>
                <p class="report-description">
                    Generate a comprehensive subject-specific report with grading analysis,
                    performance statistics, and detailed insights for {{ subject }}.
                </p>
            </div>
        </div>
        {% endif %}
    </div>

    <footer>
        <p>¬© 2025 {{ school_info.school_name|default('School Management System') }} - All Rights Reserved</p>
    </footer>

    <script>
        // Enhanced JavaScript with education level filtering and composite subject support
        let gradeMapping = {};
        let currentSubjectInfo = null;
        const subjectsByEducationLevel = {{ subjects_by_education_level | tojson }};

        // Debug functions
        function debugLog(message) {
            console.log(message);
            const debugMessages = document.getElementById('debug-messages');
            if (debugMessages) {
                const timestamp = new Date().toLocaleTimeString();
                debugMessages.innerHTML += `<div style="margin-bottom: 5px;"><span style="color: #666;">[${timestamp}]</span> ${message}</div>`;
                debugMessages.scrollTop = debugMessages.scrollHeight;
            }
        }

        function toggleDebug() {
            const debugPanel = document.getElementById('debug-panel');
            if (debugPanel.style.display === 'none') {
                debugPanel.style.display = 'block';
                debugLog('üîß Debug panel opened');
            } else {
                debugPanel.style.display = 'none';
            }
        }

        function debugFormSubmission() {
            debugLog('üöÄ Upload Marks button clicked');

            // Ensure configuration values are updated before submission
            if (document.getElementById('subject').value === 'ENGLISH') {
                const grammarMax = document.getElementById('grammar_max').value;
                const compositionMax = document.getElementById('composition_max').value;
                document.getElementById('hidden_grammar_max').value = grammarMax;
                document.getElementById('hidden_composition_max').value = compositionMax;
                debugLog(`üìù Synced English config: Grammar=${grammarMax}, Composition=${compositionMax}`);
            } else if (document.getElementById('subject').value === 'KISWAHILI') {
                const lughaMax = document.getElementById('lugha_max').value;
                const inshaMax = document.getElementById('insha_max').value;
                document.getElementById('hidden_lugha_max').value = lughaMax;
                document.getElementById('hidden_insha_max').value = inshaMax;
                debugLog(`üìù Synced Kiswahili config: Lugha=${lughaMax}, Insha=${inshaMax}`);
            }

            // Get all form values
            const educationLevel = document.getElementById('education_level').value;
            const subject = document.getElementById('subject').value;
            const grade = document.getElementById('grade').value;
            const stream = document.getElementById('stream').value;
            const term = document.getElementById('term').value;
            const assessmentType = document.getElementById('assessment_type').value;
            const totalMarks = document.getElementById('total_marks').value;

            debugLog('üìã Form values:');
            debugLog('  Education Level: ' + educationLevel);
            debugLog('  Subject: ' + subject);
            debugLog('  Grade: ' + grade);
            debugLog('  Stream: ' + stream);
            debugLog('  Term: ' + term);
            debugLog('  Assessment Type: ' + assessmentType);
            debugLog('  Total Marks: ' + totalMarks);

            // Debug hidden configuration values
            debugLog('üîß Hidden configuration values:');
            debugLog('  Grammar Max: ' + document.getElementById('hidden_grammar_max').value);
            debugLog('  Composition Max: ' + document.getElementById('hidden_composition_max').value);
            debugLog('  Lugha Max: ' + document.getElementById('hidden_lugha_max').value);
            debugLog('  Insha Max: ' + document.getElementById('hidden_insha_max').value);

            // Check for missing values
            const missingFields = [];
            if (!educationLevel) missingFields.push('Education Level');
            if (!subject) missingFields.push('Subject');
            if (!grade) missingFields.push('Grade');
            if (!stream) missingFields.push('Stream');
            if (!term) missingFields.push('Term');
            if (!assessmentType) missingFields.push('Assessment Type');
            if (!totalMarks) missingFields.push('Total Marks');

            if (missingFields.length > 0) {
                debugLog('‚ùå Missing fields: ' + missingFields.join(', '));
            } else {
                debugLog('‚úÖ All fields filled - form should submit');
            }
        }

        // Education level to grades mapping
        const educationLevelGrades = {
            'lower_primary': ['Grade 1', 'Grade 2', 'Grade 3'],
            'upper_primary': ['Grade 4', 'Grade 5', 'Grade 6'],
            'junior_secondary': ['Grade 7', 'Grade 8', 'Grade 9']
        };

        // Function to load grade mapping from server
        function loadGradeMapping() {
            fetch('/teacher/get_grade_mapping')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        gradeMapping = data.mapping;
                        debugLog('‚úÖ Grade mapping loaded: ' + JSON.stringify(gradeMapping));
                    } else {
                        debugLog('‚ùå Failed to load grade mapping: ' + data.message);
                    }
                })
                .catch(error => {
                    debugLog('‚ùå Error loading grade mapping: ' + error);
                });
        }

        // Function to update subjects and grades based on education level
        function updateSubjectsByEducationLevel() {
            debugLog('üîÑ updateSubjectsByEducationLevel called');
            const educationLevelSelect = document.getElementById('education_level');
            const subjectSelect = document.getElementById('subject');
            const gradeSelect = document.getElementById('grade');
            const streamSelect = document.getElementById('stream');
            const educationLevel = educationLevelSelect.value;

            debugLog('üéì Selected education level: ' + educationLevel);

            // Clear existing options
            subjectSelect.innerHTML = '<option value="">Select Subject</option>';
            gradeSelect.innerHTML = '<option value="">Select Grade</option>';
            streamSelect.innerHTML = '<option value="">Select Stream</option>';

            if (educationLevel) {
                // Update grades based on education level
                if (educationLevelGrades[educationLevel]) {
                    educationLevelGrades[educationLevel].forEach(grade => {
                        const option = document.createElement('option');
                        option.value = grade;
                        option.textContent = grade;
                        gradeSelect.appendChild(option);
                    });
                }

                // Update subjects based on education level
                if (subjectsByEducationLevel[educationLevel]) {
                    // Sort subjects with core subjects first
                    const coreSubjects = ['MATHEMATICS', 'ENGLISH', 'KISWAHILI', 'SCIENCE', 'INTEGRATED SCIENCE'];
                    const subjects = subjectsByEducationLevel[educationLevel];

                    subjects.sort((a, b) => {
                        const aIsCore = coreSubjects.some(core => a.toUpperCase().includes(core));
                        const bIsCore = coreSubjects.some(core => b.toUpperCase().includes(core));

                        if (aIsCore && !bIsCore) return -1;
                        if (!aIsCore && bIsCore) return 1;
                        return a.localeCompare(b);
                    });

                    subjects.forEach(subject => {
                        const option = document.createElement('option');
                        option.value = subject;
                        option.textContent = subject;
                        subjectSelect.appendChild(option);
                    });
                }
            }

            // Clear subject info
            hideSubjectInfo();
        }

        // Function to handle subject selection and show composite config
        function handleSubjectSelection() {
            const subjectSelect = document.getElementById('subject');
            const selectedSubject = subjectSelect.value;

            debugLog('üìö Subject selected: ' + selectedSubject);

            // Show/hide composite configuration based on subject
            showCompositeConfig(selectedSubject);

            if (selectedSubject) {
                // Fetch subject information
                fetch(`/teacher/get_subject_info/${encodeURIComponent(selectedSubject)}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            currentSubjectInfo = data.subject;
                            debugLog('üìö Subject info loaded: ' + JSON.stringify(data.subject));
                            debugLog('üîç Is composite: ' + data.subject.is_composite);
                            if (data.subject.components) {
                                debugLog('üîç Components: ' + data.subject.components.length);
                            }
                            showSubjectInfo(data.subject);
                        } else {
                            debugLog('‚ùå Error fetching subject info: ' + data.message);
                            currentSubjectInfo = null;
                            hideSubjectInfo();
                        }
                    })
                    .catch(error => {
                        debugLog('‚ùå Error fetching subject info: ' + error);
                        currentSubjectInfo = null;
                        hideSubjectInfo();
                    });
            } else {
                currentSubjectInfo = null;
                hideSubjectInfo();
            }
        }

        // Function to show/hide composite configuration and total marks field
        function showCompositeConfig(subject) {
            const compositeConfig = document.getElementById('composite-config');
            const englishConfig = document.getElementById('english-config');
            const kiswahiliConfig = document.getElementById('kiswahili-config');
            const totalMarksGroup = document.getElementById('total-marks-group');
            const totalMarksInput = document.getElementById('total_marks');

            console.log(`üéØ showCompositeConfig called for subject: ${subject}`);

            // Simple case-insensitive detection for English and Kiswahili
            const subjectUpper = subject.toUpperCase();

            if (subjectUpper.includes('ENGLISH')) {
                console.log('üéØ Detected English subject - showing composite interface');

                // Show composite config for English
                compositeConfig.style.display = 'block';
                englishConfig.style.display = 'block';
                kiswahiliConfig.style.display = 'none';

                // Hide total marks field and remove required attribute
                totalMarksGroup.style.display = 'none';
                totalMarksInput.removeAttribute('required');

                // Set default values from backend or use defaults
                const currentGrammarMax = '{{ grammar_max_marks }}' || '60';
                const currentCompositionMax = '{{ composition_max_marks }}' || '40';

                document.getElementById('grammar_max').value = currentGrammarMax;
                document.getElementById('composition_max').value = currentCompositionMax;
                updateComponentMaxMarks();

                // Immediately update hidden fields with current values
                document.getElementById('hidden_grammar_max').value = currentGrammarMax;
                document.getElementById('hidden_composition_max').value = currentCompositionMax;

                debugLog('üìö Showing English composite configuration');
                debugLog('üîí Hiding total marks field for composite subject');

            } else if (subjectUpper.includes('KISWAHILI')) {
                console.log('üéØ Detected Kiswahili subject - showing composite interface');

                // Show composite config for Kiswahili
                compositeConfig.style.display = 'block';
                englishConfig.style.display = 'none';
                kiswahiliConfig.style.display = 'block';

                // Hide total marks field and remove required attribute
                totalMarksGroup.style.display = 'none';
                totalMarksInput.removeAttribute('required');

                // Set default values from backend or use defaults
                const currentLughaMax = '{{ lugha_max_marks }}' || '50';
                const currentInshaMax = '{{ insha_max_marks }}' || '50';

                document.getElementById('lugha_max').value = currentLughaMax;
                document.getElementById('insha_max').value = currentInshaMax;
                updateComponentMaxMarks();

                // Immediately update hidden fields with current values
                document.getElementById('hidden_lugha_max').value = currentLughaMax;
                document.getElementById('hidden_insha_max').value = currentInshaMax;

                debugLog('üìö Showing Kiswahili composite configuration');
                debugLog('üîí Hiding total marks field for composite subject');

            } else {
                console.log('üéØ Non-composite subject detected');

                // Hide composite config for regular subjects
                compositeConfig.style.display = 'none';
                englishConfig.style.display = 'none';
                kiswahiliConfig.style.display = 'none';

                // Show total marks field and add required attribute
                totalMarksGroup.style.display = 'block';
                totalMarksInput.setAttribute('required', 'required');

                // Clear the total marks field for manual entry
                totalMarksInput.value = '';

                debugLog('üìö Hiding composite configuration');
                debugLog('üîì Showing total marks field for regular subject');
            }
        }

        // Function to update component max marks and total
        function updateComponentMaxMarks() {
            const subject = document.getElementById('subject').value;
            const subjectUpper = subject.toUpperCase();

            if (subjectUpper.includes('ENGLISH')) {
                const grammarMax = parseInt(document.getElementById('grammar_max').value) || 0;
                const compositionMax = parseInt(document.getElementById('composition_max').value) || 0;
                const total = grammarMax + compositionMax;

                document.getElementById('english_total_display').textContent = total;
                document.getElementById('total_marks').value = total;

                // Update hidden fields for server submission
                document.getElementById('hidden_grammar_max').value = grammarMax;
                document.getElementById('hidden_composition_max').value = compositionMax;

                // Update all grammar input fields
                document.querySelectorAll('.grammar-input').forEach(input => {
                    input.max = grammarMax;
                    input.placeholder = `0-${grammarMax}`;
                    input.setAttribute('data-max-mark', grammarMax);
                });

                // Update all composition input fields
                document.querySelectorAll('.composition-input').forEach(input => {
                    input.max = compositionMax;
                    input.placeholder = `0-${compositionMax}`;
                    input.setAttribute('data-max-mark', compositionMax);
                });

                // Update max mark displays in labels
                document.querySelectorAll('.grammar-max-display').forEach(span => {
                    span.textContent = grammarMax;
                });
                document.querySelectorAll('.composition-max-display').forEach(span => {
                    span.textContent = compositionMax;
                });

                debugLog(`üìä English totals: Grammar ${grammarMax} + Composition ${compositionMax} = ${total}`);
            } else if (subjectUpper.includes('KISWAHILI')) {
                const lughaMax = parseInt(document.getElementById('lugha_max').value) || 0;
                const inshaMax = parseInt(document.getElementById('insha_max').value) || 0;
                const total = lughaMax + inshaMax;

                document.getElementById('kiswahili_total_display').textContent = total;
                document.getElementById('total_marks').value = total;

                // Update hidden fields for server submission
                document.getElementById('hidden_lugha_max').value = lughaMax;
                document.getElementById('hidden_insha_max').value = inshaMax;

                // Update all lugha input fields
                document.querySelectorAll('.lugha-input').forEach(input => {
                    input.max = lughaMax;
                    input.placeholder = `0-${lughaMax}`;
                    input.setAttribute('data-max-mark', lughaMax);
                });

                // Update all insha input fields
                document.querySelectorAll('.insha-input').forEach(input => {
                    input.max = inshaMax;
                    input.placeholder = `0-${inshaMax}`;
                    input.setAttribute('data-max-mark', inshaMax);
                });

                // Update max mark displays in labels
                document.querySelectorAll('.lugha-max-display').forEach(span => {
                    span.textContent = lughaMax;
                });
                document.querySelectorAll('.insha-max-display').forEach(span => {
                    span.textContent = inshaMax;
                });

                debugLog(`üìä Kiswahili totals: Lugha ${lughaMax} + Insha ${inshaMax} = ${total}`);
            }
        }

        // Function to show subject information
        function showSubjectInfo(subjectInfo) {
            const subjectInfoDiv = document.getElementById('subject-info');
            const subjectDetails = document.getElementById('subject-details');

            if (subjectInfo.is_composite && subjectInfo.components.length > 0) {
                let detailsText = `<strong>üìö Composite Subject Components:</strong><br>`;
                subjectInfo.components.forEach(comp => {
                    detailsText += `‚Ä¢ <strong>${comp.name}</strong>: Max ${comp.max_raw_mark} marks<br>`;
                });
                detailsText += `<em>Final percentage will be calculated from total raw marks</em>`;

                subjectDetails.innerHTML = detailsText;
                subjectInfoDiv.style.display = 'block';
            } else {
                subjectDetails.innerHTML = `<strong>üìñ Regular Subject</strong><br>Single assessment entry`;
                subjectInfoDiv.style.display = 'block';
            }
        }

        // Function to hide subject information
        function hideSubjectInfo() {
            const subjectInfoDiv = document.getElementById('subject-info');
            subjectInfoDiv.style.display = 'none';
            currentSubjectInfo = null;
        }

        // Function to update stream options based on selected grade using AJAX
        function updateStreams() {
            const gradeSelect = document.getElementById('grade');
            const streamSelect = document.getElementById('stream');
            const grade = gradeSelect.value;

            // Clear existing options
            streamSelect.innerHTML = '<option value="">Select Stream</option>';

            if (grade) {
                console.log(`üîÑ Fetching streams for ${grade}`);

                // First try to get grade ID from mapping, if available
                if (gradeMapping[grade]) {
                    const gradeId = gradeMapping[grade];
                    console.log(`üìã Using grade ID from mapping: ${gradeId}`);

                    // Fetch streams via AJAX using grade ID
                    fetch(`/teacher/get_streams/${gradeId}`)
                        .then(response => {
                            console.log(`üì° Response status: ${response.status}`);
                            return response.json();
                        })
                        .then(data => {
                            console.log('üì° Streams response:', data);
                            if (data.streams && data.streams.length > 0) {
                                data.streams.forEach(stream => {
                                    const option = document.createElement('option');
                                    option.value = stream.name;
                                    option.textContent = `Stream ${stream.name}`;
                                    streamSelect.appendChild(option);
                                });
                                console.log(`‚úÖ Loaded ${data.streams.length} streams`);
                            } else if (data.error) {
                                console.error('‚ùå Server error:', data.error);
                                streamSelect.innerHTML = '<option value="">Error: ' + data.error + '</option>';
                            } else {
                                streamSelect.innerHTML = '<option value="">No streams available</option>';
                                console.log('‚ö†Ô∏è No streams found');
                            }
                        })
                        .catch(error => {
                            console.error('‚ùå Error fetching streams:', error);
                            streamSelect.innerHTML = '<option value="">Error loading streams</option>';
                        });
                } else {
                    // Fallback: Use a hardcoded mapping if grade mapping isn't loaded yet
                    console.log('‚ö†Ô∏è Grade mapping not loaded, using fallback');
                    const fallbackMapping = {
                        'Grade 1': 3, 'Grade 2': 4, 'Grade 3': 5,
                        'Grade 4': 6, 'Grade 5': 7, 'Grade 6': 8,
                        'Grade 7': 9, 'Grade 8': 1, 'Grade 9': 2
                    };

                    const gradeId = fallbackMapping[grade];
                    if (gradeId) {
                        console.log(`üìã Using fallback grade ID: ${gradeId}`);

                        fetch(`/teacher/get_streams/${gradeId}`)
                            .then(response => {
                                console.log(`üì° Response status: ${response.status}`);
                                return response.json();
                            })
                            .then(data => {
                                console.log('üì° Streams response:', data);
                                if (data.streams && data.streams.length > 0) {
                                    data.streams.forEach(stream => {
                                        const option = document.createElement('option');
                                        option.value = stream.name;
                                        option.textContent = `Stream ${stream.name}`;
                                        streamSelect.appendChild(option);
                                    });
                                    console.log(`‚úÖ Loaded ${data.streams.length} streams`);
                                } else if (data.error) {
                                    console.error('‚ùå Server error:', data.error);
                                    streamSelect.innerHTML = '<option value="">Error: ' + data.error + '</option>';
                                } else {
                                    streamSelect.innerHTML = '<option value="">No streams available</option>';
                                    console.log('‚ö†Ô∏è No streams found');
                                }
                            })
                            .catch(error => {
                                console.error('‚ùå Error fetching streams:', error);
                                streamSelect.innerHTML = '<option value="">Error loading streams</option>';
                            });
                    } else {
                        console.error('‚ùå Grade ID not found for:', grade);
                        streamSelect.innerHTML = '<option value="">Invalid grade</option>';
                    }
                }
            }
        }

        // Function to setup composite subject marks table
        function setupCompositeMarksTable() {
            debugLog('üîß setupCompositeMarksTable called');
            debugLog('üìä currentSubjectInfo: ' + (currentSubjectInfo ? JSON.stringify(currentSubjectInfo) : 'null'));

            if (!currentSubjectInfo || !currentSubjectInfo.is_composite) {
                debugLog('‚ùå Not a composite subject or no subject info');
                return;
            }

            const tableHeader = document.getElementById('table-header');
            const tableBody = document.getElementById('table-body');
            const subjectTypeInfo = document.getElementById('subject-type-info');

            debugLog('üéØ Table elements found: header=' + !!tableHeader + ', body=' + !!tableBody + ', info=' + !!subjectTypeInfo);

            if (!tableHeader || !tableBody) {
                debugLog('‚ùå Required table elements not found');
                return;
            }

            // Update subject type info
            if (subjectTypeInfo) {
                subjectTypeInfo.innerHTML = `
                    <div class="composite-info">
                        <h4>üìö Composite Subject: ${currentSubjectInfo.name}</h4>
                        <p>Enter raw marks for each component. Final percentage will be calculated from total raw marks.</p>
                    </div>
                `;
            }

            // Update table header for composite subjects
            let headerHTML = '<tr><th>Student Name</th>';
            currentSubjectInfo.components.forEach(comp => {
                headerHTML += `<th>${comp.name}<br><small>(Max: ${comp.max_raw_mark} marks)</small></th>`;
            });
            headerHTML += '<th>Total Raw Marks</th><th>Percentage</th></tr>';
            tableHeader.innerHTML = headerHTML;
            debugLog('‚úÖ Table header updated for composite subject');

            // Update table body for composite subjects
            const existingRows = tableBody.querySelectorAll('tr');
            debugLog('üîç Found existing rows: ' + existingRows.length);

            let bodyHTML = '';

            existingRows.forEach((row, index) => {
                const studentNameCell = row.querySelector('td');
                if (studentNameCell) {
                    const studentName = studentNameCell.textContent.trim();
                    const studentKey = studentName.replace(/\s+/g, '_');

                    debugLog('üéì Processing student ' + (index + 1) + ': ' + studentName + ' (key: ' + studentKey + ')');

                    bodyHTML += `<tr data-student="${studentKey}">`;
                    bodyHTML += `<td>${studentName}</td>`;

                    currentSubjectInfo.components.forEach((comp, compIndex) => {
                        debugLog('üìù Adding component ' + (compIndex + 1) + ': ' + comp.name + ' (max: ' + comp.max_raw_mark + ')');
                        bodyHTML += `
                            <td class="component-input-cell">
                                <input type="number"
                                       name="component_${studentKey}_${comp.id}"
                                       min="0"
                                       max="${comp.max_raw_mark}"
                                       placeholder="0"
                                       oninput="updateCompositePercentage('${studentKey}')"
                                       required>
                            </td>
                        `;
                    });

                    bodyHTML += `<td class="total-marks-cell" id="total_marks_${studentKey}">0/${getTotalMaxMarks()}</td>`;
                    bodyHTML += `<td class="percentage-cell" id="composite_percentage_${studentKey}">0%</td>`;
                    bodyHTML += '</tr>';
                }
            });

            debugLog('üîß Generated body HTML length: ' + bodyHTML.length);
            debugLog('üîß Generated body HTML preview: ' + bodyHTML.substring(0, 200) + '...');

            if (bodyHTML) {
                tableBody.innerHTML = bodyHTML;
                debugLog('‚úÖ Composite table body updated with component inputs');

                // Verify the inputs were created
                const componentInputs = tableBody.querySelectorAll('input[name^="component_"]');
                debugLog('üéØ Component inputs created: ' + componentInputs.length);
            } else {
                debugLog('‚ùå No students found to update composite table');
            }
        }

        // Helper function to get total max marks for composite subjects
        function getTotalMaxMarks() {
            if (!currentSubjectInfo || !currentSubjectInfo.is_composite) return 0;
            return currentSubjectInfo.components.reduce((total, comp) => total + comp.max_raw_mark, 0);
        }

        // Proven JavaScript functions from classteacher
        function updateComponentPercentage(inputElement) {
            debugLog("Updating component percentage...");

            // Get the student, subject, and component information from data attributes
            const student = inputElement.dataset.student;
            const subject = inputElement.dataset.subject;
            const component = inputElement.dataset.component;
            const componentWeight = parseFloat(inputElement.dataset.componentWeight) || 1.0;

            // Get the raw mark and max mark
            let rawMark = parseInt(inputElement.value) || 0;
            const maxMark = parseInt(inputElement.dataset.maxMark) || 100;

            // Validate the mark doesn't exceed the maximum
            if (rawMark > maxMark) {
                rawMark = maxMark;
                inputElement.value = maxMark;
            }

            // Calculate the percentage for this component
            const componentPercentage = (rawMark / maxMark) * 100;

            // Update the component percentage display
            const componentPercentageElement = document.getElementById(`component_percentage_${student}_${subject}_${component}`);
            if (componentPercentageElement) {
                componentPercentageElement.textContent = `${componentPercentage.toFixed(1)}%`;
            }

            debugLog(`Component ${component}: ${rawMark}/${maxMark} = ${componentPercentage.toFixed(1)}%`);
        }

        function calculateOverallSubjectMark(student, subject) {
            debugLog(`Calculating overall mark for student: ${student}, subject: ${subject}`);

            // Find all component inputs for this student and subject
            const componentInputs = document.querySelectorAll(`input.component-mark[data-student="${student}"][data-subject="${subject}"]`);
            debugLog(`Found ${componentInputs.length} component inputs`);

            if (componentInputs.length === 0) return;

            let totalWeightedPercentage = 0;
            let totalWeight = 0;
            let debugInfo = [];

            componentInputs.forEach(input => {
                const rawMark = parseInt(input.value) || 0;
                const maxMark = parseInt(input.dataset.maxMark) || 100;
                const weight = parseFloat(input.dataset.componentWeight) || 1.0;
                const component = input.dataset.component;

                // Calculate component percentage
                const componentPercentage = (rawMark / maxMark) * 100;

                // Calculate weighted contribution
                const weightedContribution = componentPercentage * weight;

                totalWeightedPercentage += weightedContribution;
                totalWeight += weight;

                debugInfo.push(`Component ${component}: ${rawMark}/${maxMark} (${componentPercentage.toFixed(1)}%) √ó ${weight} = ${weightedContribution.toFixed(1)}`);
            });

            // Calculate final percentage
            const finalPercentage = totalWeight > 0 ? totalWeightedPercentage / totalWeight : 0;

            debugLog(`Overall calculation: ${debugInfo.join(', ')} = ${finalPercentage.toFixed(1)}%`);

            // Update the overall percentage display
            const overallPercentageElement = document.getElementById(`overall_percentage_${student}_${subject}`);
            if (overallPercentageElement) {
                overallPercentageElement.textContent = `${finalPercentage.toFixed(1)}%`;
            }

            // Update hidden fields for form submission
            const hiddenPercentageField = document.getElementById(`hidden_percentage_${student}_${subject}`);
            if (hiddenPercentageField) {
                hiddenPercentageField.value = finalPercentage.toFixed(2);
            }

            const overallMarkField = document.getElementById(`overall_mark_${student}_${subject}`);
            if (overallMarkField) {
                // Calculate the overall raw mark based on percentage
                const totalMarks = 100; // Default total marks
                const overallRawMark = (finalPercentage / 100) * totalMarks;
                overallMarkField.value = overallRawMark.toFixed(2);
            }
        }

        function updateRegularSubjectPercentage(inputElement) {
            const student = inputElement.dataset.student;
            const subject = inputElement.dataset.subject;
            const rawMark = parseInt(inputElement.value) || 0;
            const maxMark = parseInt(inputElement.dataset.maxMark) || 100;

            // Validate the mark doesn't exceed the maximum
            if (rawMark > maxMark) {
                inputElement.value = maxMark;
                rawMark = maxMark;
            }

            // Calculate percentage
            const percentage = (rawMark / maxMark) * 100;

            // Update percentage display
            const percentageElement = document.getElementById(`percentage_${student}_${subject}`);
            if (percentageElement) {
                percentageElement.textContent = `${percentage.toFixed(1)}%`;
            }

            debugLog(`Regular subject: ${rawMark}/${maxMark} = ${percentage.toFixed(1)}%`);
        }

        // Simple function to update percentage in real-time (like classteacher)
        function updatePercentage(inputElement, studentId) {
            const totalMarks = parseInt(document.getElementsByName('total_marks')[0].value);
            const mark = parseInt(inputElement.value) || 0;

            // Validate mark doesn't exceed total
            if (mark > totalMarks) {
                inputElement.value = totalMarks;
                mark = totalMarks;
            }

            const percentage = (mark / totalMarks) * 100;

            // Update percentage displays
            const percentageCell = document.getElementById(`percentage_${studentId}`);
            const percentageDisplayCell = document.getElementById(`percentage_display_${studentId}`);

            if (percentageCell) {
                percentageCell.textContent = Math.round(percentage) + '%';
            }

            if (percentageDisplayCell) {
                percentageDisplayCell.textContent = Math.round(percentage) + '%';
            }
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            debugLog('üöÄ Teacher dashboard loaded!');
            debugLog('üìä Subjects by education level: ' + JSON.stringify(subjectsByEducationLevel));

            // Check for error messages
            {% if error_message %}
            debugLog('‚ùå Server error: {{ error_message }}');
            {% endif %}

            // Load grade mapping
            loadGradeMapping();

            // Add event listeners for composite configuration inputs
            const grammarMaxInput = document.getElementById('grammar_max');
            const compositionMaxInput = document.getElementById('composition_max');
            const lughaMaxInput = document.getElementById('lugha_max');
            const inshaMaxInput = document.getElementById('insha_max');

            if (grammarMaxInput) {
                grammarMaxInput.addEventListener('input', function() {
                    updateComponentMaxMarks();
                    document.getElementById('hidden_grammar_max').value = this.value;
                    debugLog(`üìù Updated hidden grammar max to: ${this.value}`);
                });
            }
            if (compositionMaxInput) {
                compositionMaxInput.addEventListener('input', function() {
                    updateComponentMaxMarks();
                    document.getElementById('hidden_composition_max').value = this.value;
                    debugLog(`üìù Updated hidden composition max to: ${this.value}`);
                });
            }
            if (lughaMaxInput) {
                lughaMaxInput.addEventListener('input', function() {
                    updateComponentMaxMarks();
                    document.getElementById('hidden_lugha_max').value = this.value;
                    debugLog(`üìù Updated hidden lugha max to: ${this.value}`);
                });
            }
            if (inshaMaxInput) {
                inshaMaxInput.addEventListener('input', function() {
                    updateComponentMaxMarks();
                    document.getElementById('hidden_insha_max').value = this.value;
                    debugLog(`üìù Updated hidden insha max to: ${this.value}`);
                });
            }

            // Initialize education level if set
            const educationLevel = document.getElementById('education_level').value;
            debugLog('üéì Current education level: ' + educationLevel);
            if (educationLevel) {
                debugLog('üîÑ Updating subjects for education level: ' + educationLevel);
                updateSubjectsByEducationLevel();
            }

            // Initialize subject if set and fetch its info
            const subjectSelect = document.getElementById('subject');
            if (subjectSelect && subjectSelect.value) {
                debugLog('üìö Current subject: ' + subjectSelect.value);
                handleSubjectSelection();
            }

            // Check if we're in marks entry mode and setup composite table
            const pupilsList = document.getElementById('pupils-list');
            if (pupilsList) {
                debugLog('üìù In marks entry mode');
                // We're in marks entry mode, get subject from hidden field
                const subjectHidden = document.querySelector('input[name="subject"]');
                if (subjectHidden && subjectHidden.value) {
                    debugLog('üîç Fetching subject info for: ' + subjectHidden.value);
                    // Fetch subject info and setup table
                    fetch(`/teacher/get_subject_info/${encodeURIComponent(subjectHidden.value)}`)
                        .then(response => {
                            debugLog('üì° Subject info response status: ' + response.status);
                            return response.json();
                        })
                        .then(data => {
                            debugLog('üìä Subject info data: ' + JSON.stringify(data));
                            if (data.success) {
                                currentSubjectInfo = data.subject;
                                debugLog('üéØ Subject is composite: ' + data.subject.is_composite);
                                debugLog('üéØ Subject components: ' + JSON.stringify(data.subject.components));

                                if (data.subject.is_composite) {
                                    debugLog('üîß Setting up composite marks table');
                                    // Add a small delay to ensure DOM is ready
                                    setTimeout(() => {
                                        setupCompositeMarksTable();
                                    }, 100);
                                } else {
                                    debugLog('üìñ Regular subject - using standard table');
                                }
                            } else {
                                debugLog('‚ùå Failed to get subject info: ' + data.message);
                            }
                        })
                        .catch(error => {
                            debugLog('‚ùå Error fetching subject info for marks entry: ' + error);
                        });
                } else {
                    debugLog('‚ùå No subject hidden field found');
                }
            } else {
                debugLog('üìã Not in marks entry mode');
            }
        });

        // Helper functions for flexible subject system
        function handleCompositeSubject(subjectType, subjectConfig) {
            const compositeConfig = document.getElementById('composite-config');
            const englishConfig = document.getElementById('english-config');
            const kiswahiliConfig = document.getElementById('kiswahili-config');
            const totalMarksGroup = document.getElementById('total-marks-group');
            const totalMarksInput = document.getElementById('total_marks');

            // Show composite config
            compositeConfig.style.display = 'block';
            totalMarksGroup.style.display = 'none';
            totalMarksInput.removeAttribute('required');

            if (subjectType === 'english') {
                englishConfig.style.display = 'block';
                kiswahiliConfig.style.display = 'none';

                // Set component values from configuration
                const grammarWeight = subjectConfig.components.find(c => c.name === 'Grammar')?.weight || 60;
                const compositionWeight = subjectConfig.components.find(c => c.name === 'Composition')?.weight || 40;

                document.getElementById('grammar_max').value = grammarWeight;
                document.getElementById('composition_max').value = compositionWeight;
                document.getElementById('hidden_grammar_max').value = grammarWeight;
                document.getElementById('hidden_composition_max').value = compositionWeight;

                updateComponentMaxMarks();
                debugLog('üìö Showing English composite configuration');
            } else if (subjectType === 'kiswahili') {
                englishConfig.style.display = 'none';
                kiswahiliConfig.style.display = 'block';

                // Set component values from configuration
                const lughaWeight = subjectConfig.components.find(c => c.name === 'Lugha')?.weight || 50;
                const inshaWeight = subjectConfig.components.find(c => c.name === 'Insha')?.weight || 50;

                document.getElementById('lugha_max').value = lughaWeight;
                document.getElementById('insha_max').value = inshaWeight;
                document.getElementById('hidden_lugha_max').value = lughaWeight;
                document.getElementById('hidden_insha_max').value = inshaWeight;

                updateComponentMaxMarks();
                debugLog('üìö Showing Kiswahili composite configuration');
            }
        }

        function handleNonCompositeSubject() {
            const compositeConfig = document.getElementById('composite-config');
            const englishConfig = document.getElementById('english-config');
            const kiswahiliConfig = document.getElementById('kiswahili-config');
            const totalMarksGroup = document.getElementById('total-marks-group');
            const totalMarksInput = document.getElementById('total_marks');

            // Hide composite config
            compositeConfig.style.display = 'none';
            englishConfig.style.display = 'none';
            kiswahiliConfig.style.display = 'none';

            // Show total marks field
            totalMarksGroup.style.display = 'block';
            totalMarksInput.setAttribute('required', 'required');
            totalMarksInput.value = '';

            debugLog('üìö Showing non-composite subject configuration');
        }
    </script>
</body>
</html>