<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Report Configuration - {{ school_info.school_name or 'Hillview School' }}</title>
  <!-- Inter font for Solar theme -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/classteacher.css') }}" />
  <style>
    :root {
      --solar-bg-1: #fdf6e3; --solar-bg-2: #eee8d5; --solar-bg-3: #d6d2c4;
      --solar-primary: #b58900; --solar-secondary: #268bd2; --solar-green: #859900; --solar-red: #dc322f;
      --solar-text-primary: #002b36; --solar-text-secondary: #073642; --border-color: rgba(238,232,213,.55);
      --shadow-md: 0 14px 34px rgba(0,43,54,.12); --radius: 16px; --radius-lg: 22px;
    }
    body { background: linear-gradient(135deg, var(--solar-bg-1), var(--solar-bg-2) 60%, var(--solar-bg-3)); font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; color: var(--solar-text-primary); }
    .heroicon { display: inline-block; width: 1.15rem; height: 1.15rem; fill: currentColor; vertical-align: middle; }
    .heroicon-lg { width: 1.6rem; height: 1.6rem; }
    .heroicon-solar-yellow { color: var(--solar-primary); }
    .heroicon-solar-blue { color: var(--solar-secondary); }

    .config-container { max-width: 1200px; margin: 18px auto 48px; padding: 0 16px; }
    .back-link { display: inline-flex; align-items: center; gap: 8px; color: var(--solar-text-secondary); background: rgba(253,246,227,.7); padding: 10px 14px; border-radius: 999px; border: 1px solid var(--border-color); text-decoration: none; transition: .25s ease; }
    .back-link:hover { transform: translateY(-2px); box-shadow: 0 8px 18px rgba(0,0,0,.12); }

    .config-card { background: linear-gradient(145deg, rgba(253,246,227,.95), rgba(238,232,213,.9)); backdrop-filter: blur(12px); border-radius: var(--radius-lg); padding: 28px; box-shadow: var(--shadow-md); border: 1px solid var(--border-color); }
    .config-header { text-align: center; margin-bottom: 22px; color: var(--solar-text-primary); }
    .config-header h1 { margin: 0 0 6px; display: inline-flex; gap: 10px; align-items: center; }

    .config-section { margin-bottom: 24px; padding: 18px; border: 1px solid var(--border-color); border-radius: var(--radius); background: #fff; }
    .config-section h3 { display: inline-flex; align-items: center; gap: 8px; color: var(--solar-text-primary); margin: 0 0 12px; border-bottom: 2px solid var(--solar-primary); padding-bottom: 8px; }

    .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; }
    .form-group { margin-bottom: 12px; }
    .form-group label { display: block; margin-bottom: 6px; font-weight: 600; color: var(--solar-text-primary); }
    .form-control { width: 100%; padding: 10px; border: 2px solid var(--border-color); border-radius: 10px; font-size: 14px; transition: .2s ease; }
    .form-control:focus { outline: none; border-color: var(--solar-primary); box-shadow: 0 0 0 3px rgba(181,137,0,.15); }

    .checkbox-group { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-top: 10px; }
    .checkbox-item { display: flex; align-items: center; gap: 10px; padding: 10px; background: #fff; border-radius: 10px; border: 1px solid var(--border-color); }

    .btn-primary { background: var(--solar-secondary); color: #fff; border: none; padding: 12px 30px; border-radius: 10px; font-size: 16px; font-weight: 600; cursor: pointer; transition: .2s ease; width: 100%; margin-top: 16px; display: inline-flex; align-items: center; gap: 8px; justify-content: center; }
    .btn-primary:hover { filter: brightness(0.95); }

    .term-selector { background: rgba(230, 245, 230, .6); padding: 15px; border-radius: 12px; margin-bottom: 18px; border: 1px solid var(--border-color); }
    .alert { padding: 15px; border-radius: 10px; margin-bottom: 16px; }
    .alert-success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .alert-error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
  </style>
</head>
<body>
  <div class="config-container">
    <a href="{{ url_for('classteacher.dashboard') }}" class="back-link">
      <svg class="heroicon" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M9.53 3.97a.75.75 0 010 1.06L4.56 10h15.19a.75.75 0 010 1.5H4.56l4.97 4.97a.75.75 0 11-1.06 1.06l-6.25-6.25a.75.75 0 010-1.06l6.25-6.25a.75.75 0 011.06 0z" clip-rule="evenodd"/></svg>
      Back to Dashboard
    </a>

    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ 'error' if category == 'error' else 'success' }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <div class="config-card">
      <div class="config-header">
        <h1>
          <svg class="heroicon heroicon-lg heroicon-solar-yellow" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M3.75 6A2.25 2.25 0 016 3.75h12A2.25 2.25 0 0120.25 6v12A2.25 2.25 0 0118 20.25H6A2.25 2.25 0 013.75 18V6zM6 5.25a.75.75 0 00-.75.75v12c0 .414.336.75.75.75h12a.75.75 0 00.75-.75V6a.75.75 0 00-.75-.75H6z" clip-rule="evenodd"/></svg>
          Report Configuration
        </h1>
        <p>Configure staff assignments, term dates, and report settings</p>
      </div>

      <!-- Term Selection -->
      <div class="term-selector">
        <h3>
          <svg class="heroicon heroicon-solar-blue" viewBox="0 0 24 24" fill="currentColor"><path d="M6.75 2.25A2.25 2.25 0 004.5 4.5v15A2.25 2.25 0 006.75 21.75h10.5A2.25 2.25 0 0019.5 19.5v-9a.75.75 0 00-.22-.53l-5.25-5.25a.75.75 0 00-.53-.22H6.75z"/></svg>
          Select Term to Configure
        </h3>
        <form method="GET" style="display: inline-block;">
          <select name="term" class="form-control" onchange="this.form.submit()" style="width: auto; display: inline-block;">
            {% for term in terms %}
              <option value="{{ term.name }}" {% if term.name == current_term %}selected{% endif %}>{{ term.name.replace('_', ' ').title() }}</option>
            {% endfor %}
          </select>
        </form>
      </div>

      <!-- Configuration Form -->
      <form method="POST">
        <input type="hidden" name="term" value="{{ current_term }}" />

        <!-- Academic Information -->
        <div class="config-section">
          <h3>
            <svg class="heroicon heroicon-solar-blue" viewBox="0 0 24 24" fill="currentColor"><path d="M11.7 2.37a.75.75 0 01.6 0l8.25 3.75a.75.75 0 010 1.36L12.3 11.23a.75.75 0 01-.6 0L3.45 7.48a.75.75 0 010-1.36L11.7 2.37z"/></svg>
            Academic Information
          </h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="academic_year">Academic Year:</label>
              <input type="text" id="academic_year" name="academic_year" class="form-control" value="{{ config.academic_year if config else '2024/2025' }}" placeholder="e.g., 2024/2025" />
            </div>
          </div>
        </div>

        <!-- Term Dates -->
        <div class="config-section">
          <h3>
            <svg class="heroicon heroicon-solar-blue" viewBox="0 0 24 24" fill="currentColor"><path d="M6.75 3A.75.75 0 016 3.75v.75H4.5A2.25 2.25 0 002.25 6.75v10.5A2.25 2.25 0 004.5 19.5H19.5A2.25 2.25 0 0021.75 17.25V6.75A2.25 2.25 0 0019.5 4.5H18v-.75A.75.75 0 0017.25 3H6.75z"/></svg>
            Term Dates
          </h3>
          <div class="form-grid">
            <div class="form-group">
              <label for="term_start_date">Term Start Date:</label>
              <input type="date" id="term_start_date" name="term_start_date" class="form-control" value="{{ config.term_start_date if config and config.term_start_date else '' }}" />
            </div>
            <div class="form-group">
              <label for="term_end_date">Term End Date:</label>
              <input type="date" id="term_end_date" name="term_end_date" class="form-control" value="{{ config.term_end_date if config and config.term_end_date else '' }}" />
            </div>
            <div class="form-group">
              <label for="closing_date">Closing Date:</label>
              <input type="date" id="closing_date" name="closing_date" class="form-control" value="{{ config.closing_date if config and config.closing_date else '' }}" />
            </div>
            <div class="form-group">
              <label for="opening_date">Next Term Opening Date:</label>
              <input type="date" id="opening_date" name="opening_date" class="form-control" value="{{ config.opening_date if config and config.opening_date else '' }}" />
            </div>
          </div>
        </div>

        <!-- Staff Assignments -->
        <div class="config-section">
          <h3>
            <svg class="heroicon heroicon-solar-blue" viewBox="0 0 24 24" fill="currentColor"><path d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z"/><path fill-rule="evenodd" d="M3 20.25a9 9 0 1118 0v.75H3v-.75z" clip-rule="evenodd"/></svg>
            Staff Assignments
          </h3>
          <div class="form-grid">
            <div class="form-group teacher-select">
              <label for="headteacher_id">Head Teacher:</label>
              <select id="headteacher_id" name="headteacher_id" class="form-control">
                <option value="">Select Head Teacher</option>
                {% for teacher in teachers_by_role.headteacher %}
                  <option value="{{ teacher.id }}" {% if config and config.headteacher_id == teacher.id %}selected{% endif %}>{{ teacher.name }} ({{ teacher.employee_id }})</option>
                {% endfor %}
                {% if not teachers_by_role.headteacher %}
                  {% for teacher in teachers_by_role.all %}
                    <option value="{{ teacher.id }}" {% if config and config.headteacher_id == teacher.id %}selected{% endif %}>{{ teacher.name }} - {{ teacher.role }} ({{ teacher.employee_id }})</option>
                  {% endfor %}
                {% endif %}
              </select>
            </div>

            <div class="form-group teacher-select">
              <label for="deputy_headteacher_id">Deputy Head Teacher:</label>
              <select id="deputy_headteacher_id" name="deputy_headteacher_id" class="form-control">
                <option value="">Select Deputy Head Teacher</option>
                {% for teacher in teachers_by_role.deputy %}
                  <option value="{{ teacher.id }}" {% if config and config.deputy_headteacher_id == teacher.id %}selected{% endif %}>{{ teacher.name }} ({{ teacher.employee_id }})</option>
                {% endfor %}
                {% if not teachers_by_role.deputy %}
                  {% for teacher in teachers_by_role.all %}
                    <option value="{{ teacher.id }}" {% if config and config.deputy_headteacher_id == teacher.id %}selected{% endif %}>{{ teacher.name }} - {{ teacher.role }} ({{ teacher.employee_id }})</option>
                  {% endfor %}
                {% endif %}
              </select>
            </div>

            <div class="form-group teacher-select">
              <label for="principal_id">Principal:</label>
              <select id="principal_id" name="principal_id" class="form-control">
                <option value="">Select Principal</option>
                {% for teacher in teachers_by_role.principal %}
                  <option value="{{ teacher.id }}" {% if config and config.principal_id == teacher.id %}selected{% endif %}>{{ teacher.name }} ({{ teacher.employee_id }})</option>
                {% endfor %}
                {% if not teachers_by_role.principal %}
                  {% for teacher in teachers_by_role.all %}
                    <option value="{{ teacher.id }}" {% if config and config.principal_id == teacher.id %}selected{% endif %}>{{ teacher.name }} - {{ teacher.role }} ({{ teacher.employee_id }})</option>
                  {% endfor %}
                {% endif %}
              </select>
            </div>
          </div>
        </div>

        <!-- Report Visibility Settings -->
        <div class="config-section">
          <h3>
            <svg class="heroicon heroicon-solar-blue" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M4.5 3.75A.75.75 0 015.25 3h13.5a.75.75 0 01.75.75v9a.75.75 0 01-.75.75h-8.69l-2.53 2.53A.75.75 0 017 15.75V13.5H5.25a.75.75 0 01-.75-.75v-9z" clip-rule="evenodd"/></svg>
            Report Visibility Settings
          </h3>
          <p style="color: var(--solar-text-secondary); margin-bottom: 12px;">Select which staff positions should appear on generated reports:</p>
          <div class="checkbox-group">
            <div class="checkbox-item">
              <input type="checkbox" id="show_class_teacher" name="show_class_teacher" {% if not config or config.show_class_teacher %}checked{% endif %} />
              <label for="show_class_teacher">Show Class Teacher</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="show_headteacher" name="show_headteacher" {% if not config or config.show_headteacher %}checked{% endif %} />
              <label for="show_headteacher">Show Head Teacher</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="show_deputy_headteacher" name="show_deputy_headteacher" {% if not config or config.show_deputy_headteacher %}checked{% endif %} />
              <label for="show_deputy_headteacher">Show Deputy Head Teacher</label>
            </div>
            <div class="checkbox-item">
              <input type="checkbox" id="show_principal" name="show_principal" {% if config and config.show_principal %}checked{% endif %} />
              <label for="show_principal">Show Principal</label>
            </div>
          </div>
        </div>

        <button type="submit" class="btn-primary">
          <svg class="heroicon" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M4.5 12a7.5 7.5 0 1112.53 5.303l3.184 3.183a.75.75 0 11-1.06 1.06l-3.183-3.183A7.5 7.5 0 014.5 12zm7.5-3.75a.75.75 0 00-.75.75v2.25H9a.75.75 0 000 1.5h2.25V15a.75.75 0 001.5 0v-2.25H15a.75.75 0 000-1.5h-2.25V9a.75.75 0 00-.75-.75z" clip-rule="evenodd"/></svg>
          Save Configuration
        </button>
      </form>
    </div>
  </div>
</body>
</html>
