<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0"
    />
    <meta name="csrf-token" content="{{ csrf_token() }}" />
    <meta
      name="description"
      content="Admin Dashboard - {{ school_info.school_name|default('Hillview School') }} Management System"
    />
    <meta name="format-detection" content="telephone=no" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="theme-color" content="#268bd2" />

    <title>
      Admin Dashboard - {{ school_info.school_name|default('Hillview School
      Management System') }}
    </title>

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" />

    <!-- Modern Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- Icons -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
      integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />

    <!-- External CSS Files -->
    <link rel="stylesheet" href="/static/css/admin-base.css" />
    <link rel="stylesheet" href="/static/css/admin-forms.css" />
    <link rel="stylesheet" href="/static/css/admin-components.css" />
    <link rel="stylesheet" href="/static/css/admin-layout.css" />
  </head>

  <body class="solar-theme">
    <!-- Error Message Section -->
    {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
    {% endif %}

    <!-- Confirmation Message Section -->
    {% if message %}
    <div class="alert alert-success">{{ message }}</div>
    {% endif %}

    <div class="app-container">
      <!-- Sidebar -->
      <div class="sidebar">
        <div class="sidebar-header">
          <div class="sidebar-logo">
            <img
              src="/static/images/logo.png"
              alt="{{ school_info.school_name|default('Hillview School') }} Logo"
            />
            <h1>Admin Portal</h1>
          </div>
          <button class="sidebar-toggle" id="sidebar-close">
            <i class="fas fa-times"></i>
          </button>
        </div>

        <div class="sidebar-body">
          <div class="nav-section">
            <div class="nav-section-title">Main</div>
            <ul class="nav">
              <li class="nav-item">
                <a
                  href="/admin/dashboard"
                  class="nav-link {% if active_page == 'dashboard' %}active{% endif %}"
                >
                  <i class="fas fa-tachometer-alt"></i> Dashboard
                </a>
              </li>
              <li class="nav-item">
                <a
                  href="/admin/users"
                  class="nav-link {% if active_page == 'users' %}active{% endif %}"
                >
                  <i class="fas fa-users"></i> Users
                </a>
              </li>
              <li class="nav-item">
                <a
                  href="/admin/classes"
                  class="nav-link {% if active_page == 'classes' %}active{% endif %}"
                >
                  <i class="fas fa-chalkboard"></i> Classes
                </a>
              </li>
              <li class="nav-item">
                <a
                  href="/admin/subjects"
                  class="nav-link {% if active_page == 'subjects' %}active{% endif %}"
                >
                  <i class="fas fa-book"></i> Subjects
                </a>
              </li>
            </ul>
          </div>

          <div class="nav-section">
            <div class="nav-section-title">Management</div>
            <ul class="nav">
              <li class="nav-item">
                <a
                  href="/admin/teachers"
                  class="nav-link {% if active_page == 'teachers' %}active{% endif %}"
                >
                  <i class="fas fa-chalkboard-teacher"></i> Teachers
                </a>
              </li>
              <li class="nav-item">
                <a
                  href="/admin/students"
                  class="nav-link {% if active_page == 'students' %}active{% endif %}"
                >
                  <i class="fas fa-user-graduate"></i> Students
                </a>
              </li>
              <li class="nav-item">
                <a
                  href="/admin/parents"
                  class="nav-link {% if active_page == 'parents' %}active{% endif %}"
                >
                  <i class="fas fa-user-friends"></i> Parents
                </a>
              </li>
              <li class="nav-item">
                <a
                  href="/admin/assignments"
                  class="nav-link {% if active_page == 'assignments' %}active{% endif %}"
                >
                  <i class="fas fa-tasks"></i> Assignments
                </a>
              </li>
              <li class="nav-item">
                <a
                  href="/admin/exams"
                  class="nav-link {% if active_page == 'exams' %}active{% endif %}"
                >
                  <i class="fas fa-file-alt"></i> Exams
                </a>
              </li>
              <li class="nav-item">
                <a
                  href="/admin/grades"
                  class="nav-link {% if active_page == 'grades' %}active{% endif %}"
                >
                  <i class="fas fa-chart-line"></i> Grades
                </a>
              </li>
            </ul>
          </div>

          <div class="nav-section">
            <div class="nav-section-title">System</div>
            <ul class="nav">
              <li class="nav-item">
                <a
                  href="/admin/settings"
                  class="nav-link {% if active_page == 'settings' %}active{% endif %}"
                >
                  <i class="fas fa-cogs"></i> Settings
                </a>
              </li>
              <li class="nav-item">
                <a
                  href="/admin/logs"
                  class="nav-link {% if active_page == 'logs' %}active{% endif %}"
                >
                  <i class="fas fa-list"></i> Logs
                </a>
              </li>
              <li class="nav-item">
                <a
                  href="/admin/backups"
                  class="nav-link {% if active_page == 'backups' %}active{% endif %}"
                >
                  <i class="fas fa-database"></i> Backups
                </a>
              </li>
              <li class="nav-item">
                <a
                  href="/admin/notifications"
                  class="nav-link {% if active_page == 'notifications' %}active{% endif %}"
                >
                  <i class="fas fa-bell"></i> Notifications
                </a>
              </li>
            </ul>
          </div>
        </div>

        <div class="sidebar-footer">
          <div class="nav">
            <a href="/admin/profile" class="nav-link">
              <i class="fas fa-user-circle"></i> Profile
            </a>
            <a href="/logout" class="nav-link">
              <i class="fas fa-sign-out-alt"></i> Logout
            </a>
          </div>
        </div>
      </div>

      <div class="content-wrapper">
        <!-- Navbar -->
        <div class="navbar">
          <div class="navbar-left">
            <button id="menu-toggle" class="navbar-toggle">
              <i class="fas fa-bars"></i>
            </button>

            <h3 class="navbar-title">
              {{ page_title|default('Admin Dashboard') }}
            </h3>

            <ul class="navbar-breadcrumb d-none d-md-flex">
              <li class="navbar-breadcrumb-item">
                <a href="/admin/dashboard" class="navbar-breadcrumb-link"
                  >Home</a
                >
              </li>
              {% if breadcrumb %}
              <li class="navbar-breadcrumb-item">
                <a href="{{ breadcrumb.url }}" class="navbar-breadcrumb-link"
                  >{{ breadcrumb.text }}</a
                >
              </li>
              {% endif %}
            </ul>
          </div>

          <div class="navbar-right">
            <div class="navbar-search">
              <form action="/admin/search" method="GET">
                <i class="fas fa-search navbar-search-icon"></i>
                <input
                  type="text"
                  class="navbar-search-input"
                  placeholder="Search..."
                  name="q"
                />
              </form>
            </div>

            <div class="navbar-menu">
              <div class="navbar-menu-item">
                <button class="navbar-menu-btn notification-btn">
                  <i class="fas fa-bell"></i>
                  {% if notifications_count > 0 %}
                  <span class="badge badge-danger"
                    >{{ notifications_count }}</span
                  >
                  {% endif %}
                </button>

                <div class="dropdown-menu notification-dropdown">
                  <div
                    class="dropdown-header d-flex justify-content-between align-items-center"
                  >
                    <h6 class="mb-0">Notifications</h6>
                    <a href="/admin/notifications" class="text-muted"
                      >View All</a
                    >
                  </div>

                  <div class="dropdown-divider"></div>

                  <div class="notification-list-wrapper">
                    {% if notifications %}
                    <ul class="notification-list">
                      {% for notification in notifications %}
                      <li
                        class="notification-item {% if not notification.read %}unread{% endif %}"
                      >
                        <div class="notification-icon">
                          <i class="fas fa-{{ notification.icon }}"></i>
                        </div>
                        <div class="notification-content">
                          <p class="notification-text">
                            {{ notification.message }}
                          </p>
                          <p class="notification-time">
                            {{ notification.time }}
                          </p>
                        </div>
                      </li>
                      {% endfor %}
                    </ul>
                    {% else %}
                    <p class="text-center py-3">No new notifications</p>
                    {% endif %}
                  </div>
                </div>
              </div>

              <div class="navbar-user">
                <img
                  src="{{ admin.avatar|default('/static/images/avatar.jpg') }}"
                  alt="{{ admin.name }}"
                  class="navbar-user-avatar"
                />

                <div class="navbar-user-info d-none d-md-block">
                  <p class="navbar-user-name">{{ admin.name }}</p>
                  <p class="navbar-user-role">Administrator</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
          {% block content %}
          <div class="page-header">
            <h1 class="page-title">Welcome, {{ admin.name }}</h1>
            <p class="page-subtitle">System Overview</p>
          </div>

          <div class="dashboard-stats">
            <div class="row">
              <div class="col-md-3 col-sm-6">
                <div class="stat-card">
                  <div class="stat-card-icon bg-primary">
                    <i class="fas fa-user-graduate"></i>
                  </div>
                  <div class="stat-card-info">
                    <h4 class="stat-card-title">Students</h4>
                    <p class="stat-card-value">{{ stats.students_count }}</p>
                    <p
                      class="stat-card-change {% if stats.students_change >= 0 %}text-success{% else %}text-danger{% endif %}"
                    >
                      <i
                        class="fas fa-{% if stats.students_change >= 0 %}arrow-up{% else %}arrow-down{% endif %}"
                      ></i>
                      {{ stats.students_change|abs }}% from last month
                    </p>
                  </div>
                </div>
              </div>

              <div class="col-md-3 col-sm-6">
                <div class="stat-card">
                  <div class="stat-card-icon bg-secondary">
                    <i class="fas fa-chalkboard-teacher"></i>
                  </div>
                  <div class="stat-card-info">
                    <h4 class="stat-card-title">Teachers</h4>
                    <p class="stat-card-value">{{ stats.teachers_count }}</p>
                    <p
                      class="stat-card-change {% if stats.teachers_change >= 0 %}text-success{% else %}text-danger{% endif %}"
                    >
                      <i
                        class="fas fa-{% if stats.teachers_change >= 0 %}arrow-up{% else %}arrow-down{% endif %}"
                      ></i>
                      {{ stats.teachers_change|abs }}% from last month
                    </p>
                  </div>
                </div>
              </div>

              <div class="col-md-3 col-sm-6">
                <div class="stat-card">
                  <div class="stat-card-icon bg-success">
                    <i class="fas fa-book"></i>
                  </div>
                  <div class="stat-card-info">
                    <h4 class="stat-card-title">Subjects</h4>
                    <p class="stat-card-value">{{ stats.subjects_count }}</p>
                    <p
                      class="stat-card-change {% if stats.subjects_change >= 0 %}text-success{% else %}text-danger{% endif %}"
                    >
                      <i
                        class="fas fa-{% if stats.subjects_change >= 0 %}arrow-up{% else %}arrow-down{% endif %}"
                      ></i>
                      {{ stats.subjects_change|abs }}% from last month
                    </p>
                  </div>
                </div>
              </div>

              <div class="col-md-3 col-sm-6">
                <div class="stat-card">
                  <div class="stat-card-icon bg-info">
                    <i class="fas fa-chalkboard"></i>
                  </div>
                  <div class="stat-card-info">
                    <h4 class="stat-card-title">Classes</h4>
                    <p class="stat-card-value">{{ stats.classes_count }}</p>
                    <p
                      class="stat-card-change {% if stats.classes_change >= 0 %}text-success{% else %}text-danger{% endif %}"
                    >
                      <i
                        class="fas fa-{% if stats.classes_change >= 0 %}arrow-up{% else %}arrow-down{% endif %}"
                      ></i>
                      {{ stats.classes_change|abs }}% from last month
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="admin-dashboard-layout">
            <div class="dashboard-main">
              <!-- System Overview -->
              <div class="card">
                <div class="card-header">
                  <h3>System Overview</h3>
                  <button
                    id="refresh-dashboard"
                    class="btn btn-sm btn-outline-primary"
                  >
                    <i class="fas fa-sync-alt"></i> Refresh
                  </button>
                </div>
                <div class="card-body">
                  <div
                    id="system-performance-chart"
                    data-stats="{{ system_stats|tojson }}"
                  ></div>
                </div>
              </div>

              <!-- User Registration -->
              <div class="card">
                <div class="card-header">
                  <h3>User Registration</h3>
                  <div class="card-header-actions">
                    <div class="btn-group">
                      <button
                        class="btn btn-sm btn-outline-secondary active"
                        data-period="day"
                      >
                        Day
                      </button>
                      <button
                        class="btn btn-sm btn-outline-secondary"
                        data-period="week"
                      >
                        Week
                      </button>
                      <button
                        class="btn btn-sm btn-outline-secondary"
                        data-period="month"
                      >
                        Month
                      </button>
                    </div>
                  </div>
                </div>
                <div class="card-body">
                  <div
                    id="user-registration-chart"
                    data-stats="{{ registration_stats|tojson }}"
                  ></div>
                </div>
              </div>

              <!-- Recent Activities -->
              <div class="card">
                <div class="card-header">
                  <h3>Recent Activities</h3>
                  <a href="/admin/logs" class="btn btn-sm btn-link">View All</a>
                </div>
                <div class="card-body">
                  {% if activities %}
                  <div class="activity-list">
                    {% for activity in activities %}
                    <div class="activity-item">
                      <div class="activity-icon bg-{{ activity.level }}">
                        <i class="fas fa-{{ activity.icon }}"></i>
                      </div>
                      <div class="activity-content">
                        <p class="activity-text">{{ activity.message }}</p>
                        <p class="activity-meta">
                          <span class="activity-user">{{ activity.user }}</span>
                          <span class="activity-time">{{ activity.time }}</span>
                        </p>
                      </div>
                    </div>
                    {% endfor %}
                  </div>
                  {% else %}
                  <p class="empty-state">No recent activities</p>
                  {% endif %}
                </div>
              </div>
            </div>

            <div class="dashboard-sidebar">
              <!-- Quick Actions -->
              <div class="card">
                <div class="card-header">
                  <h3>Quick Actions</h3>
                </div>
                <div class="card-body">
                  <div class="quick-actions-grid">
                    <a href="/admin/users/add" class="quick-action-item">
                      <i class="fas fa-user-plus"></i>
                      <span>Add User</span>
                    </a>
                    <a href="/admin/classes/add" class="quick-action-item">
                      <i class="fas fa-plus-circle"></i>
                      <span>Add Class</span>
                    </a>
                    <a href="/admin/subjects/add" class="quick-action-item">
                      <i class="fas fa-book-medical"></i>
                      <span>Add Subject</span>
                    </a>
                    <a
                      href="/admin/notifications/create"
                      class="quick-action-item"
                    >
                      <i class="fas fa-bell"></i>
                      <span>Send Notice</span>
                    </a>
                    <a href="/admin/reports" class="quick-action-item">
                      <i class="fas fa-chart-bar"></i>
                      <span>Reports</span>
                    </a>
                    <a href="/admin/settings" class="quick-action-item">
                      <i class="fas fa-cogs"></i>
                      <span>Settings</span>
                    </a>
                  </div>
                </div>
              </div>

              <!-- System Status -->
              <div class="card">
                <div class="card-header">
                  <h3>System Status</h3>
                </div>
                <div class="card-body">
                  <div class="status-list">
                    <div class="status-item">
                      <div class="status-label">Server Status</div>
                      <div class="status-value">
                        <span class="badge badge-success">Online</span>
                      </div>
                    </div>
                    <div class="status-item">
                      <div class="status-label">Database</div>
                      <div class="status-value">
                        <span class="badge badge-success">Connected</span>
                      </div>
                    </div>
                    <div class="status-item">
                      <div class="status-label">Storage</div>
                      <div class="status-value">
                        <div class="progress">
                          <div
                            class="progress-bar"
                            role="progressbar"
                            style="width: 65%"
                            aria-valuenow="65"
                            aria-valuemin="0"
                            aria-valuemax="100"
                          >
                            65%
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="status-item">
                      <div class="status-label">Memory Usage</div>
                      <div class="status-value">
                        <div class="progress">
                          <div
                            class="progress-bar bg-warning"
                            role="progressbar"
                            style="width: 78%"
                            aria-valuenow="78"
                            aria-valuemin="0"
                            aria-valuemax="100"
                          >
                            78%
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="status-item">
                      <div class="status-label">CPU Load</div>
                      <div class="status-value">
                        <div class="progress">
                          <div
                            class="progress-bar bg-info"
                            role="progressbar"
                            style="width: 45%"
                            aria-valuenow="45"
                            aria-valuemin="0"
                            aria-valuemax="100"
                          >
                            45%
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="status-item">
                      <div class="status-label">Last Backup</div>
                      <div class="status-value">
                        <span class="text-muted">2023-06-18 02:30 AM</span>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="card-footer">
                  <a
                    href="/admin/system/diagnostics"
                    class="btn btn-sm btn-primary w-100"
                    >Run Diagnostics</a
                  >
                </div>
              </div>

              <!-- Recent Logins -->
              <div class="card">
                <div class="card-header">
                  <h3>Recent Logins</h3>
                </div>
                <div class="card-body">
                  {% if recent_logins %}
                  <div class="login-list">
                    {% for login in recent_logins %}
                    <div class="login-item">
                      <div class="login-item-avatar">
                        <img
                          src="{{ login.avatar|default('/static/images/avatar.jpg') }}"
                          alt="{{ login.name }}"
                        />
                      </div>
                      <div class="login-item-details">
                        <h4 class="login-item-name">{{ login.name }}</h4>
                        <p class="login-item-meta">
                          <span class="login-item-role">{{ login.role }}</span>
                          <span class="login-item-time">{{ login.time }}</span>
                        </p>
                      </div>
                      <div class="login-item-status">
                        <span class="badge badge-{{ login.status_class }}"
                          >{{ login.status }}</span
                        >
                      </div>
                    </div>
                    {% endfor %}
                  </div>
                  {% else %}
                  <p class="empty-state">No recent logins</p>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
          {% endblock %}
        </div>
      </div>
    </div>

    <footer>
      <p>
        © 2025 {{ school_info.school_name|default('Hillview School') }} - Admin
        Portal v2.5
      </p>
    </footer>

    <!-- External JavaScript -->
    <script src="/static/js/admin-main.js"></script>
    <script src="/static/js/admin-dashboard.js"></script>
    <script src="/static/js/admin-users.js"></script>
    <script src="/static/js/admin-utils.js"></script>
  </body>
</html>
