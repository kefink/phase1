<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=yes, maximum-scale=5.0"
    />
    <meta
      name="description"
      content="Headteacher Dashboard - {{ school_info.school_name or 'Hillview School' }} Management System"
    />
    <meta name="format-detection" content="telephone=no" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="theme-color" content="#b58900" />

    <title>
      Headteacher Dashboard - {{ school_info.school_name or 'Hillview School
      Management System' }}
    </title>

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" />

    <!-- Professional Solar Theme Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- Heroicons - Premium SVG Icons (No external dependencies, guaranteed display) -->
    <!-- Professional icons by the makers of Tailwind CSS -->
    <style>
      /* Heroicons SVG Icon Base Styles */
      .heroicon {
        display: inline-block;
        width: 1.25rem;
        height: 1.25rem;
        fill: currentColor;
        vertical-align: middle;
      }

      .heroicon-lg {
        width: 1.8rem;
        height: 1.8rem;
      }

      .heroicon-xl {
        width: 2rem;
        height: 2rem;
      }

      /* Icon color inheritance and styling */
      .stat-icon .heroicon {
        width: 1.8rem;
        height: 1.8rem;
        color: white;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
      }
    </style>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- jsPDF for PDF export -->
    <script src="https://unpkg.com/jspdf@latest/dist/jspdf.umd.min.js"></script>

    <!-- html2canvas for chart capture -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <!-- External CSS Files for Solar Theme -->
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/classteacher-base.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/classteacher-forms.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/classteacher-buttons.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/classteacher-navbar.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/classteacher-flexbox.css') }}"
    />

    <!-- Premium Headteacher Dashboard Styling -->
    <style>
      /* Premium Page Header */
      .page-header {
        background: linear-gradient(
          135deg,
          rgba(253, 246, 227, 0.85) 0%,
          rgba(238, 232, 213, 0.65) 100%
        );
        border: 1px solid rgba(181, 137, 0, 0.18);
        border-radius: 16px;
        padding: 1rem 1.25rem;
        margin: 0 0 1.5rem 0;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        box-shadow: 0 6px 20px rgba(0, 43, 54, 0.08);
      }

      .page-title h1 {
        margin: 0 0 0.25rem 0;
        font-size: 1.6rem;
        font-weight: 800;
        letter-spacing: -0.02em;
        background: linear-gradient(135deg, #002b36, #073642);
        -webkit-background-clip: text;
        background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .page-title p {
        margin: 0;
        color: #586e75;
        font-weight: 500;
      }

      .page-actions {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 0.5rem;
      }

      .page-actions .btn,
      .page-actions .btn-outline {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        border-radius: 10px;
        padding: 0.55rem 0.9rem;
      }

      .page-actions .btn .heroicon,
      .page-actions .btn-outline .heroicon {
        width: 1rem;
        height: 1rem;
      }

      .btn-label {
        display: inline;
      }

      /* Keyboard focus for buttons */
      .btn:focus-visible,
      .btn-outline:focus-visible {
        outline: 2px solid #b58900 !important;
        outline-offset: 2px !important;
      }

      /* Responsive: stack header, condense labels on small screens */
      @media (max-width: 768px) {
        .page-header {
          flex-direction: column;
          align-items: stretch;
          text-align: center;
          gap: 0.75rem;
          padding: 0.9rem 0.9rem;
        }
        .page-actions {
          justify-content: center;
        }
      }

      /* Optional compact mode: auto-hide header subtitle on mid-sized screens */
      @media (min-width: 900px) and (max-width: 1199px) {
        .page-header .page-title p {
          display: none !important;
        }
      }

      @media (max-width: 520px) {
        .page-actions {
          gap: 0.4rem;
        }
        .page-actions .btn,
        .page-actions .btn-outline {
          padding: 0.5rem 0.6rem;
          min-width: 44px;
          min-height: 44px;
        }
        .btn-label {
          display: none; /* keep icons only on very small screens */
        }
      }
      /* Solar Theme Body Background */
      body.solar-theme {
        margin: 0;
        padding: 0;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(
          135deg,
          #fdf6e3 0%,
          #eee8d5 50%,
          #d6d2c4 100%
        );
        min-height: 100vh;
        overflow-x: hidden;
      }

      .dashboard-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
        background: transparent;
        min-height: 100vh;
      }

      /* Premium Stats Grid Layout */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-bottom: 3rem;
        padding: 0;
      }

      /* Premium Stat Card Design */
      .stat-card {
        background: linear-gradient(
          145deg,
          rgba(253, 246, 227, 0.95) 0%,
          rgba(238, 232, 213, 0.9) 100%
        );
        backdrop-filter: blur(10px);
        border: 1px solid rgba(181, 137, 0, 0.2);
        border-radius: 16px;
        padding: 2rem;
        position: relative;
        overflow: hidden;
        transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        box-shadow: 0 8px 32px rgba(0, 43, 54, 0.1),
          0 4px 16px rgba(181, 137, 0, 0.05),
          inset 0 1px 0 rgba(253, 246, 227, 0.5);
        transform: translateY(0);
      }

      .stat-card::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(
          90deg,
          #b58900 0%,
          #859900 50%,
          #268bd2 100%
        );
        transform: scaleX(0);
        transform-origin: left;
        transition: transform 0.6s ease;
      }

      .stat-card:hover {
        transform: translateY(-8px) scale(1.02);
        box-shadow: 0 20px 40px rgba(0, 43, 54, 0.15),
          0 8px 24px rgba(181, 137, 0, 0.1),
          inset 0 1px 0 rgba(253, 246, 227, 0.8);
        border-color: rgba(181, 137, 0, 0.4);
      }

      .stat-card:hover::before {
        transform: scaleX(1);
      }

      /* Enhanced Icon Design */
      .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 1.5rem;
        position: relative;
        transition: all 0.3s ease;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        flex-shrink: 0;
        overflow: visible;
        z-index: 2;
      }

      .stat-icon::after {
        content: "";
        position: absolute;
        inset: -2px;
        border-radius: 18px;
        padding: 2px;
        background: linear-gradient(
          45deg,
          transparent,
          rgba(181, 137, 0, 0.3),
          transparent
        );
        mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        mask-composite: subtract;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .stat-card:hover .stat-icon::after {
        opacity: 1;
      }

      .stat-icon.primary {
        background: linear-gradient(135deg, #268bd2 0%, #2aa198 100%);
        color: white;
        box-shadow: 0 6px 20px rgba(38, 139, 210, 0.4);
      }

      .stat-icon.success {
        background: linear-gradient(135deg, #859900 0%, #b58900 100%);
        color: white;
        box-shadow: 0 6px 20px rgba(181, 137, 0, 0.4);
      }

      .stat-icon.info {
        background: linear-gradient(135deg, #6c71c4 0%, #268bd2 100%);
        color: white;
        box-shadow: 0 6px 20px rgba(108, 113, 196, 0.4);
      }

      .stat-icon.warning {
        background: linear-gradient(135deg, #cb4b16 0%, #dc322f 100%);
        color: white;
        box-shadow: 0 6px 20px rgba(220, 50, 47, 0.4);
      }

      /* Enhanced hover effects for icons */
      .stat-card:hover .stat-icon {
        transform: scale(1.1) rotate(5deg);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      }

      .stat-card:hover .stat-icon.primary {
        box-shadow: 0 8px 25px rgba(38, 139, 210, 0.5);
      }

      .stat-card:hover .stat-icon.success {
        box-shadow: 0 8px 25px rgba(181, 137, 0, 0.5);
      }

      .stat-card:hover .stat-icon.info {
        box-shadow: 0 8px 25px rgba(108, 113, 196, 0.5);
      }

      .stat-card:hover .stat-icon.warning {
        box-shadow: 0 8px 25px rgba(220, 50, 47, 0.5);
      }

      /* Premium Typography */
      .stat-content {
        flex: 1;
      }

      .stat-number {
        font-size: 2.5rem;
        font-weight: 800;
        color: #002b36;
        margin-bottom: 0.5rem;
        background: linear-gradient(135deg, #002b36 0%, #073642 100%);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        line-height: 1.1;
        letter-spacing: -0.02em;
        transition: all 0.3s ease;
      }

      .stat-card:hover .stat-number {
        transform: scale(1.05);
        text-shadow: 0 2px 8px rgba(0, 43, 54, 0.1);
      }

      .stat-label {
        font-size: 1rem;
        font-weight: 600;
        color: #586e75;
        margin-bottom: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        transition: color 0.3s ease;
      }

      .stat-card:hover .stat-label {
        color: #073642;
      }

      .stat-trend {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
        color: #93a1a1;
        font-weight: 500;
        transition: all 0.3s ease;
      }

      .stat-trend i {
        opacity: 0.8;
        transition: all 0.3s ease;
      }

      .stat-card:hover .stat-trend {
        color: #586e75;
      }

      .stat-card:hover .stat-trend i {
        opacity: 1;
        transform: scale(1.1);
      }

      /* Special styling for performance indicators */
      .stat-trend.neutral {
        color: #839496;
      }

      .stat-card:hover .stat-trend.neutral {
        color: #657b83;
      }

      /* Animation keyframes */
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(30px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .animate-fade-in-up {
        animation: fadeInUp 0.8s ease-out forwards;
        opacity: 0;
      }

      /* Loading state for stat cards */
      .loading-state .stat-icon {
        position: relative;
        overflow: hidden;
      }

      .loading-state .stat-icon::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: iconShimmer 2s infinite;
        z-index: 1;
      }

      @keyframes iconShimmer {
        0% {
          left: -100%;
        }
        100% {
          left: 100%;
        }
      }

      /* Remove loading state after icons are enhanced */
      .icons-loaded .loading-state .stat-icon::before {
        display: none;
      }

      /* Premium Section Header Styling */
      .stats-section {
        margin: 3rem 0;
      }

      .premium-header {
        background: linear-gradient(
          135deg,
          rgba(253, 246, 227, 0.8) 0%,
          rgba(238, 232, 213, 0.6) 100%
        );
        backdrop-filter: blur(15px);
        border: 1px solid rgba(181, 137, 0, 0.15);
        border-radius: 20px;
        padding: 2rem 2.5rem;
        margin-bottom: 2rem;
        display: flex;
        align-items: center;
        justify-content: space-between;
        flex-wrap: wrap;
        gap: 1.5rem;
        position: relative;
        overflow: hidden;
        box-shadow: 0 8px 32px rgba(0, 43, 54, 0.08),
          0 2px 16px rgba(181, 137, 0, 0.05);
      }

      .premium-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 2px;
        background: linear-gradient(90deg, transparent, #b58900, transparent);
        animation: shimmer 3s infinite;
      }

      @keyframes shimmer {
        0% {
          left: -100%;
        }
        100% {
          left: 100%;
        }
      }

      .header-content {
        flex: 1;
        min-width: 300px;
      }

      .section-title {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin: 0 0 0.5rem 0;
        font-size: 1.75rem;
        font-weight: 700;
        color: #002b36;
        letter-spacing: -0.02em;
      }

      .header-icon {
        width: 48px;
        height: 48px;
        background: linear-gradient(135deg, #b58900 0%, #859900 100%);
        color: white;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.25rem;
        box-shadow: 0 4px 16px rgba(181, 137, 0, 0.3);
        position: relative;
      }

      .header-icon::after {
        content: "";
        position: absolute;
        inset: -2px;
        border-radius: 14px;
        padding: 2px;
        background: linear-gradient(45deg, #b58900, #859900, #268bd2);
        mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
        mask-composite: subtract;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .premium-header:hover .header-icon::after {
        opacity: 1;
      }

      .title-text {
        background: linear-gradient(135deg, #002b36 0%, #073642 100%);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }

      .section-subtitle {
        margin: 0;
        font-size: 1rem;
        color: #586e75;
        font-weight: 500;
        opacity: 0.9;
      }

      .header-actions {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
      }

      .premium-btn {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.5rem;
        border-radius: 12px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
        overflow: hidden;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
      }

      .premium-btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent
        );
        transition: left 0.5s ease;
      }

      .premium-btn:hover::before {
        left: 100%;
      }

      .btn-outline.premium-btn {
        background: transparent;
        border: 2px solid #b58900;
        color: #b58900;
      }

      .btn-outline.premium-btn:hover {
        background: #b58900;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(181, 137, 0, 0.3);
      }

      .btn.premium-btn {
        background: linear-gradient(135deg, #b58900 0%, #859900 100%);
        border: none;
        color: white;
      }

      .btn.premium-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 24px rgba(181, 137, 0, 0.4);
        background: linear-gradient(135deg, #859900 0%, #b58900 100%);
      }

      /* Responsive header design */
      @media (max-width: 768px) {
        .premium-header {
          flex-direction: column;
          text-align: center;
          padding: 1.5rem;
        }

        .header-actions {
          justify-content: center;
        }

        .section-title {
          justify-content: center;
          font-size: 1.5rem;
        }
      }
      @media (max-width: 768px) {
        .stats-grid {
          grid-template-columns: 1fr;
          gap: 1rem;
        }

        .stat-card {
          padding: 1.5rem;
        }

        .stat-number {
          font-size: 2rem;
        }
      }

      @media (min-width: 1200px) {
        .stats-grid {
          grid-template-columns: repeat(4, 1fr);
        }
      }

      /* Compact Enhanced Navigation Bar */
      .navbar {
        position: sticky !important;
        top: 0 !important;
        z-index: 1000 !important;
        background: linear-gradient(
          135deg,
          #002b36 0%,
          #073642 100%
        ) !important;
        border-bottom: 1px solid #b58900 !important;
        min-height: 70px !important;
        height: auto !important;
        overflow: visible !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      }

      .navbar-container {
        display: flex !important;
        align-items: center !important;
        justify-content: space-between !important;
        flex-wrap: wrap !important;
        padding: 0.75rem 1rem !important;
        max-width: 1400px !important;
        margin: 0 auto !important;
        gap: 0.75rem !important;
        min-height: 70px !important;
        width: 100% !important;
      }

      .navbar-brand {
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
        flex-shrink: 0 !important;
        color: #fdf6e3 !important;
        text-decoration: none !important;
        padding: 0.25rem 0 !important;
      }

      .navbar-brand img {
        width: 32px !important;
        height: 32px !important;
        border-radius: 6px !important;
      }

      .brand-text {
        display: flex !important;
        flex-direction: column !important;
        line-height: 1.1 !important;
      }

      .school-name {
        font-size: 1rem !important;
        font-weight: 700 !important;
        color: #fdf6e3 !important;
        margin: 0 !important;
      }

      .role-text {
        font-size: 0.75rem !important;
        color: #b58900 !important;
        font-weight: 500 !important;
        margin: 0 !important;
      }

      /* Enhanced Navigation Items - All Visible */
      .navbar-nav {
        display: flex !important;
        list-style: none !important;
        flex-wrap: wrap !important;
        gap: 0.25rem !important;
        margin: 0 !important;
        padding: 0 !important;
        align-items: center !important;
        flex: 1 !important;
        justify-content: flex-end !important;
        max-width: none !important;
        overflow: visible !important;
      }

      .navbar-nav li {
        display: block !important;
        margin: 0 !important;
        padding: 0 !important;
        flex-shrink: 0 !important;
      }

      .nav-link {
        display: flex !important;
        align-items: center !important;
        gap: 0.4rem !important;
        padding: 0.4rem 0.6rem !important;
        text-decoration: none !important;
        border-radius: 6px !important;
        transition: all 0.2s ease !important;
        white-space: nowrap !important;
        color: #93a1a1 !important;
        font-size: 0.8rem !important;
        font-weight: 500 !important;
        border: 1px solid transparent !important;
        background: transparent !important;
        min-width: fit-content !important;
      }

      .nav-link .heroicon {
        width: 1rem !important;
        height: 1rem !important;
        flex-shrink: 0 !important;
      }

      .nav-link span {
        font-size: 0.8rem !important;
        font-weight: 500 !important;
        display: inline !important;
      }

      .nav-link:hover {
        background-color: rgba(181, 137, 0, 0.15) !important;
        color: #fdf6e3 !important;
        transform: translateY(-1px) !important;
        border-color: rgba(181, 137, 0, 0.4) !important;
      }

      /* Keyboard focus visibility */
      .nav-link:focus-visible {
        outline: 2px solid #b58900 !important;
        outline-offset: 2px !important;
      }

      /* Active page link state */
      .nav-link.active {
        background-color: rgba(181, 137, 0, 0.2) !important;
        color: #fdf6e3 !important;
        border-color: rgba(181, 137, 0, 0.5) !important;
        box-shadow: 0 2px 8px rgba(181, 137, 0, 0.15) !important;
      }

      /* Enhanced compact navigation with tooltip support */
      .nav-link {
        position: relative !important;
      }

      .nav-link:hover::after {
        content: attr(title) !important;
        position: absolute !important;
        bottom: -35px !important;
        left: 50% !important;
        transform: translateX(-50%) !important;
        background: rgba(0, 43, 54, 0.95) !important;
        color: #fdf6e3 !important;
        padding: 0.375rem 0.5rem !important;
        border-radius: 4px !important;
        font-size: 0.75rem !important;
        white-space: nowrap !important;
        z-index: 1001 !important;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2) !important;
        display: none !important;
      }

      @media (max-width: 1200px) {
        .nav-link:hover::after {
          display: block !important;
        }
      }

      /* Colored Navigation Icons */
      .nav-link .heroicon {
        transition: all 0.3s ease;
      }

      /* Dashboard - Solar Yellow */
      .navbar-nav li:nth-child(1) .nav-link .heroicon {
        fill: #b58900;
      }

      /* Universal Access - Solar Blue */
      .navbar-nav li:nth-child(2) .nav-link .heroicon {
        fill: #268bd2;
      }

      /* Reports - Solar Green */
      .navbar-nav li:nth-child(3) .nav-link .heroicon {
        fill: #859900;
      }

      /* Students - Solar Cyan */
      .navbar-nav li:nth-child(4) .nav-link .heroicon {
        fill: #2aa198;
      }

      /* Teachers - Solar Orange */
      .navbar-nav li:nth-child(5) .nav-link .heroicon {
        fill: #cb4b16;
      }

      /* Subjects - Solar Violet */
      .navbar-nav li:nth-child(6) .nav-link .heroicon {
        fill: #6c71c4;
      }

      /* Subject Configuration - Solar Magenta */
      .navbar-nav li:nth-child(7) .nav-link .heroicon {
        fill: #d33682;
      }

      /* Analytics - Solar Blue (alternate) */
      .navbar-nav li:nth-child(8) .nav-link .heroicon {
        fill: #268bd2;
      }

      /* Student Promotion - Solar Yellow (alternate) */
      .navbar-nav li:nth-child(9) .nav-link .heroicon {
        fill: #b58900;
      }

      /* Parent Portal - Solar Green (alternate) */
      .navbar-nav li:nth-child(10) .nav-link .heroicon {
        fill: #859900;
      }

      /* Permissions - Solar Red */
      .navbar-nav li:nth-child(11) .nav-link .heroicon {
        fill: #dc322f;
      }

      /* Logout - Solar Red (darker) */
      .navbar-nav li:nth-child(12) .nav-link .heroicon {
        fill: #dc322f;
      }

      /* Hover effects for colored icons */
      .nav-link:hover .heroicon {
        filter: brightness(1.2) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        transform: scale(1.1);
      }

      /* PAGE HEADER SECTION ICONS */
      /* Page actions buttons */
      .page-actions .btn-outline .heroicon {
        fill: #268bd2; /* Solar Blue */
      }

      .page-actions .btn .heroicon {
        fill: #859900; /* Solar Green for primary actions */
      }

      /* Page title icon */
      .page-title .heroicon {
        fill: #b58900; /* Solar Yellow */
      }

      /* SYSTEM ALERTS SECTION ICONS */
      /* Alert section header */
      .alerts-section .section-header .heroicon {
        fill: #dc322f; /* Solar Red for alerts */
      }

      /* System Alerts - Premium styling and responsiveness */
      .alerts-section {
        margin: 2rem 0;
      }

      .system-alerts-container {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
      }

      .system-alert {
        display: flex;
        align-items: flex-start;
        justify-content: space-between;
        gap: 1rem;
        padding: 1rem 1.25rem;
        border-radius: 14px;
        background: linear-gradient(
          135deg,
          rgba(253, 246, 227, 0.85) 0%,
          rgba(238, 232, 213, 0.6) 100%
        );
        border: 1px solid rgba(181, 137, 0, 0.18);
        box-shadow: 0 4px 18px rgba(0, 43, 54, 0.06);
      }

      .system-alert.alert-critical {
        border-left: 6px solid #dc322f;
      }
      .system-alert.alert-warning {
        border-left: 6px solid #b58900;
      }
      .system-alert.alert-info {
        border-left: 6px solid #268bd2;
      }

      .alert-content {
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
        flex: 1;
        min-width: 0; /* allow wrapping */
      }

      .system-alert .alert-icon {
        width: 36px;
        height: 36px;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        flex-shrink: 0;
      }

      .system-alert.alert-critical .alert-icon {
        background: rgba(220, 50, 47, 0.12);
      }
      .system-alert.alert-warning .alert-icon {
        background: rgba(181, 137, 0, 0.12);
      }
      .system-alert.alert-info .alert-icon {
        background: rgba(38, 139, 210, 0.12);
      }

      .alert-text {
        flex: 1;
      }

      .alert-title {
        font-weight: 700;
        color: #002b36;
        margin: 0 0 0.25rem 0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
      }

      .alert-message {
        margin: 0 0 0.35rem 0;
        color: #586e75;
      }

      .alert-time {
        font-size: 0.8rem;
        color: #93a1a1;
      }

      .alert-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        padding: 0.2rem 0.5rem;
        border-radius: 999px;
        font-size: 0.7rem;
        font-weight: 800;
        letter-spacing: 0.02em;
        border: 1px solid transparent;
        line-height: 1;
      }
      .badge-critical {
        color: #dc322f;
        background: rgba(220, 50, 47, 0.1);
        border-color: rgba(220, 50, 47, 0.25);
      }
      .badge-warning {
        color: #b58900;
        background: rgba(181, 137, 0, 0.1);
        border-color: rgba(181, 137, 0, 0.25);
      }
      .badge-info {
        color: #268bd2;
        background: rgba(38, 139, 210, 0.1);
        border-color: rgba(38, 139, 210, 0.25);
      }

      .alert-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        align-items: center;
      }

      /* Hover & focus */
      .system-alert:hover {
        box-shadow: 0 8px 24px rgba(0, 43, 54, 0.1);
      }
      .alert-actions .btn-sm:focus-visible {
        outline: 2px solid #b58900;
        outline-offset: 2px;
      }

      /* Mobile responsiveness for alerts */
      @media (max-width: 640px) {
        .system-alert {
          flex-direction: column;
        }
        .alert-actions {
          justify-content: flex-start;
        }
      }

      /* Alert type specific colors */
      .system-alert .alert-icon .heroicon {
        transition: all 0.3s ease;
      }

      .alert-critical .alert-icon .heroicon {
        fill: #dc322f; /* Solar Red for critical */
      }

      .alert-warning .alert-icon .heroicon {
        fill: #b58900; /* Solar Yellow for warning */
      }

      .alert-info .alert-icon .heroicon {
        fill: #268bd2; /* Solar Blue for info */
      }

      /* FILTER PANEL ICONS */
      .filter-panel .heroicon {
        fill: #268bd2; /* Solar Blue */
      }

      /* Advanced Filters Panel - premium layout */
      .filter-panel {
        background: linear-gradient(
          135deg,
          rgba(253, 246, 227, 0.85) 0%,
          rgba(238, 232, 213, 0.65) 100%
        );
        border: 1px solid rgba(181, 137, 0, 0.18);
        border-radius: 16px;
        padding: 1rem 1.25rem;
        margin: 1rem 0 2rem 0;
        box-shadow: 0 6px 20px rgba(0, 43, 54, 0.08);
      }

      .filter-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.75rem;
        flex-wrap: wrap;
        margin-bottom: 0.75rem;
      }

      .filter-header h3 {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin: 0;
        font-size: 1.1rem;
        font-weight: 800;
        letter-spacing: -0.01em;
        color: #002b36;
      }

      .filter-content {
        display: grid;
        gap: 0.75rem 1rem;
      }

      .filter-row {
        display: grid;
        grid-template-columns: repeat(3, minmax(220px, 1fr));
        gap: 0.75rem 1rem;
      }

      .filter-group {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
        min-width: 0;
      }

      .filter-group label {
        font-size: 0.85rem;
        font-weight: 700;
        color: #073642;
      }

      .form-control,
      .filter-group select {
        appearance: none;
        background: #fdf6e3;
        border: 1px solid rgba(181, 137, 0, 0.35);
        border-radius: 10px;
        padding: 0.55rem 0.75rem;
        color: #002b36;
        min-height: 40px;
        box-shadow: inset 0 1px 0 rgba(253, 246, 227, 0.6);
      }

      .form-control:focus,
      .filter-group select:focus {
        outline: 2px solid #b58900;
        outline-offset: 2px;
      }

      .filter-group.filter-actions {
        display: flex;
        align-items: end;
        justify-content: flex-start;
      }

      /* Responsive filters */
      @media (max-width: 1024px) {
        .filter-row {
          grid-template-columns: repeat(2, minmax(200px, 1fr));
        }
      }
      @media (max-width: 640px) {
        .filter-row {
          grid-template-columns: 1fr;
        }
        .filter-group.filter-actions {
          justify-content: center;
        }
        .filter-group.filter-actions .btn {
          width: 100%;
        }
      }

      /* STATISTICS SECTION ICONS */
      /* Section headers */
      .stats-section .section-header .heroicon {
        fill: #b58900; /* Solar Yellow */
      }

      .premium-header .header-icon .heroicon {
        fill: #b58900; /* Solar Yellow */
      }

      .header-actions .heroicon {
        fill: #268bd2; /* Solar Blue */
      }

      /* Stat card icons by type */
      .stat-icon.primary .heroicon {
        fill: #ffffff; /* White for visibility on colored backgrounds */
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
      }

      .stat-icon.success .heroicon {
        fill: #ffffff;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
      }

      .stat-icon.info .heroicon {
        fill: #ffffff;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
      }

      .stat-icon.warning .heroicon {
        fill: #ffffff;
        filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
      }

      /* CHARTS SECTION ICONS */
      .chart-actions .heroicon {
        fill: #268bd2; /* Solar Blue */
      }

      /* ANALYTICS SECTION ICONS */
      .analytics-section .section-header .heroicon {
        fill: #6c71c4; /* Solar Violet */
      }

      .analytics-header .heroicon {
        fill: #268bd2; /* Solar Blue */
      }

      .btn-sm .heroicon {
        fill: #859900; /* Solar Green */
      }

      /* PERFORMANCE SECTION ICONS */
      .performance-section .section-header .heroicon {
        fill: #859900; /* Solar Green */
      }

      .section-actions .heroicon {
        fill: #268bd2; /* Solar Blue */
      }

      .filter-item .heroicon {
        fill: #268bd2; /* Solar Blue */
      }

      /* PAGINATION ICONS */
      .pagination-controls .heroicon {
        fill: #268bd2; /* Solar Blue */
      }

      /* TABLE ACTION ICONS */
      .table-actions .heroicon {
        fill: #6c71c4; /* Solar Violet */
      }

      /* HOVER EFFECTS FOR ALL ICONS */
      .heroicon:hover {
        filter: brightness(1.2) drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        transform: scale(1.05);
        transition: all 0.3s ease;
      }

      /* BUTTON ICON HOVER EFFECTS */
      .btn:hover .heroicon,
      .btn-outline:hover .heroicon,
      .btn-sm:hover .heroicon {
        transform: scale(1.1);
        filter: brightness(1.3) drop-shadow(0 2px 6px rgba(0, 0, 0, 0.3));
      }

      /* RESPONSIVE ICON COLORS */
      @media (max-width: 768px) {
        .heroicon {
          width: 1rem;
          height: 1rem;
        }

        .heroicon-lg {
          width: 1.5rem;
          height: 1.5rem;
        }
      }

      /* DISMISS AND CLOSE BUTTON ICONS */
      .btn-sm.btn-outline .heroicon {
        fill: #dc322f; /* Solar Red for dismiss actions */
      }

      /* NO DATA STATE ICONS */
      .no-alerts-content .heroicon {
        fill: #859900; /* Solar Green for positive states */
      }

      .no-data-message .heroicon {
        fill: #586e75; /* Solar Gray for neutral states */
      }

      /* ADDITIONAL INTERACTIVE ELEMENT ICONS */
      .alert-actions .heroicon {
        fill: #268bd2; /* Solar Blue */
      }

      .alert-actions .btn-sm:hover .heroicon {
        fill: #dc322f; /* Solar Red on hover for actions */
      }

      /* VIEW DETAILS BUTTON ICONS */
      .btn-details .heroicon {
        fill: #6c71c4; /* Solar Violet */
      }

      /* SUCCESS STATE ICONS */
      .success-message .heroicon {
        fill: #859900; /* Solar Green */
      }

      /* ERROR STATE ICONS */
      .error-message .heroicon {
        fill: #dc322f; /* Solar Red */
      }

      /* LOADING STATE ICONS */
      .loading .heroicon {
        fill: #586e75; /* Solar Gray */
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        from {
          transform: rotate(0deg);
        }
        to {
          transform: rotate(360deg);
        }
      }

      /* DROPDOWN AND MENU ICONS */
      .dropdown-toggle .heroicon {
        fill: #268bd2; /* Solar Blue */
      }

      /* EXPORT AND DOWNLOAD ICONS */
      .export-btn .heroicon {
        fill: #859900; /* Solar Green */
      }

      /* SEARCH AND FILTER ICONS */
      .search-btn .heroicon,
      .filter-btn .heroicon {
        fill: #268bd2; /* Solar Blue */
      }

      /* EDIT AND MODIFY ICONS */
      .edit-btn .heroicon {
        fill: #b58900; /* Solar Yellow */
      }

      /* DELETE AND REMOVE ICONS */
      .delete-btn .heroicon {
        fill: #dc322f; /* Solar Red */
      }

      /* ADD AND CREATE ICONS */
      .add-btn .heroicon,
      .create-btn .heroicon {
        fill: #859900; /* Solar Green */
      }

      /* Improved Responsive Navigation - All Items Visible */
      @media (min-width: 1400px) {
        .navbar-nav {
          flex-wrap: nowrap !important;
        }

        .navbar-container {
          flex-wrap: nowrap !important;
        }
      }

      /* Mobile Hamburger + Drawer (Headteacher only, mobile view) */
      .hamburger-btn {
        display: none;
        align-items: center;
        gap: 0.35rem;
        background: transparent;
        color: #fdf6e3;
        border: 1px solid rgba(181, 137, 0, 0.5);
        border-radius: 10px;
        padding: 0.45rem 0.6rem;
        line-height: 1;
      }
      .hamburger-btn .heroicon {
        fill: #b58900;
      }
      .hamburger-label {
        font-weight: 600;
        font-size: 0.85rem;
      }

      @media (max-width: 768px) {
        .hamburger-btn {
          display: inline-flex;
        }
      }

      .mobile-drawer-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.35);
        z-index: 1500;
        display: none;
      }

      .mobile-drawer {
        position: fixed;
        top: 0;
        left: 0;
        height: 100dvh;
        width: 82%;
        max-width: 320px;
        background: linear-gradient(135deg, #002b36 0%, #073642 100%);
        color: #fdf6e3;
        border-right: 2px solid #b58900;
        transform: translateX(-100%);
        transition: transform 0.25s ease-out;
        z-index: 1501;
        display: flex;
        flex-direction: column;
        padding: 0.75rem;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
      }

      .drawer-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.5rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid rgba(181, 137, 0, 0.35);
      }
      .drawer-brand {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        text-decoration: none;
        color: #fdf6e3;
      }
      .drawer-brand img {
        width: 28px;
        height: 28px;
        border-radius: 6px;
      }
      .drawer-title {
        font-weight: 800;
        font-size: 1rem;
      }
      .drawer-close-btn {
        background: transparent;
        color: #fdf6e3;
        border: 1px solid rgba(181, 137, 0, 0.5);
        border-radius: 8px;
        padding: 0.35rem;
      }
      .drawer-close-btn .heroicon {
        fill: #dc322f;
      }

      .drawer-nav {
        overflow-y: auto;
        padding: 0.5rem 0.25rem;
      }
      .drawer-nav-list {
        list-style: none;
        margin: 0;
        padding: 0;
        display: grid;
        gap: 0.25rem;
      }
      .drawer-nav-list .nav-link {
        width: 100%;
        justify-content: flex-start !important;
      }
      .drawer-nav-list .nav-link span {
        display: inline !important;
      }
      .drawer-footer {
        margin-top: auto;
        padding-top: 0.5rem;
        font-size: 0.8rem;
        color: #93a1a1;
      }

      body.drawer-open {
        overflow: hidden;
      }
      body.drawer-open .mobile-drawer {
        transform: translateX(0);
      }
      body.drawer-open .mobile-drawer-backdrop {
        display: block;
      }

      /* Hide long nav row on mobile; drawer + hamburger will be primary */
      @media (max-width: 768px) {
        .navbar-nav {
          display: none !important;
        }
      }

      @media (min-width: 1200px) and (max-width: 1399px) {
        .nav-link {
          padding: 0.3rem 0.5rem !important;
          font-size: 0.75rem !important;
          gap: 0.3rem !important;
        }

        .nav-link span {
          font-size: 0.75rem !important;
        }

        .navbar-nav {
          gap: 0.2rem !important;
          flex-wrap: wrap !important;
        }
      }

      @media (min-width: 900px) and (max-width: 1199px) {
        .navbar-container {
          flex-direction: column !important;
          gap: 0.5rem !important;
          padding: 0.5rem 1rem !important;
          min-height: auto !important;
        }

        .navbar-nav {
          width: 100% !important;
          justify-content: center !important;
          flex-wrap: wrap !important;
          gap: 0.25rem !important;
        }

        .nav-link {
          padding: 0.25rem 0.4rem !important;
          font-size: 0.7rem !important;
        }

        .nav-link span {
          font-size: 0.7rem !important;
        }
      }

      @media (max-width: 899px) {
        .navbar-container {
          flex-direction: column !important;
          gap: 0.5rem !important;
          padding: 0.5rem !important;
        }

        .navbar-nav {
          width: 100% !important;
          justify-content: center !important;
          flex-wrap: wrap !important;
          gap: 0.25rem !important;
        }

        .nav-link {
          padding: 0.3rem 0.4rem !important;
          font-size: 0.75rem !important;
          gap: 0.25rem !important;
        }

        .nav-link span {
          font-size: 0.75rem !important;
        }

        .nav-link .heroicon {
          width: 0.9rem !important;
          height: 0.9rem !important;
        }
      }

      @media (max-width: 600px) {
        /* Hide labels, keep icons */
        .nav-link span {
          display: none !important;
        }

        .nav-link {
          padding: 0.4rem !important;
          min-width: 44px !important; /* Minimum touch target width */
          min-height: 44px !important; /* Minimum touch target height */
          justify-content: center !important;
        }

        .nav-link .heroicon {
          width: 1.1rem !important;
          height: 1.1rem !important;
        }

        /* Enable horizontal swipe scrolling for nav when space is tight */
        .navbar-nav {
          gap: 0.1rem !important;
          flex-wrap: nowrap !important;
          overflow-x: auto !important;
          -webkit-overflow-scrolling: touch !important;
          overscroll-behavior-x: contain !important;
          scrollbar-width: none !important; /* Firefox */
          max-width: 100% !important;
        }
        .navbar-nav::-webkit-scrollbar {
          display: none !important; /* WebKit */
        }
      }

      /* Respect device safe areas (iOS notch, etc.) */
      @supports (padding: max(0px)) {
        .navbar {
          padding-top: max(0px, env(safe-area-inset-top)) !important;
        }
      }

      /* ===== Charts: Responsive containers and polish ===== */
      .charts-section {
        margin: 2rem 0;
      }
      .charts-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 1rem;
      }
      @media (max-width: 900px) {
        .charts-grid {
          grid-template-columns: 1fr;
        }
      }
      .chart-container {
        background: linear-gradient(
          135deg,
          rgba(253, 246, 227, 0.9) 0%,
          rgba(238, 232, 213, 0.75) 100%
        );
        border: 1px solid rgba(181, 137, 0, 0.18);
        border-radius: 16px;
        box-shadow: 0 6px 20px rgba(0, 43, 54, 0.08);
        padding: 1rem;
      }
      .chart-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
      }
      .chart-header h3 {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 800;
        color: #002b36;
      }
      .chart-actions {
        display: flex;
        gap: 0.5rem;
      }
      .chart-content {
        position: relative;
        height: 340px;
      }
      @media (max-width: 640px) {
        .chart-content {
          height: 280px;
        }
      }

      /* ===== Advanced analytics cards & heatmap ===== */
      .analytics-grid {
        display: grid;
        grid-template-columns: repeat(2, minmax(0, 1fr));
        gap: 1rem;
      }
      @media (max-width: 900px) {
        .analytics-grid {
          grid-template-columns: 1fr;
        }
      }
      .analytics-card {
        background: linear-gradient(
          135deg,
          rgba(253, 246, 227, 0.9) 0%,
          rgba(238, 232, 213, 0.75) 100%
        );
        border: 1px solid rgba(181, 137, 0, 0.18);
        border-radius: 16px;
        padding: 1rem;
        box-shadow: 0 6px 20px rgba(0, 43, 54, 0.08);
      }
      .analytics-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 0.5rem;
        margin-bottom: 0.75rem;
      }
      .analytics-header h3 {
        margin: 0;
        font-size: 1.05rem;
        font-weight: 800;
        color: #002b36;
      }
      .analytics-header select {
        border: 1px solid rgba(181, 137, 0, 0.35);
        border-radius: 10px;
        padding: 0.4rem 0.6rem;
        background: #fdf6e3;
      }
      .heatmap-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 0.75rem;
      }
      .heatmap-tile {
        border-radius: 12px;
        padding: 0.75rem;
        background: #fdf6e3;
        border: 1px solid rgba(181, 137, 0, 0.25);
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
        min-height: 88px;
      }
      .heatmap-title {
        font-weight: 700;
        color: #073642;
        font-size: 0.95rem;
      }
      .heatmap-value {
        font-weight: 800;
        font-size: 1.25rem;
      }
      .heatmap-sub {
        color: #586e75;
        font-size: 0.8rem;
      }
      .heatmap-empty {
        text-align: center;
        color: #586e75;
        opacity: 0.9;
        padding: 1rem;
      }

      /* Inline performance filters responsive grid */
      .performance-filters .filters-grid {
        display: grid;
        grid-template-columns: repeat(4, minmax(180px, 1fr));
        gap: 0.75rem;
      }
      @media (max-width: 1024px) {
        .performance-filters .filters-grid {
          grid-template-columns: repeat(3, minmax(160px, 1fr));
        }
      }
      @media (max-width: 768px) {
        .performance-filters .filters-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }
      @media (max-width: 520px) {
        .performance-filters .filters-grid {
          grid-template-columns: 1fr;
        }
      }

      /* ===== Performance table responsiveness & pagination ===== */
      .table-responsive {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }
      .pagination-container {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        align-items: center;
        justify-content: space-between;
        margin-top: 0.75rem;
      }
      .pagination-controls {
        display: flex;
        gap: 0.4rem;
        flex-wrap: wrap;
        align-items: center;
      }
      .page-numbers {
        display: flex;
        gap: 0.25rem;
        flex-wrap: wrap;
      }
      .page-numbers button {
        min-width: 36px;
        min-height: 36px;
        border-radius: 8px;
      }
      .page-numbers button.active {
        background: #b58900;
        color: #ffffff;
        border-color: #b58900;
      }
      @media (max-width: 640px) {
        .pagination-container {
          gap: 0.4rem;
        }
        .pagination-controls .btn-outline {
          min-width: 44px;
          min-height: 36px;
        }
      }

      /* ===== Mobile enhancements for management controls ===== */
      .filter-actions-row {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        justify-content: flex-end;
        margin-top: 0.75rem;
      }
      .filter-actions-row .btn,
      .filter-actions-row .btn-outline {
        min-height: 40px;
      }
      .filter-header .btn-close {
        display: none;
      }
      @media (max-width: 640px) {
        .filter-actions-row {
          justify-content: stretch;
        }
        .filter-actions-row .btn,
        .filter-actions-row .btn-outline {
          flex: 1 1 100%;
        }
        .filter-header .btn-close {
          display: inline-flex;
        }
      }

      @media (max-width: 520px) {
        .performance-filters .filters-grid button {
          width: 100%;
          min-height: 44px;
        }
      }

      .actions {
        display: flex;
        gap: 0.4rem;
        flex-wrap: wrap;
      }
      .actions .btn-sm {
        min-height: 40px;
        padding: 0.45rem 0.6rem;
      }
      @media (max-width: 520px) {
        .actions {
          flex-direction: column;
          align-items: stretch;
        }
        .actions .btn-sm {
          width: 100%;
        }
      }

      @media (max-width: 520px) {
        .no-data-container .btn {
          display: block;
          width: 100%;
          margin: 0.25rem 0 !important;
        }
      }
    </style>
  </head>
  <body class="solar-theme">
    <!-- Navigation -->
    <nav class="navbar" role="navigation">
      <div class="navbar-container">
        <!-- LEFT SECTION: Branding area with logo and school name -->
        <a href="{{ url_for('admin.dashboard') }}" class="navbar-brand">
          <!-- Hillview School Logo with Enhanced Styling -->
          {% if school_info.logo_path %}
          <img
            src="{{ url_for('static', filename=school_info.logo_path) }}"
            alt="{{ school_info.school_name or 'Hillview School' }} Logo"
            onerror="this.src='{{ url_for('static', filename='uploads/logos/optimized_school_logo_1750595986_hvs.jpg') }}'"
          />
          {% else %}
          <img
            src="{{ url_for('static', filename='uploads/logos/optimized_school_logo_1750595986_hvs.jpg') }}"
            alt="Hillview School Logo"
          />
          {% endif %}
          <div class="brand-text">
            <span class="school-name"
              >{{ school_info.school_name or 'Hillview School' }}</span
            >
            <span class="role-text">Headteacher</span>
          </div>
        </a>

        <!-- Mobile-only Hamburger Button -->
        <button
          class="hamburger-btn"
          id="hamburgerBtn"
          aria-label="Open menu"
          aria-haspopup="true"
          aria-controls="mobileDrawer"
          aria-expanded="false"
        >
          <!-- Heroicon: bars-3 (solid) -->
          <svg
            class="heroicon"
            fill="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <rect x="3.75" y="5" width="16.5" height="2" rx="1"></rect>
            <rect x="3.75" y="11" width="16.5" height="2" rx="1"></rect>
            <rect x="3.75" y="17" width="16.5" height="2" rx="1"></rect>
          </svg>
          <span class="hamburger-label">Menu</span>
        </button>

        <!-- RIGHT SECTION: Navigation menu items in horizontal row -->
        <ul class="navbar-nav">
          <li>
            <a
              class="nav-link {% if request.endpoint == 'admin.dashboard' %}active{% endif %}"
              href="{{ url_for('admin.dashboard') }}"
              title="Dashboard"
              aria-label="Dashboard"
            >
              <!-- Heroicon: chart-pie (solid) -->
              <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M18.375 2.25c-1.035 0-1.875.84-1.875 1.875v15.75c0 1.035.84 1.875 1.875 1.875h.75c1.035 0 1.875-.84 1.875-1.875V4.125c0-1.036-.84-1.875-1.875-1.875h-.75zM9.75 8.625c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-.75a1.875 1.875 0 01-1.875-1.875V8.625zM3 13.125c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v6.75c0 1.035-.84 1.875-1.875 1.875h-.75A1.875 1.875 0 013 19.875v-6.75z"
                />
              </svg>
              <span>Dashboard</span>
            </a>
          </li>
          <li>
            <a
              class="nav-link {% if request.endpoint == 'universal.dashboard' %}active{% endif %}"
              id="universal-access-link"
              href="{{ url_for('universal.dashboard') }}"
              title="Universal Access"
              aria-label="Universal Access"
            >
              <!-- Heroicon: cog-8-tooth (solid) -->
              <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                <path
                  fill-rule="evenodd"
                  d="M11.828 2.25c-.916 0-1.699.663-1.85 1.567l-.091.549a.798.798 0 01-.517.608 7.45 7.45 0 00-.478.198.798.798 0 01-.796-.064l-.453-.324a1.875 1.875 0 00-2.416.2l-.243.243a1.875 1.875 0 00-.2 2.416l.324.453a.798.798 0 01.064.796 7.448 7.448 0 00-.198.478.798.798 0 01-.608.517l-.55.092a1.875 1.875 0 00-1.566 1.849v.344c0 .916.663 1.699 1.567 1.85l.549.091c.281.047.508.25.608.517.06.162.127.321.198.478a.798.798 0 01-.064.796l-.324.453a1.875 1.875 0 00.2 2.416l.243.243c.648.648 1.67.733 2.416.2l.453-.324a.798.798 0 01.796-.064c.157.071.316.137.478.198.267.1.47.327.517.608l.092.55c.15.903.932 1.566 1.849 1.566h.344c.916 0 1.699-.663 1.85-1.567l.091-.549a.798.798 0 01.517-.608 7.52 7.52 0 00.478-.198.798.798 0 01.796.064l.453.324a1.875 1.875 0 002.416-.2l.243-.243c.648-.648.733-1.67.2-2.416l-.324-.453a.798.798 0 01-.064-.796c.071-.157.137-.316.198-.478.1-.267.327-.47.608-.517l.55-.091a1.875 1.875 0 001.566-1.85v-.344c0-.916-.663-1.699-1.567-1.85l-.549-.091a.798.798 0 01-.608-.517 7.507 7.507 0 00-.198-.478.798.798 0 01.064-.796l.324-.453a1.875 1.875 0 00-.2-2.416l-.243-.243a1.875 1.875 0 00-2.416-.2l-.453.324a.798.798 0 01-.796.064 7.462 7.462 0 00-.478-.198.798.798 0 01-.517-.608l-.091-.55a1.875 1.875 0 00-1.85-1.566h-.344zM12 15.75a3.75 3.75 0 100-7.5 3.75 3.75 0 000 7.5z"
                  clip-rule="evenodd"
                />
              </svg>
              <span>UNIVERSAL ACCESS</span>
            </a>
          </li>
          <li>
            <a
              class="nav-link {% if request.endpoint == 'admin.reports' %}active{% endif %}"
              href="{{ url_for('admin.reports') }}"
              title="Reports"
              aria-label="Reports"
            >
              <!-- Heroicon: chart-bar (solid) -->
              <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M18.375 2.25c-1.035 0-1.875.84-1.875 1.875v15.75c0 1.035.84 1.875 1.875 1.875h.75c1.035 0 1.875-.84 1.875-1.875V4.125c0-1.036-.84-1.875-1.875-1.875h-.75zM9.75 8.625c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-.75a1.875 1.875 0 01-1.875-1.875V8.625zM3 13.125c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v6.75c0 1.035-.84 1.875-1.875 1.875h-.75A1.875 1.875 0 013 19.875v-6.75z"
                />
              </svg>
              <span>Reports</span>
            </a>
          </li>
          <li>
            <a
              class="nav-link {% if request.endpoint == 'subject_config_api.subject_configuration_page' %}active{% endif %}"
              href="{{ url_for('subject_config_api.subject_configuration_page') }}"
              title="Subject Configuration"
              aria-label="Subject Configuration"
            >
              <!-- Heroicon: adjustments-horizontal (solid) -->
              <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M18.75 12.75h1.5a.75.75 0 000-1.5h-1.5a.75.75 0 000 1.5zM12 6a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5A.75.75 0 0112 6zM12 18a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5A.75.75 0 0112 18zM3.75 6.75h1.5a.75.75 0 100-1.5h-1.5a.75.75 0 000 1.5zM5.25 18.75h-1.5a.75.75 0 010-1.5h1.5a.75.75 0 010 1.5zM3 12a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5A.75.75 0 013 12zM9 3.75a2.25 2.25 0 100 4.5 2.25 2.25 0 000-4.5zM12.75 12a2.25 2.25 0 114.5 0 2.25 2.25 0 01-4.5 0zM9 15.75a2.25 2.25 0 100 4.5 2.25 2.25 0 000-4.5z"
                />
              </svg>
              <span>Subject Configuration</span>
            </a>
          </li>
          <li>
            <a
              class="nav-link {% if request.endpoint == 'admin.analytics_dashboard' %}active{% endif %}"
              href="{{ url_for('admin.analytics_dashboard') }}"
              title="Analytics"
              aria-label="Analytics"
            >
              <!-- Heroicon: presentation-chart-line (solid) -->
              <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                <path
                  fill-rule="evenodd"
                  d="M2.25 2.25a.75.75 0 000 1.5H3v10.5a3 3 0 003 3h1.21l-1.172 3.513a.75.75 0 001.424.474l.329-.987h8.418l.33.987a.75.75 0 001.422-.474L15.79 17.25H18a3 3 0 003-3V3.75h.75a.75.75 0 000-1.5H2.25zm6.04 16.5l.5-1.5h6.42l.5 1.5H8.29zm7.46-12a.75.75 0 00-1.5 0v6a.75.75 0 001.5 0v-6zm-3 2.25a.75.75 0 00-1.5 0v3.75a.75.75 0 001.5 0V9zm-3 2.25a.75.75 0 00-1.5 0v1.5a.75.75 0 001.5 0v-1.5z"
                  clip-rule="evenodd"
                />
              </svg>
              <span>Analytics</span>
            </a>
          </li>
          <li>
            <a
              class="nav-link {% if request.endpoint == 'admin.student_promotion' %}active{% endif %}"
              href="{{ url_for('admin.student_promotion') }}"
              title="Student Promotion"
              aria-label="Student Promotion"
            >
              <!-- Heroicon: academic-cap (solid) -->
              <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                <path
                  d="M11.7 2.805a.75.75 0 01.6 0A60.65 60.65 0 0122.83 8.72a.75.75 0 01-.231 1.337 49.949 49.949 0 00-9.902 3.912l-.003.002-.34.18a.75.75 0 01-.707 0A50.009 50.009 0 007.5 12.174v-.224c0-.131.067-.248.172-.311a54.614 54.614 0 014.653-2.52.75.75 0 00-.65-1.352 56.129 56.129 0 00-4.78 2.589 1.858 1.858 0 00-.859 1.228 49.803 49.803 0 00-4.634-1.527.75.75 0 01-.231-1.337A60.653 60.653 0 0111.7 2.805z"
                />
                <path
                  d="M13.06 15.473a48.45 48.45 0 017.666-3.282c.134 1.414.22 2.843.255 4.285a.75.75 0 01-.46.71 47.878 47.878 0 00-8.105 4.342.75.75 0 01-.832 0 47.877 47.877 0 00-8.104-4.342.75.75 0 01-.461-.71c.035-1.442.121-2.87.255-4.286.921.304 1.83.634 2.726.99v1.27a1.5 1.5 0 00-.14 2.508c-.09.38-.222.753-.397 1.11.452.213.901.434 1.346.661a6.729 6.729 0 00.551-1.608 1.5 1.5 0 00.14-2.67v-.645a48.549 48.549 0 013.44 1.668 2.25 2.25 0 002.12 0z"
                />
                <path
                  d="M4.462 19.462c.42-.419.753-.89 1-1.394.453.213.902.434 1.347.661a6.743 6.743 0 01-1.286 1.794.75.75 0 11-1.06-1.06z"
                />
              </svg>
              <span>Student Promotion</span>
            </a>
          </li>
          <li>
            <a
              class="nav-link {% if request.endpoint == 'parent.login' %}active{% endif %}"
              href="{{ url_for('parent.login') }}"
              title="Parent Portal"
              aria-label="Parent Portal"
            >
              <!-- Heroicon: user-group (solid) -->
              <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                <path
                  fill-rule="evenodd"
                  d="M8.25 6.75a3.75 3.75 0 117.5 0 3.75 3.75 0 01-7.5 0zM15.75 9.75a3 3 0 116 0 3 3 0 01-6 0zM2.25 9.75a3 3 0 116 0 3 3 0 01-6 0zM6.31 15.117A6.745 6.745 0 0112 12a6.745 6.745 0 016.709 7.498.75.75 0 01-.372.568A12.696 12.696 0 0112 21.75c-2.305 0-4.47-.612-6.337-1.684a.75.75 0 01-.372-.568 6.787 6.787 0 011.019-1.381z"
                  clip-rule="evenodd"
                />
              </svg>
              <span>Parent Portal</span>
            </a>
          </li>
          <li>
            <a
              class="nav-link {% if request.path.startswith('/parent_management') %}active{% endif %}"
              href="/parent_management/dashboard"
              title="Parent Management"
              aria-label="Parent Management"
            >
              <!-- Heroicon: users (solid) - Parent Management -->
              <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                <path
                  fill-rule="evenodd"
                  d="M7.5 6a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM3.751 20.105a8.25 8.25 0 0116.498 0 .75.75 0 01-.437.695A18.683 18.683 0 0112 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 01-.437-.695z"
                  clip-rule="evenodd"
                />
              </svg>
              <span>Parent Management</span>
            </a>
          </li>
          <li>
            <a
              class="nav-link"
              href="{{ url_for('auth.logout_route') }}"
              title="Logout"
              aria-label="Logout"
            >
              <!-- Heroicon: arrow-right-on-rectangle (solid) -->
              <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                <path
                  fill-rule="evenodd"
                  d="M7.5 3.75A1.5 1.5 0 006 5.25v13.5a1.5 1.5 0 001.5 1.5h6a1.5 1.5 0 001.5-1.5V15a.75.75 0 011.5 0v3.75a3 3 0 01-3 3h-6a3 3 0 01-3-3V5.25a3 3 0 013-3h6a3 3 0 013 3V9A.75.75 0 0115 9V5.25a1.5 1.5 0 00-1.5-1.5h-6zm10.72 4.72a.75.75 0 011.06 0l3 3a.75.75 0 010 1.06l-3 3a.75.75 0 11-1.06-1.06l1.72-1.72H9a.75.75 0 010-1.5h10.94l-1.72-1.72a.75.75 0 010-1.06z"
                  clip-rule="evenodd"
                />
              </svg>
              <span>Logout</span>
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Mobile Drawer and Backdrop -->
    <div
      class="mobile-drawer-backdrop"
      id="mobileDrawerBackdrop"
      tabindex="-1"
      aria-hidden="true"
    ></div>
    <aside
      class="mobile-drawer"
      id="mobileDrawer"
      role="dialog"
      aria-modal="true"
      aria-label="Navigation drawer"
    >
      <div class="drawer-header">
        <a href="{{ url_for('admin.dashboard') }}" class="drawer-brand">
          {% if school_info.logo_path %}
          <img
            src="{{ url_for('static', filename=school_info.logo_path) }}"
            alt="{{ school_info.school_name or 'Hillview School' }} Logo"
            onerror="this.src='{{ url_for('static', filename='uploads/logos/optimized_school_logo_1750595986_hvs.jpg') }}'"
          />
          {% else %}
          <img
            src="{{ url_for('static', filename='uploads/logos/optimized_school_logo_1750595986_hvs.jpg') }}"
            alt="Hillview School Logo"
          />
          {% endif %}
          <span class="drawer-title"
            >{{ school_info.school_name or 'Hillview School' }}</span
          >
        </a>
        <button
          class="drawer-close-btn"
          id="drawerCloseBtn"
          aria-label="Close menu"
        >
          <!-- Heroicon: x-mark (solid) -->
          <svg
            class="heroicon"
            fill="currentColor"
            viewBox="0 0 24 24"
            aria-hidden="true"
          >
            <path
              fill-rule="evenodd"
              d="M5.47 5.47a.75.75 0 011.06 0L12 10.94l5.47-5.47a.75.75 0 111.06 1.06L13.06 12l5.47 5.47a.75.75 0 11-1.06 1.06L12 13.06l-5.47 5.47a.75.75 0 11-1.06-1.06L10.94 12 5.47 6.53a.75.75 0 010-1.06z"
              clip-rule="evenodd"
            />
          </svg>
        </button>
      </div>
      <nav class="drawer-nav" aria-label="Mobile navigation">
        <ul class="drawer-nav-list" id="drawerNavList"></ul>
      </nav>
      <div class="drawer-footer">Welcome, Headteacher</div>
    </aside>

    <!-- Main Content -->
    <div class="dashboard-container">
      <!-- Page Header -->
      <div class="page-header">
        <div class="page-title">
          <h1>
            <!-- Heroicon: chart-pie (solid) -->
            <svg
              class="heroicon heroicon-lg"
              fill="currentColor"
              viewBox="0 0 24 24"
              style="display: inline-block; margin-right: 0.5rem"
            >
              <path
                d="M18.375 2.25c-1.035 0-1.875.84-1.875 1.875v15.75c0 1.035.84 1.875 1.875 1.875h.75c1.035 0 1.875-.84 1.875-1.875V4.125c0-1.036-.84-1.875-1.875-1.875h-.75zM9.75 8.625c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-.75a1.875 1.875 0 01-1.875-1.875V8.625zM3 13.125c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v6.75c0 1.035-.84 1.875-1.875 1.875h-.75A1.875 1.875 0 013 19.875v-6.75z"
              />
            </svg>
            Headteacher Dashboard
          </h1>
          <p>Welcome back! Here's your school performance overview.</p>
        </div>
        <div class="page-actions">
          <button class="btn-outline" onclick="toggleFilterPanel()">
            <!-- Heroicon: funnel (solid) -->
            <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
              <path
                fill-rule="evenodd"
                d="M3.792 2.938A49.069 49.069 0 0112 2.25c2.797 0 5.54.236 8.208.688a1.857 1.857 0 011.792 1.857v4.355a1.857 1.857 0 01-.547 1.31L15.75 16.163V21a.75.75 0 01-1.5 0v-4.837a1.857 1.857 0 01.547-1.31l5.703-5.703V4.395a.357.357 0 00-.344-.344A47.563 47.563 0 0012 3.75a47.563 47.563 0 00-8.156.301.357.357 0 00-.344.344v4.81l5.703 5.703c.343.343.546.82.546 1.31V21a.75.75 0 01-1.5 0v-4.837L2.546 10.46A1.857 1.857 0 012 9.15V4.795c0-.98.758-1.81 1.792-1.857z"
                clip-rule="evenodd"
              />
            </svg>
            Filters
          </button>
          <button class="btn-outline" onclick="refreshDashboard()">
            <!-- Heroicon: arrow-path (solid) -->
            <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
              <path
                fill-rule="evenodd"
                d="M4.755 10.059a7.5 7.5 0 0112.548-3.364l1.903 1.903h-3.183a.75.75 0 100 1.5h4.992a.75.75 0 00.75-.75V4.356a.75.75 0 00-1.5 0v3.18l-1.9-1.9A9 9 0 003.306 9.67a.75.75 0 101.45.388zm15.408 3.352a.75.75 0 00-1.449.388 7.5 7.5 0 01-12.548 3.364l-1.902-1.903h3.183a.75.75 0 000-1.5H2.515a.75.75 0 00-.75.75v4.992a.75.75 0 001.5 0v-3.18l1.9 1.9a9 9 0 0015.038-4.035z"
                clip-rule="evenodd"
              />
            </svg>
            Refresh
          </button>
          <button class="btn" onclick="generateComprehensiveReport()">
            <!-- Heroicon: document-text (solid) -->
            <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
              <path
                fill-rule="evenodd"
                d="M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0016.5 9h-1.875a1.875 1.875 0 01-1.875-1.875V5.25A3.75 3.75 0 009 1.5H5.625zM7.5 15a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5A.75.75 0 017.5 15zm.75 2.25a.75.75 0 000 1.5H12a.75.75 0 000-1.5H8.25z"
                clip-rule="evenodd"
              />
              <path
                d="M12.971 1.816A5.23 5.23 0 0114.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 013.434 1.279 9.768 9.768 0 00-6.963-6.963z"
              />
            </svg>
            Generate Report
          </button>
        </div>
      </div>

      <!-- System Alerts -->
      <div class="alerts-section">
        <div class="section-header">
          <h2>
            <!-- Heroicon: exclamation-triangle (solid) -->
            <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
              <path
                fill-rule="evenodd"
                d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z"
                clip-rule="evenodd"
              />
            </svg>
            System Alerts
            <span class="alerts-count"
              >{{ system_alerts|length if system_alerts else 0 }} Alert{{ 's' if
              (system_alerts|length != 1) else '' }}</span
            >
          </h2>
        </div>
        <div class="system-alerts-container">
          {% if system_alerts %} {% for alert in system_alerts %}
          <div class="system-alert alert-{{ alert.type }}">
            <div class="alert-content">
              <div class="alert-icon">
                {% if alert.type == 'critical' %}
                <!-- Heroicon: exclamation-circle (solid) -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    fill-rule="evenodd"
                    d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z"
                    clip-rule="evenodd"
                  />
                </svg>
                {% elif alert.type == 'warning' %}
                <!-- Heroicon: exclamation-triangle (solid) -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    fill-rule="evenodd"
                    d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z"
                    clip-rule="evenodd"
                  />
                </svg>
                {% elif alert.type == 'info' %}
                <!-- Heroicon: information-circle (solid) -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    fill-rule="evenodd"
                    d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm8.706-1.442c1.146-.573 2.437.463 2.126 1.706l-.709 2.836.042-.02a.75.75 0 01.67 1.34l-.04.022c-1.147.573-2.438-.463-2.127-1.706l.71-2.836-.042.02a.75.75 0 11-.671-1.34l.041-.022zM12 9a.75.75 0 100-1.5.75.75 0 000 1.5z"
                    clip-rule="evenodd"
                  />
                </svg>
                {% endif %}
              </div>
              <div class="alert-text">
                <div class="alert-title">
                  <span
                    class="alert-badge badge-{{ 'critical' if alert.type=='critical' else ('warning' if alert.type=='warning' else 'info') }}"
                  >
                    {{ (alert.type or 'info')|capitalize }}
                  </span>
                  {{ alert.title }}
                </div>
                <div class="alert-message">{{ alert.message }}</div>
                <div class="alert-time">
                  {{ alert.timestamp.strftime('%Y-%m-%d %H:%M') if
                  alert.timestamp }}
                </div>
              </div>
            </div>
            <div class="alert-actions">
              <button
                class="btn-sm"
                onclick="showAlertDetails('{{ alert.title }}')"
              >
                Details
              </button>
              <button class="btn-sm btn-outline" onclick="dismissAlert(this)">
                Dismiss
              </button>
            </div>
          </div>
          {% endfor %} {% else %}
          <div class="no-alerts-container">
            <div class="no-alerts-content">
              <!-- Heroicon: shield-check (solid) -->
              <svg
                class="heroicon heroicon-xl"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  fill-rule="evenodd"
                  d="M12.516 2.17a.75.75 0 00-1.032 0 11.209 11.209 0 01-7.877 3.08.75.75 0 00-.722.515A12.74 12.74 0 002.25 9.75c0 5.814 3.051 10.77 7.608 13.566a.75.75 0 00.834 0C15.249 20.52 18.3 15.564 18.3 9.75a12.74 12.74 0 00-.635-4.235.75.75 0 00-.722-.515 11.209 11.209 0 01-7.877-3.08zM15.75 9.75a3 3 0 11-6 0 3 3 0 016 0zm-4.5 0a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"
                  clip-rule="evenodd"
                />
              </svg>
              <h3>All Systems Operational</h3>
              <p>
                No system alerts at this time. All systems are running smoothly.
              </p>
            </div>
          </div>
          {% endif %}
        </div>
      </div>

      <!-- Filter Panel -->
      <div
        id="filterPanel"
        class="filter-panel"
        role="region"
        aria-labelledby="advanced-filters-title"
        style="display: none"
      >
        <div class="filter-header">
          <h3 id="advanced-filters-title">
            <!-- Heroicon: adjustments-horizontal (solid) -->
            <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M18.75 12.75h1.5a.75.75 0 000-1.5h-1.5a.75.75 0 000 1.5zM12 6a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5A.75.75 0 0112 6zM12 18a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5A.75.75 0 0112 18zM3.75 6.75h1.5a.75.75 0 100-1.5h-1.5a.75.75 0 000 1.5zM5.25 18.75h-1.5a.75.75 0 010-1.5h1.5a.75.75 0 010 1.5zM3 12a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5A.75.75 0 013 12zM9 3.75a2.25 2.25 0 100 4.5 2.25 2.25 0 000-4.5zM12.75 12a2.25 2.25 0 114.5 0 2.25 2.25 0 01-4.5 0zM9 15.75a2.25 2.25 0 100 4.5 2.25 2.25 0 000-4.5z"
              />
            </svg>
            Advanced Filters
          </h3>
          <div style="display: flex; gap: 0.5rem; align-items: center">
            <button
              class="btn-sm btn-outline"
              onclick="resetFilters()"
              title="Reset all filters"
              aria-label="Reset all filters"
            >
              Reset All
            </button>
            <button
              class="btn-sm btn-outline btn-close"
              onclick="toggleFilterPanel()"
              title="Close"
              aria-label="Close filters"
            >
              Close
            </button>
          </div>
        </div>
        <div class="filter-content">
          <div class="filter-row">
            <div class="filter-group">
              <label for="gradeFilter">Grade:</label>
              <select
                id="gradeFilter"
                class="form-control"
                title="Select grade"
                aria-label="Select grade"
              >
                <option value="">All Grades</option>
                {% if dashboard_stats.learners_per_grade %} {% for grade_name in
                dashboard_stats.learners_per_grade.keys() %}
                <option value="{{ grade_name }}">{{ grade_name }}</option>
                {% endfor %} {% else %}
                <option value="7">Grade 7</option>
                <option value="8">Grade 8</option>
                <option value="9">Grade 9</option>
                <option value="10">Grade 10</option>
                <option value="11">Grade 11</option>
                <option value="12">Grade 12</option>
                {% endif %}
              </select>
            </div>
            <div class="filter-group">
              <label for="termFilter">Term:</label>
              <select
                id="termFilter"
                class="form-control"
                title="Select term"
                aria-label="Select term"
              >
                <option value="">All Terms</option>
                <option value="1">Term 1</option>
                <option value="2">Term 2</option>
                <option value="3">Term 3</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="performanceFilter">Performance Level:</label>
              <select
                id="performanceFilter"
                class="form-control"
                title="Select performance level"
                aria-label="Select performance level"
              >
                <option value="">All Levels</option>
                <option value="EE">Exceeds Expectations</option>
                <option value="ME">Meets Expectations</option>
                <option value="AE">Approaches Expectations</option>
                <option value="BE">Below Expectations</option>
              </select>
            </div>
          </div>
          <div class="filter-row">
            <div class="filter-group">
              <label for="dateFrom">From Date:</label>
              <input
                type="date"
                id="dateFrom"
                class="form-control"
                title="From date"
                aria-label="From date"
              />
            </div>
            <div class="filter-group">
              <label for="dateTo">To Date:</label>
              <input
                type="date"
                id="dateTo"
                class="form-control"
                title="To date"
                aria-label="To date"
              />
            </div>
            <div class="filter-group filter-actions">
              <button
                class="btn"
                onclick="applyFilters()"
                title="Apply filters"
                aria-label="Apply filters"
              >
                <!-- Heroicon: magnifying-glass (solid) -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    fill-rule="evenodd"
                    d="M10.5 3.75a6.75 6.75 0 100 13.5 6.75 6.75 0 000-13.5zM2.25 10.5a8.25 8.25 0 1114.59 5.28l4.69 4.69a.75.75 0 11-1.06 1.06l-4.69-4.69A8.25 8.25 0 012.25 10.5z"
                    clip-rule="evenodd"
                  />
                </svg>
                Apply Filters
              </button>
            </div>
          </div>
        </div>
        <div class="filter-actions-row">
          <button
            class="btn"
            onclick="applyFilters()"
            aria-label="Apply filters"
          >
            Apply Filters
          </button>
          <button
            class="btn-outline"
            onclick="toggleFilterPanel()"
            aria-label="Close filters"
          >
            Close
          </button>
        </div>
      </div>

      <!-- Premium Dashboard Statistics Section -->
      <div class="stats-section">
        <div class="section-header premium-header">
          <div class="header-content">
            <h2 class="section-title">
              <div class="header-icon">
                <!-- Heroicon: chart-bar (solid) -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    d="M18.375 2.25c-1.035 0-1.875.84-1.875 1.875v15.75c0 1.035.84 1.875 1.875 1.875h.75c1.035 0 1.875-.84 1.875-1.875V4.125c0-1.036-.84-1.875-1.875-1.875h-.75zM9.75 8.625c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-.75a1.875 1.875 0 01-1.875-1.875V8.625zM3 13.125c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v6.75c0 1.035-.84 1.875-1.875 1.875h-.75A1.875 1.875 0 013 19.875v-6.75z"
                  />
                </svg>
              </div>
              <span class="title-text">School Overview</span>
            </h2>
            <p class="section-subtitle">
              Real-time insights into your school's performance and statistics
            </p>
          </div>
          <div class="header-actions">
            <button
              class="btn-outline premium-btn"
              onclick="refreshStats()"
              title="Refresh statistics"
              aria-label="Refresh statistics"
            >
              <!-- Heroicon: arrow-path (solid) -->
              <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                <path
                  fill-rule="evenodd"
                  d="M4.755 10.059a7.5 7.5 0 0112.548-3.364l1.903 1.903h-3.183a.75.75 0 100 1.5h4.992a.75.75 0 00.75-.75V4.356a.75.75 0 00-1.5 0v3.18l-1.9-1.9A9 9 0 003.306 9.67a.75.75 0 101.45.388zm15.408 3.352a.75.75 0 00-1.449.388 7.5 7.5 0 01-12.548 3.364l-1.902-1.903h3.183a.75.75 0 000-1.5H2.515a.75.75 0 00-.75.75v4.992a.75.75 0 001.5 0v-3.18l1.9 1.9a9 9 0 0015.038-4.035z"
                  clip-rule="evenodd"
                />
              </svg>
              <span>Refresh</span>
            </button>
            <button
              class="btn premium-btn"
              onclick="exportStats()"
              title="Export statistics as CSV"
              aria-label="Export statistics as CSV"
            >
              <!-- Heroicon: arrow-down-tray (solid) -->
              <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                <path
                  fill-rule="evenodd"
                  d="M12 2.25a.75.75 0 01.75.75v11.69l3.22-3.22a.75.75 0 111.06 1.06l-4.5 4.5a.75.75 0 01-1.06 0l-4.5-4.5a.75.75 0 111.06-1.06l3.22 3.22V3a.75.75 0 01.75-.75zm-9 13.5a.75.75 0 01.75.75v2.25a1.5 1.5 0 001.5 1.5h13.5a1.5 1.5 0 001.5-1.5V16.5a.75.75 0 011.5 0v2.25a3 3 0 01-3 3H5.25a3 3 0 01-3-3V16.5a.75.75 0 01.75-.75z"
                  clip-rule="evenodd"
                />
              </svg>
              <span>Export</span>
            </button>
          </div>
        </div>

        <!-- Quick Stats with Real Data and Heroicons -->
        <div class="stats-grid" id="statsGrid">
          <div
            class="stat-card animate-fade-in-up"
            style="animation-delay: 0.1s"
          >
            <div class="stat-icon primary">
              <!-- Heroicon: users (solid) -->
              <svg
                class="heroicon heroicon-lg"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  fill-rule="evenodd"
                  d="M8.25 6.75a3.75 3.75 0 117.5 0 3.75 3.75 0 01-7.5 0zM15.75 9.75a3 3 0 116 0 3 3 0 01-6 0zM2.25 9.75a3 3 0 116 0 3 3 0 01-6 0zM6.31 15.117A6.745 6.745 0 0112 12a6.745 6.745 0 016.709 7.498.75.75 0 01-.372.568A12.696 12.696 0 0112 21.75c-2.305 0-4.47-.612-6.337-1.684a.75.75 0 01-.372-.568 6.787 6.787 0 011.019-1.381z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-number" id="total-assessed">
                {{ total_students or 0 }}
              </div>
              <div class="stat-label">Total Students</div>
              <div class="stat-trend">
                <!-- Heroicon: users mini -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    d="M7 8a3 3 0 100-6 3 3 0 000 6zM14.5 9a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM1.615 16.428a1.224 1.224 0 01-.569-1.175 6.002 6.002 0 0111.908 0c.058.467-.172.92-.57 1.174A9.953 9.953 0 017 18a9.953 9.953 0 01-5.385-1.572zM14.5 16h-.106c.07-.297.088-.611.048-.933a7.47 7.47 0 00-1.588-3.755 4.502 4.502 0 015.874 2.636.818.818 0 01-.36.98A7.465 7.465 0 0114.5 16z"
                  />
                </svg>
                Across all grades
              </div>
            </div>
          </div>

          <div
            class="stat-card animate-fade-in-up"
            style="animation-delay: 0.2s"
          >
            <div class="stat-icon success">
              <!-- Heroicon: chart-bar (solid) -->
              <svg
                class="heroicon heroicon-lg"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M18.375 2.25c-1.035 0-1.875.84-1.875 1.875v15.75c0 1.035.84 1.875 1.875 1.875h.75c1.035 0 1.875-.84 1.875-1.875V4.125c0-1.036-.84-1.875-1.875-1.875h-.75zM9.75 8.625c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-.75a1.875 1.875 0 01-1.875-1.875V8.625zM3 13.125c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v6.75c0 1.035-.84 1.875-1.875 1.875h-.75A1.875 1.875 0 013 19.875v-6.75z"
                />
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-number" id="performance-rate">
                {{ "%.1f"|format(dashboard_stats.avg_performance or 0) }}%
              </div>
              <div class="stat-label">School Average</div>
              <div class="stat-trend">
                {% if dashboard_stats.avg_performance >= 80 %}
                <!-- Heroicon: trophy (solid) -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    fill-rule="evenodd"
                    d="M5.166 2.621v.858c-1.035.148-2.059.33-3.071.543a.75.75 0 00-.584.859 6.753 6.753 0 006.138 5.6 6.73 6.73 0 002.743 1.346A6.707 6.707 0 019.279 15H8.54c-1.036 0-1.875.84-1.875 1.875V19.5h-.75a2.25 2.25 0 00-2.25 2.25c0 .414.336.75.75.75h9a.75.75 0 00.75-.75 2.25 2.25 0 00-2.25-2.25H12v-2.625c0-1.036-.84-1.875-1.875-1.875h-.739a6.706 6.706 0 01-1.112-3.173 6.73 6.73 0 002.743-1.347 6.753 6.753 0 006.139-5.6.75.75 0 00-.585-.858 47.077 47.077 0 00-3.07-.543V2.62a.75.75 0 00-.658-.744 49.22 49.22 0 00-6.093-.377c-2.063 0-4.096.128-6.093.377a.75.75 0 00-.657.744z"
                    clip-rule="evenodd"
                  />
                </svg>
                Excellent performance {% elif dashboard_stats.avg_performance >=
                60 %}
                <!-- Heroicon: check-circle (solid) -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    fill-rule="evenodd"
                    d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z"
                    clip-rule="evenodd"
                  />
                </svg>
                Good performance {% else %}
                <!-- Heroicon: exclamation-triangle (solid) -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    fill-rule="evenodd"
                    d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z"
                    clip-rule="evenodd"
                  />
                </svg>
                Needs improvement {% endif %}
              </div>
            </div>
          </div>

          <div
            class="stat-card animate-fade-in-up"
            style="animation-delay: 0.3s"
          >
            <div class="stat-icon info">
              <!-- Heroicon: clipboard-document-list (solid) -->
              <svg
                class="heroicon heroicon-lg"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  fill-rule="evenodd"
                  d="M7.502 6h7.128A3.375 3.375 0 0118 9.375v9.375a3 3 0 003-3V6.108c0-1.505-1.125-2.811-2.664-2.94a48.972 48.972 0 00-.673-.05A3 3 0 0015 1.5h-1.5a3 3 0 00-2.663 1.618c-.225.015-.45.032-.673.05C8.662 3.295 7.554 4.542 7.502 6zM13.5 3A1.5 1.5 0 0012 4.5h4.5A1.5 1.5 0 0015 3h-1.5z"
                  clip-rule="evenodd"
                />
                <path
                  fill-rule="evenodd"
                  d="M3 9.375C3 8.339 3.84 7.5 4.875 7.5h9.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-9.75A1.875 1.875 0 013 20.625V9.375zM6 12a.75.75 0 01.75-.75h.008a.75.75 0 01.75.75v.008a.75.75 0 01-.75.75H6.75a.75.75 0 01-.75-.75V12zm2.25 0a.75.75 0 01.75-.75h3.75a.75.75 0 010 1.5H9a.75.75 0 01-.75-.75zm0 2.25a.75.75 0 01.75-.75h3.75a.75.75 0 010 1.5H9a.75.75 0 01-.75-.75zm0 2.25a.75.75 0 01.75-.75h3.75a.75.75 0 010 1.5H9a.75.75 0 01-.75-.75z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-number" id="total-assessments">
                {{ total_assessments or 0 }}
              </div>
              <div class="stat-label">Assessment Types</div>
              <div class="stat-trend neutral">
                <!-- Heroicon: clipboard-document-list mini -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    fill-rule="evenodd"
                    d="M15.988 3.012A2.25 2.25 0 0118 5.25v6.5A2.25 2.25 0 0115.75 14H13.5V7A2.5 2.5 0 0011 4.5H8.128a2.252 2.252 0 011.884-1.488A2.25 2.25 0 0112.25 1h1.5a2.25 2.25 0 012.238 2.012zM11.5 3.25a.75.75 0 01.75-.75h1.5a.75.75 0 01.75.75v.25h-3v-.25z"
                    clip-rule="evenodd"
                  />
                  <path
                    fill-rule="evenodd"
                    d="M2 7a1 1 0 011-1h8a1 1 0 011 1v10a1 1 0 01-1 1H3a1 1 0 01-1-1V7zm2 3.25a.75.75 0 01.75-.75h4.5a.75.75 0 010 1.5h-4.5a.75.75 0 01-.75-.75zm0 2.5a.75.75 0 01.75-.75h4.5a.75.75 0 010 1.5h-4.5a.75.75 0 01-.75-.75z"
                    clip-rule="evenodd"
                  />
                </svg>
                Available assessments
              </div>
            </div>
          </div>

          <div
            class="stat-card animate-fade-in-up"
            style="animation-delay: 0.4s"
          >
            <div class="stat-icon success">
              <!-- Heroicon: academic-cap (solid) -->
              <svg
                class="heroicon heroicon-lg"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M11.7 2.805a.75.75 0 01.6 0A60.65 60.65 0 0122.83 8.72a.75.75 0 01-.231 1.337 49.949 49.949 0 00-9.902 3.912l-.003.002-.34.18a.75.75 0 01-.707 0A50.009 50.009 0 007.5 12.174v-.224c0-.131.067-.248.172-.311a54.614 54.614 0 014.653-2.52.75.75 0 00-.65-1.352 56.129 56.129 0 00-4.78 2.589 1.858 1.858 0 00-.859 1.228 49.803 49.803 0 00-4.634-1.527.75.75 0 01-.231-1.337A60.653 60.653 0 0111.7 2.805z"
                />
                <path
                  d="M13.06 15.473a48.45 48.45 0 017.666-3.282c.134 1.414.22 2.843.255 4.285a.75.75 0 01-.46.71 47.878 47.878 0 00-8.105 4.342.75.75 0 01-.832 0 47.877 47.877 0 00-8.104-4.342.75.75 0 01-.461-.71c.035-1.442.121-2.87.255-4.286.921.304 1.83.634 2.726.99v1.27a1.5 1.5 0 00-.14 2.508c-.09.38-.222.753-.397 1.11.452.213.901.434 1.346.661a6.729 6.729 0 00.551-1.608 1.5 1.5 0 00.14-2.67v-.645a48.549 48.549 0 013.44 1.668 2.25 2.25 0 002.12 0z"
                />
                <path
                  d="M4.462 19.462c.42-.419.753-.89 1-1.394.453.213.902.434 1.347.661a6.743 6.743 0 01-1.286 1.794.75.75 0 11-1.06-1.06z"
                />
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-number" id="total-teachers">
                {{ total_teachers or 0 }}
              </div>
              <div class="stat-label">Active Teachers</div>
              <div class="stat-trend">
                <!-- Heroicon: users mini -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    d="M7 8a3 3 0 100-6 3 3 0 000 6zM14.5 9a2.5 2.5 0 100-5 2.5 2.5 0 000 5zM1.615 16.428a1.224 1.224 0 01-.569-1.175 6.002 6.002 0 0111.908 0c.058.467-.172.92-.57 1.174A9.953 9.953 0 017 18a9.953 9.953 0 01-5.385-1.572zM14.5 16h-.106c.07-.297.088-.611.048-.933a7.47 7.47 0 00-1.588-3.755 4.502 4.502 0 015.874 2.636.818.818 0 01-.36.98A7.465 7.465 0 0114.5 16z"
                  />
                </svg>
                Teaching staff
              </div>
            </div>
          </div>

          <div
            class="stat-card animate-fade-in-up"
            style="animation-delay: 0.5s"
          >
            <div class="stat-icon info">
              <!-- Heroicon: book-open (solid) -->
              <svg
                class="heroicon heroicon-lg"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M11.25 4.533A9.707 9.707 0 006 3a9.735 9.735 0 00-3.25.555.75.75 0 00-.5.707v14.25a.75.75 0 001 .707A8.237 8.237 0 016 18.75c1.995 0 3.823.707 5.25 1.886V4.533zM12.75 20.636A8.214 8.214 0 0118 18.75c.966 0 1.89.166 2.75.47a.75.75 0 001-.708V4.262a.75.75 0 00-.5-.707A9.735 9.735 0 0018 3a9.707 9.707 0 00-5.25 1.533v16.103z"
                />
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-number" id="active-subjects">
                {{ total_subjects or 0 }}
              </div>
              <div class="stat-label">Active Subjects</div>
              <div class="stat-trend neutral">
                <!-- Heroicon: academic-cap mini -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    fill-rule="evenodd"
                    d="M9.664 1.319a.75.75 0 01.672 0 41.059 41.059 0 018.198 5.424.75.75 0 01-.254 1.285 31.372 31.372 0 00-7.86 3.83.75.75 0 01-.84 0 31.508 31.508 0 00-2.08-1.287V9.394c0-.244.116-.463.302-.592a35.504 35.504 0 013.305-2.033.75.75 0 00-.714-1.319 37 37 0 00-3.446 2.12A2.216 2.216 0 006 9.393v.38a31.293 31.293 0 00-4.28-1.746.75.75 0 01-.254-1.285A41.059 41.059 0 019.664 1.319zM11.32 9.67a32.824 32.824 0 013.6 2.573 1.25 1.25 0 01.548 1.037v3.96c0 .414-.335.75-.75.75a32.05 32.05 0 00-3.895 0 .75.75 0 01-.75-.75V12.28c0-.414.336-.75.75-.75a30.99 30.99 0 00.497.04z"
                    clip-rule="evenodd"
                  />
                </svg>
                Curriculum subjects
              </div>
            </div>
          </div>

          <div
            class="stat-card animate-fade-in-up"
            style="animation-delay: 0.6s"
          >
            <div class="stat-icon warning">
              <!-- Heroicon: building-office (solid) -->
              <svg
                class="heroicon heroicon-lg"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  fill-rule="evenodd"
                  d="M3 2.25a.75.75 0 01.75-.75h16.5a.75.75 0 01.75.75v20.25a.75.75 0 01-.75.75H3.75a.75.75 0 01-.75-.75V2.25zm6 6.75a.75.75 0 01.75-.75h4.5a.75.75 0 01.75.75v.75h.75a.75.75 0 01.75.75v3a.75.75 0 01-.75.75H15v.75a.75.75 0 01-.75.75h-4.5a.75.75 0 01-.75-.75v-.75H8.25a.75.75 0 01-.75-.75v-3a.75.75 0 01.75-.75H9V9zm1.5 1.5v3h3v-3h-3z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-number" id="active-classes">
                {{ total_classes or 0 }}
              </div>
              <div class="stat-label">Active Classes</div>
              <div class="stat-trend">
                <!-- Heroicon: building-office mini -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 20 20">
                  <path
                    fill-rule="evenodd"
                    d="M1 2.75A.75.75 0 011.75 2h16.5a.75.75 0 01.75.75v14.5a.75.75 0 01-.75.75H1.75a.75.75 0 01-.75-.75V2.75zM7.5 8a.75.75 0 01.75-.75h3.5a.75.75 0 01.75.75v.75h.75a.75.75 0 01.75.75v2.25a.75.75 0 01-.75.75H12v.75a.75.75 0 01-.75.75h-3.5a.75.75 0 01-.75-.75v-.75h-.75a.75.75 0 01-.75-.75V9.5a.75.75 0 01.75-.75H7.5V8zm1.5 1.5v1.5h2v-1.5h-2z"
                    clip-rule="evenodd"
                  />
                </svg>
                Class streams
              </div>
            </div>
          </div>

          {% if dashboard_stats.top_class != 'N/A' %}
          <div
            class="stat-card animate-fade-in-up"
            style="animation-delay: 0.7s"
          >
            <div class="stat-icon primary">
              <!-- Heroicon: trophy (solid) -->
              <svg
                class="heroicon heroicon-lg"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  fill-rule="evenodd"
                  d="M5.166 2.621v.858c-1.035.148-2.059.33-3.071.543a.75.75 0 00-.584.859 6.753 6.753 0 006.138 5.6 6.73 6.73 0 002.743 1.346A6.707 6.707 0 019.279 15H8.54c-1.036 0-1.875.84-1.875 1.875V19.5h-.75a2.25 2.25 0 00-2.25 2.25c0 .414.336.75.75.75h9a.75.75 0 00.75-.75 2.25 2.25 0 00-2.25-2.25H12v-2.625c0-1.036-.84-1.875-1.875-1.875h-.739a6.706 6.706 0 01-1.112-3.173 6.73 6.73 0 002.743-1.347 6.753 6.753 0 006.139-5.6.75.75 0 00-.585-.858 47.077 47.077 0 00-3.07-.543V2.62a.75.75 0 00-.658-.744 49.22 49.22 0 00-6.093-.377c-2.063 0-4.096.128-6.093.377a.75.75 0 00-.657.744z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-number" id="top-class-score">
                {{ "%.1f"|format(top_class_score or 0) }}%
              </div>
              <div class="stat-label">Top Performing Class</div>
              <div class="stat-trend">
                <!-- Heroicon: star (solid) -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    fill-rule="evenodd"
                    d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z"
                    clip-rule="evenodd"
                  />
                </svg>
                {{ top_class or 'N/A' }}
              </div>
            </div>
          </div>
          {% endif %}

          <div
            class="stat-card animate-fade-in-up"
            style="animation-delay: 0.8s"
          >
            <div class="stat-icon info">
              <!-- Heroicon: calendar-days (solid) -->
              <svg
                class="heroicon heroicon-lg"
                fill="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  d="M12.75 12.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM7.5 15.75a.75.75 0 100-1.5.75.75 0 000 1.5zM8.25 17.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM9.75 15.75a.75.75 0 100-1.5.75.75 0 000 1.5zM10.5 17.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM12 15.75a.75.75 0 100-1.5.75.75 0 000 1.5zM12.75 17.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM14.25 15.75a.75.75 0 100-1.5.75.75 0 000 1.5zM15 17.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM16.5 15.75a.75.75 0 100-1.5.75.75 0 000 1.5zM15 12.75a.75.75 0 11-1.5 0 .75.75 0 011.5 0zM16.5 13.5a.75.75 0 100-1.5.75.75 0 000 1.5z"
                />
                <path
                  fill-rule="evenodd"
                  d="M6.75 2.25A.75.75 0 017.5 3v1.5h9V3A.75.75 0 0118 3v1.5h.75a3 3 0 013 3v11.25a3 3 0 01-3 3H5.25a3 3 0 01-3-3V7.5a3 3 0 013-3H6V3a.75.75 0 01.75-.75zm13.5 9a1.5 1.5 0 00-1.5-1.5H5.25a1.5 1.5 0 00-1.5 1.5v7.5a1.5 1.5 0 001.5 1.5h13.5a1.5 1.5 0 001.5-1.5v-7.5z"
                  clip-rule="evenodd"
                />
              </svg>
            </div>
            <div class="stat-content">
              <div class="stat-number" id="current-term">
                {{ current_term or 'Term 1' }}
              </div>
              <div class="stat-label">Current Term</div>
              <div class="stat-trend">
                <!-- Heroicon: clock (solid) -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    fill-rule="evenodd"
                    d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zM12.75 6a.75.75 0 00-1.5 0v6c0 .414.336.75.75.75h4.5a.75.75 0 000-1.5h-3.75V6z"
                    clip-rule="evenodd"
                  />
                </svg>
                {{ current_academic_year or '2025/2026' }}
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- End stats-section -->

      <!-- Charts Section -->
      <div class="charts-section">
        <div class="charts-grid">
          <div class="chart-container">
            <div class="chart-header">
              <h3>Performance Distribution</h3>
              <div class="chart-actions">
                <button class="btn-sm btn-outline" onclick="resetFilters()">
                  <!-- Heroicon: arrow-path (solid) -->
                  <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      fill-rule="evenodd"
                      d="M4.755 10.059a7.5 7.5 0 0112.548-3.364l1.903 1.903h-3.183a.75.75 0 100 1.5h4.992a.75.75 0 00.75-.75V4.356a.75.75 0 00-1.5 0v3.18l-1.9-1.9A9 9 0 003.306 9.67a.75.75 0 101.45.388zm15.408 3.352a.75.75 0 00-1.449.388 7.5 7.5 0 01-12.548 3.364l-1.902-1.903h3.183a.75.75 0 000-1.5H2.515a.75.75 0 00-.75.75v4.992a.75.75 0 001.5 0v-3.18l1.9 1.9a9 9 0 0015.038-4.035z"
                      clip-rule="evenodd"
                    />
                  </svg>
                  Reset
                </button>
              </div>
            </div>
            <div class="chart-content">
              <canvas id="performanceDonutChart"></canvas>
            </div>
          </div>

          <div class="chart-container">
            <div class="chart-header">
              <h3>Class Comparison</h3>
              <div class="chart-actions">
                <button
                  class="btn-sm btn-outline"
                  onclick="exportChartsAsPDF()"
                >
                  <!-- Heroicon: arrow-down-tray (solid) -->
                  <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                    <path
                      fill-rule="evenodd"
                      d="M12 2.25a.75.75 0 01.75.75v11.69l3.22-3.22a.75.75 0 111.06 1.06l-4.5 4.5a.75.75 0 01-1.06 0l-4.5-4.5a.75.75 0 111.06-1.06l3.22 3.22V3a.75.75 0 01.75-.75zm-9 13.5a.75.75 0 01.75.75v2.25a1.5 1.5 0 001.5 1.5h13.5a1.5 1.5 0 001.5-1.5V16.5a.75.75 0 011.5 0v2.25a3 3 0 01-3 3H5.25a3 3 0 01-3-3V16.5a.75.75 0 01.75-.75z"
                      clip-rule="evenodd"
                    />
                  </svg>
                  Export PDF
                </button>
              </div>
            </div>
            <div class="chart-content">
              <canvas id="classComparisonChart"></canvas>
            </div>
          </div>
        </div>
      </div>

      <!-- Advanced Analytics -->
      <div class="analytics-section">
        <div class="section-header">
          <h2>
            <!-- Heroicon: presentation-chart-line (solid) -->
            <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
              <path
                fill-rule="evenodd"
                d="M2.25 2.25a.75.75 0 000 1.5H3v10.5a3 3 0 003 3h1.21l-1.172 3.513a.75.75 0 001.424.474l.329-.987h8.418l.33.987a.75.75 0 001.422-.474L15.79 17.25H18a3 3 0 003-3V3.75h.75a.75.75 0 000-1.5H2.25zm6.04 16.5l.5-1.5h6.42l.5 1.5H8.29zm7.46-12a.75.75 0 00-1.5 0v6a.75.75 0 001.5 0v-6zm-3 2.25a.75.75 0 00-1.5 0v3.75a.75.75 0 001.5 0V9zm-3 2.25a.75.75 0 00-1.5 0v1.5a.75.75 0 001.5 0v-1.5z"
                clip-rule="evenodd"
              />
            </svg>
            Advanced Analytics
          </h2>
          <button class="btn-outline" onclick="openAnalyticsDashboard()">
            <!-- Heroicon: arrow-top-right-on-square (solid) -->
            <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
              <path
                fill-rule="evenodd"
                d="M15.75 2.25H21a.75.75 0 01.75.75v5.25a.75.75 0 01-1.5 0V4.81L8.03 17.03a.75.75 0 01-1.06-1.06L19.19 3.75H15.75a.75.75 0 010-1.5z"
                clip-rule="evenodd"
              />
              <path
                fill-rule="evenodd"
                d="M1.5 4.5a3 3 0 013-3h1.372c.86 0 1.653.349 2.227.913l1.34 1.34a1.5 1.5 0 001.06.44H18A1.5 1.5 0 0119.5 6v9A1.5 1.5 0 0118 16.5v-2.25a.75.75 0 00-1.5 0v2.25a3 3 0 01-3 3H4.5a3 3 0 01-3-3V4.5z"
                clip-rule="evenodd"
              />
            </svg>
            Full Analytics
          </button>
        </div>

        <div class="analytics-grid">
          <!-- Performance Heatmap -->
          <div class="analytics-card">
            <div class="analytics-header">
              <h3>Performance Heatmap</h3>
              <select id="heatmapMetric" onchange="updateHeatmap()">
                <option value="average">Class Average</option>
                <option value="excellence">Excellence Rate</option>
                <option value="mastery">Mastery Rate</option>
              </select>
            </div>
            <div class="heatmap-container" id="heatmapContainer"></div>
          </div>

          <!-- Performance Alerts -->
          <div class="analytics-card">
            <div class="analytics-header">
              <h3>Performance Alerts</h3>
              <button class="btn-sm" onclick="generatePerformanceAlerts()">
                <!-- Heroicon: arrow-path (solid) -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    fill-rule="evenodd"
                    d="M4.755 10.059a7.5 7.5 0 0112.548-3.364l1.903 1.903h-3.183a.75.75 0 100 1.5h4.992a.75.75 0 00.75-.75V4.356a.75.75 0 00-1.5 0v3.18l-1.9-1.9A9 9 0 003.306 9.67a.75.75 0 101.45.388zm15.408 3.352a.75.75 0 00-1.449.388 7.5 7.5 0 01-12.548 3.364l-1.902-1.903h3.183a.75.75 0 000-1.5H2.515a.75.75 0 00-.75.75v4.992a.75.75 0 001.5 0v-3.18l1.9 1.9a9 9 0 0015.038-4.035z"
                    clip-rule="evenodd"
                  />
                </svg>
                Refresh
              </button>
            </div>
            <div class="alerts-container" id="performanceAlerts"></div>
          </div>
        </div>

        <!-- Drill-down Analytics -->
        <div class="drill-down-section">
          <div class="section-header">
            <h3>Detailed Analytics</h3>
            <p class="section-subtitle">
              Click on any chart element above for detailed analysis
            </p>
          </div>
          <div id="drillDownContainer"></div>
        </div>
      </div>

      <!-- Performance Assessment Results -->
      <div class="performance-section">
        <div class="section-header">
          <h2>
            <!-- Heroicon: chart-bar (solid) -->
            <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M18.375 2.25c-1.035 0-1.875.84-1.875 1.875v15.75c0 1.035.84 1.875 1.875 1.875h.75c1.035 0 1.875-.84 1.875-1.875V4.125c0-1.036-.84-1.875-1.875-1.875h-.75zM9.75 8.625c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-.75a1.875 1.875 0 01-1.875-1.875V8.625zM3 13.125c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v6.75c0 1.035-.84 1.875-1.875 1.875h-.75A1.875 1.875 0 013 19.875v-6.75z"
              />
            </svg>
            Detailed Assessment Results
          </h2>
          <div class="section-actions">
            <button class="btn-outline" onclick="toggleFilters()">
              <!-- Heroicon: funnel (solid) -->
              <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                <path
                  fill-rule="evenodd"
                  d="M3.792 2.938A49.069 49.069 0 0112 2.25c2.797 0 5.54.236 8.208.688a1.857 1.857 0 011.792 1.857v4.355a1.857 1.857 0 01-.547 1.31L15.75 16.163V21a.75.75 0 01-1.5 0v-4.837a1.857 1.857 0 01.547-1.31l5.703-5.703V4.395a.357.357 0 00-.344-.344A47.563 47.563 0 0012 3.75a47.563 47.563 0 00-8.156.301.357.357 0 00-.344.344v4.81l5.703 5.703c.343.343.546.82.546 1.31V21a.75.75 0 01-1.5 0v-4.837L2.546 10.46A1.857 1.857 0 012 9.15V4.795c0-.98.758-1.81 1.792-1.857z"
                  clip-rule="evenodd"
                />
              </svg>
              Filter Results
            </button>
            <button class="btn-outline" onclick="exportPerformanceData()">
              <!-- Heroicon: arrow-down-tray (solid) -->
              <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                <path
                  fill-rule="evenodd"
                  d="M12 2.25a.75.75 0 01.75.75v11.69l3.22-3.22a.75.75 0 111.06 1.06l-4.5 4.5a.75.75 0 01-1.06 0l-4.5-4.5a.75.75 0 111.06-1.06l3.22 3.22V3a.75.75 0 01.75-.75zm-9 13.5a.75.75 0 01.75.75v2.25a1.5 1.5 0 001.5 1.5h13.5a1.5 1.5 0 001.5-1.5V16.5a.75.75 0 011.5 0v2.25a3 3 0 01-3 3H5.25a3 3 0 01-3-3V16.5a.75.75 0 01.75-.75z"
                  clip-rule="evenodd"
                />
              </svg>
              Export CSV
            </button>
          </div>
        </div>

        <!-- Performance Filters -->
        <div
          id="performance-filters"
          class="performance-filters"
          style="display: none"
        >
          <div class="filters-grid">
            <div class="filter-item">
              <label for="grade-filter">Grade:</label>
              <select id="grade-filter" onchange="filterPerformanceData()">
                <option value="">All Grades</option>
                {% if dashboard_stats.learners_per_grade %} {% for grade_name in
                dashboard_stats.learners_per_grade.keys() %}
                <option value="{{ grade_name }}">{{ grade_name }}</option>
                {% endfor %} {% else %}
                <option value="7">Grade 7</option>
                <option value="8">Grade 8</option>
                <option value="9">Grade 9</option>
                <option value="10">Grade 10</option>
                <option value="11">Grade 11</option>
                <option value="12">Grade 12</option>
                {% endif %}
              </select>
            </div>
            <div class="filter-item">
              <label for="term-filter">Term:</label>
              <select id="term-filter" onchange="filterPerformanceData()">
                <option value="">All Terms</option>
                <option value="1">Term 1</option>
                <option value="2">Term 2</option>
                <option value="3">Term 3</option>
              </select>
            </div>
            <div class="filter-item">
              <label for="assessment-filter">Assessment:</label>
              <select id="assessment-filter" onchange="filterPerformanceData()">
                <option value="">All Assessments</option>
                <option value="Midterm">Midterm</option>
                <option value="Final">Final</option>
                <option value="Quiz">Quiz</option>
              </select>
            </div>
            <div class="filter-item">
              <button class="btn-outline" onclick="filterPerformanceData()">
                <!-- Heroicon: magnifying-glass (solid) -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    fill-rule="evenodd"
                    d="M10.5 3.75a6.75 6.75 0 100 13.5 6.75 6.75 0 000-13.5zM2.25 10.5a8.25 8.25 0 1114.59 5.28l4.69 4.69a.75.75 0 11-1.06 1.06l-4.69-4.69A8.25 8.25 0 012.25 10.5z"
                    clip-rule="evenodd"
                  />
                </svg>
                Apply
              </button>
            </div>
          </div>
        </div>

        <!-- Performance Table -->
        <div class="performance-table-container">
          <div class="table-responsive">
            <table class="performance-table">
              <thead>
                <tr>
                  <th>Grade & Stream</th>
                  <th>Term</th>
                  <th>Assessment</th>
                  <th>Students</th>
                  <th>Class Avg</th>
                  <th>EE1</th>
                  <th>EE2</th>
                  <th>ME1</th>
                  <th>ME2</th>
                  <th>AE1</th>
                  <th>AE2</th>
                  <th>BE1</th>
                  <th>BE2</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for data in performance_data %}
                <tr
                  class="performance-row"
                  data-grade="{{ data.grade }}"
                  data-term="{{ data.term }}"
                  data-assessment="{{ data.assessment_type }}"
                  data-average="{{ data.class_average }}"
                >
                  <td class="class-info">
                    <strong>{{ data.grade }} {{ data.stream }}</strong>
                  </td>
                  <td>Term {{ data.term }}</td>
                  <td>{{ data.assessment_type }}</td>
                  <td class="student-count">{{ data.total_students }}</td>
                  <td class="class-average">
                    <span
                      class="average-badge {% if data.class_average >= 80 %}average-excellent{% elif data.class_average >= 60 %}average-good{% elif data.class_average >= 40 %}average-needs-improvement{% else %}average-poor{% endif %}"
                    >
                      {{ "%.1f"|format(data.class_average) }}%
                    </span>
                  </td>
                  <td class="performance-cell">
                    {{ data.performance_counts.EE1 or 0 }}
                  </td>
                  <td class="performance-cell">
                    {{ data.performance_counts.EE2 or 0 }}
                  </td>
                  <td class="performance-cell">
                    {{ data.performance_counts.ME1 or 0 }}
                  </td>
                  <td class="performance-cell">
                    {{ data.performance_counts.ME2 or 0 }}
                  </td>
                  <td class="performance-cell">
                    {{ data.performance_counts.AE1 or 0 }}
                  </td>
                  <td class="performance-cell">
                    {{ data.performance_counts.AE2 or 0 }}
                  </td>
                  <td class="performance-cell">
                    {{ data.performance_counts.BE1 or 0 }}
                  </td>
                  <td class="performance-cell">
                    {{ data.performance_counts.BE2 or 0 }}
                  </td>
                  <td class="actions">
                    <button
                      class="btn-sm btn-info"
                      onclick="viewDetailedAnalysis('{{ data.grade }}', '{{ data.stream }}')"
                      aria-label="View details for {{ data.grade }} {{ data.stream }}"
                    >
                      <!-- Heroicon: eye (solid) -->
                      <svg
                        class="heroicon"
                        fill="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path d="M12 15a3 3 0 100-6 3 3 0 000 6z" />
                        <path
                          fill-rule="evenodd"
                          d="M1.323 11.447C2.811 6.976 7.028 3.75 12.001 3.75c4.97 0 9.185 3.223 10.675 7.69.12.362.12.752 0 1.113-1.487 4.471-5.705 7.697-10.677 7.697-4.97 0-9.186-3.223-10.675-7.69a1.762 1.762 0 010-1.113zM17.25 12a5.25 5.25 0 11-10.5 0 5.25 5.25 0 0110.5 0z"
                          clip-rule="evenodd"
                        />
                      </svg>
                      View Details
                    </button>
                    <button
                      class="btn-sm btn-warning"
                      onclick="generateClassReport('{{ data.grade }}', '{{ data.stream }}')"
                      aria-label="Generate report for {{ data.grade }} {{ data.stream }}"
                    >
                      <!-- Heroicon: document-text (solid) -->
                      <svg
                        class="heroicon"
                        fill="currentColor"
                        viewBox="0 0 24 24"
                      >
                        <path
                          fill-rule="evenodd"
                          d="M5.625 1.5c-1.036 0-1.875.84-1.875 1.875v17.25c0 1.035.84 1.875 1.875 1.875h12.75c1.035 0 1.875-.84 1.875-1.875V12.75A3.75 3.75 0 0016.5 9h-1.875a1.875 1.875 0 01-1.875-1.875V5.25A3.75 3.75 0 009 1.5H5.625zM7.5 15a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5A.75.75 0 017.5 15zm.75 2.25a.75.75 0 000 1.5H12a.75.75 0 000-1.5H8.25z"
                          clip-rule="evenodd"
                        />
                        <path
                          d="M12.971 1.816A5.23 5.23 0 0114.25 5.25v1.875c0 .207.168.375.375.375H16.5a5.23 5.23 0 013.434 1.279 9.768 9.768 0 00-6.963-6.963z"
                        />
                      </svg>
                      Report
                    </button>
                  </td>
                </tr>
                {% endfor %}

                <!-- No data message if no performance data available -->
                {% if not performance_data %}
                <tr>
                  <td colspan="14" class="text-center" style="padding: 2rem">
                    <div class="no-data-container">
                      <!-- Heroicon: chart-bar (solid) -->
                      <svg
                        class="heroicon heroicon-xl"
                        fill="currentColor"
                        viewBox="0 0 24 24"
                        style="
                          font-size: 3rem;
                          color: #586e75;
                          margin-bottom: 1rem;
                        "
                      >
                        <path
                          d="M18.375 2.25c-1.035 0-1.875.84-1.875 1.875v15.75c0 1.035.84 1.875 1.875 1.875h.75c1.035 0 1.875-.84 1.875-1.875V4.125c0-1.036-.84-1.875-1.875-1.875h-.75zM9.75 8.625c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v11.25c0 1.035-.84 1.875-1.875 1.875h-.75a1.875 1.875 0 01-1.875-1.875V8.625zM3 13.125c0-1.036.84-1.875 1.875-1.875h.75c1.036 0 1.875.84 1.875 1.875v6.75c0 1.035-.84 1.875-1.875 1.875h-.75A1.875 1.875 0 013 19.875v-6.75z"
                        />
                      </svg>
                      <h3 style="color: #586e75; margin-bottom: 0.5rem">
                        No Performance Data Available
                      </h3>
                      <p style="color: #93a1a1">
                        No assessment data has been recorded yet. Performance
                        data will appear here once assessments are completed and
                        marks are entered.
                      </p>
                      <div style="margin-top: 1.5rem">
                        <a
                          href="{{ url_for('admin.manage_subjects') }}"
                          class="btn btn-outline"
                          style="margin-right: 1rem"
                        >
                          <!-- Heroicon: plus (solid) -->
                          <svg
                            class="heroicon"
                            fill="currentColor"
                            viewBox="0 0 24 24"
                          >
                            <path
                              fill-rule="evenodd"
                              d="M12 3.75a.75.75 0 01.75.75v6.75h6.75a.75.75 0 010 1.5h-6.75v6.75a.75.75 0 01-1.5 0v-6.75H4.5a.75.75 0 010-1.5h6.75V4.5a.75.75 0 01.75-.75z"
                              clip-rule="evenodd"
                            />
                          </svg>
                          Add Assessments
                        </a>
                        <a
                          href="{{ url_for('universal.proxy_manage_students') }}"
                          class="btn btn-outline"
                        >
                          <!-- Heroicon: users (solid) -->
                          <svg
                            class="heroicon"
                            fill="currentColor"
                            viewBox="0 0 24 24"
                          >
                            <path
                              fill-rule="evenodd"
                              d="M8.25 6.75a3.75 3.75 0 117.5 0 3.75 3.75 0 01-7.5 0zM15.75 9.75a3 3 0 116 0 3 3 0 01-6 0zM2.25 9.75a3 3 0 116 0 3 3 0 01-6 0zM6.31 15.117A6.745 6.745 0 0112 12a6.745 6.745 0 016.709 7.498.75.75 0 01-.372.568A12.696 12.696 0 0112 21.75c-2.305 0-4.47-.612-6.337-1.684a.75.75 0 01-.372-.568 6.787 6.787 0 011.019-1.381z"
                              clip-rule="evenodd"
                            />
                          </svg>
                          Manage Students
                        </a>
                      </div>
                    </div>
                  </td>
                </tr>
                {% endif %}
              </tbody>
            </table>
          </div>

          <!-- Pagination -->
          <div id="pagination-container" class="pagination-container">
            <div class="pagination-info">
              <span id="pagination-info"></span>
            </div>
            <div class="pagination-controls">
              <button
                class="btn-outline"
                onclick="previousPage()"
                id="prev-btn"
              >
                <!-- Heroicon: chevron-left (solid) -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    fill-rule="evenodd"
                    d="M7.72 12.53a.75.75 0 010-1.06l7.5-7.5a.75.75 0 111.06 1.06L9.31 12l6.97 6.97a.75.75 0 11-1.06 1.06l-7.5-7.5z"
                    clip-rule="evenodd"
                  />
                </svg>
                Previous
              </button>
              <div id="page-numbers" class="page-numbers"></div>
              <div id="page-info" class="page-info"></div>
              <button class="btn-outline" onclick="nextPage()" id="next-btn">
                Next
                <!-- Heroicon: chevron-right (solid) -->
                <svg class="heroicon" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    fill-rule="evenodd"
                    d="M16.28 11.47a.75.75 0 010 1.06l-7.5 7.5a.75.75 0 01-1.06-1.06L14.69 12 7.72 5.03a.75.75 0 011.06-1.06l7.5 7.5z"
                    clip-rule="evenodd"
                  />
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Template Data Bridge for External JS -->
    <script>
          // Global data injection for external JS modules with real backend data
          window.performanceData = {{ performance_data | tojson }};
          window.dashboardConfig = {
              schoolName: '{{ school_info.school_name or "Hillview School" }}',
              totalStudents: {{ total_students | default(0) }},
              totalTeachers: {{ total_teachers | default(0) }},
              totalClasses: {{ total_classes | default(0) }},
              totalSubjects: {{ total_subjects | default(0) }},
              totalAssessments: {{ total_assessments | default(0) }},
              schoolAverage: {{ dashboard_stats.avg_performance | default(0) }},
              topClass: '{{ top_class | default("N/A") }}',
              topClassScore: {{ top_class_score | default(0) }},
              currentTerm: '{{ current_term | default("Term 1") }}',
              currentAcademicYear: '{{ current_academic_year | default("2025/2026") }}',
              learnersByGrade: {{ dashboard_stats.learners_per_grade | tojson }},
              genderByGrade: {{ dashboard_stats.gender_per_grade | tojson }},
              streamsByGrade: {{ dashboard_stats.streams_per_grade | tojson }}
          };

          // Solar Theme Chart Configuration
          Chart.defaults.color = '#586e75';
          Chart.defaults.backgroundColor = 'rgba(181, 137, 0, 0.1)';
          Chart.defaults.borderColor = '#b58900';
          Chart.defaults.font.family = 'Source Sans Pro';

          // Professional Solar Dashboard Functions
          function toggleFilterPanel() {
            const panel = document.getElementById('filterPanel');
            if (panel.style.display === 'none' || !panel.style.display) {
              panel.style.display = 'block';
              panel.style.animation = 'fadeInUp 0.3s ease-out';
            } else {
              panel.style.display = 'none';
            }
          }

          function refreshDashboard() {
            // Show loading state
            const refreshBtn = event.target.closest('button');
            const originalHTML = refreshBtn.innerHTML;
            refreshBtn.innerHTML = '⟳ Refreshing...';
            refreshBtn.disabled = true;

            // Simulate refresh
            setTimeout(() => {
              location.reload();
            }, 1000);
          }

          function generateComprehensiveReport() {
            const reportBtn = event.target.closest('button');
            const originalHTML = reportBtn.innerHTML;
            reportBtn.innerHTML = '⟳ Generating...';
            reportBtn.disabled = true;

            // Simulate report generation
            setTimeout(() => {
              alert('Comprehensive report generated successfully!');
              reportBtn.innerHTML = originalHTML;
              reportBtn.disabled = false;
            }, 2000);
          }

          function resetFilters() {
            document.getElementById('gradeFilter').value = '';
            document.getElementById('termFilter').value = '';
            document.getElementById('performanceFilter').value = '';
            document.getElementById('dateFrom').value = '';
            document.getElementById('dateTo').value = '';
            filterPerformanceData();
          }

          function applyFilters() {
            filterPerformanceData();
            toggleFilterPanel();
          }

          function filterPerformanceData() {
            const gradeFilter = document.getElementById('grade-filter')?.value || document.getElementById('gradeFilter')?.value || '';
            const termFilter = document.getElementById('term-filter')?.value || document.getElementById('termFilter')?.value || '';
            const assessmentFilter = document.getElementById('assessment-filter')?.value || '';

            const rows = document.querySelectorAll('.performance-row');
            let visibleCount = 0;

            rows.forEach(row => {
              const grade = row.dataset.grade;
              const term = row.dataset.term;
              const assessment = row.dataset.assessment;

              const gradeMatch = !gradeFilter || grade.includes(gradeFilter);
              const termMatch = !termFilter || term === termFilter;
              const assessmentMatch = !assessmentFilter || assessment === assessmentFilter;

              const match = gradeMatch && termMatch && assessmentMatch;
              row.dataset.filtered = match ? '1' : '0';
              if (match) visibleCount++;
              // Default hide; pagination will reveal current page
              row.style.display = 'none';
            });

            // Update pagination info
            const paginationInfo = document.getElementById('pagination-info');
            if (paginationInfo) {
              paginationInfo.textContent = `Showing ${visibleCount} results`;
            }

            // Re-apply pagination to filtered results
            if (typeof applyPagination === 'function') {
              applyPagination(true);
            }
          }

          function toggleFilters() {
            const filtersPanel = document.getElementById('performance-filters');
            if (filtersPanel.style.display === 'none' || !filtersPanel.style.display) {
              filtersPanel.style.display = 'block';
              filtersPanel.style.animation = 'fadeInUp 0.3s ease-out';
            } else {
              filtersPanel.style.display = 'none';
            }
          }

          function exportPerformanceData() {
            const table = document.querySelector('.performance-table');
            if (!table) return;

            const headers = Array.from(table.querySelectorAll('thead th')).map(th => th.textContent.trim());
            const bodyRows = Array.from(table.querySelectorAll('tbody tr'));
            const visibleRows = bodyRows.filter(tr => tr.style.display !== 'none' && !tr.querySelector('.no-data-container'));
            if (!visibleRows.length) {
              showNotification('No rows to export', 'info');
              return;
            }

            const rows = [headers.join(',')];
            visibleRows.forEach(tr => {
              const cells = Array.from(tr.querySelectorAll('td'))
                .slice(0, headers.length - 1) // exclude Actions
                .map(td => '"' + td.textContent.replace(/\s+/g, ' ').trim().replace(/"/g, '""') + '"');
              rows.push(cells.join(','));
            });

            const blob = new Blob([rows.join('\n')], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `performance_data_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showNotification('Performance data exported', 'success');
          }

          function viewClassDetails(grade, stream) {
            alert(`Viewing details for ${grade} ${stream}`);
          }

          function showAlertDetails(title) {
            alert(`Alert Details: ${title}`);
          }

          function dismissAlert(button) {
            const alert = button.closest('.system-alert');
            alert.style.animation = 'fadeOut 0.3s ease-out';
            setTimeout(() => {
              alert.remove();
            }, 300);
          }

          function openAnalyticsDashboard() {
            window.open('{{ url_for("admin.analytics_dashboard") }}', '_blank');
          }

          function updateHeatmap() {
            const container = document.getElementById('heatmapContainer');
            if (!container) return;
            const metric = document.getElementById('heatmapMetric')?.value || 'average';
            const data = Array.isArray(window.performanceData) ? window.performanceData : [];

            const byClass = {};
            for (const row of data) {
              const key = `${row.grade} ${row.stream}`;
              const total = Number(row.total_students) || 0;
              const avg = Number(row.class_average) || 0;
              const counts = row.performance_counts || {};
              const ee = (Number(counts.EE1) || 0) + (Number(counts.EE2) || 0);
              const me = (Number(counts.ME1) || 0) + (Number(counts.ME2) || 0);
              if (!byClass[key]) byClass[key] = { total: 0, weighted: 0, ee: 0, me: 0 };
              byClass[key].total += total;
              byClass[key].weighted += avg * total;
              byClass[key].ee += ee;
              byClass[key].me += me;
            }

            const items = Object.entries(byClass).map(([cls, v]) => {
              const average = v.total ? v.weighted / v.total : 0;
              const excellence = v.total ? (v.ee / v.total) * 100 : 0;
              const mastery = v.total ? (v.me / v.total) * 100 : 0;
              let value = average; let sub = 'Class Average';
              if (metric === 'excellence') { value = excellence; sub = 'Excellence Rate'; }
              if (metric === 'mastery') { value = mastery; sub = 'Mastery Rate'; }
              return { cls, value, sub, average, excellence, mastery, total: v.total };
            });

            container.innerHTML = '';
            if (!items.length) {
              container.innerHTML = '<div class="heatmap-empty">No data available for heatmap yet.</div>';
              return;
            }

            const toColor = (val) => {
              const v = Math.max(0, Math.min(100, val));
              if (v < 60) {
                const t = v / 60; // 0..1
                const r = 220;
                const g = Math.round(50 + t * (137 - 50));
                const b = Math.round(47 + t * (0 - 47));
                return `rgba(${r}, ${g}, ${b}, 0.18)`; // reddish -> amber
              } else {
                const t = (v - 60) / 40; // 0..1
                const r = Math.round(181 - t * (48));
                const g = Math.round(137 + t * (16));
                const b = 0;
                return `rgba(${r}, ${g}, ${b}, 0.18)`; // amber -> green
              }
            };

            items.sort((a,b) => b.value - a.value);
            for (const e of items) {
              const div = document.createElement('div');
              div.className = 'heatmap-tile';
              div.style.background = toColor(e.value);
              div.innerHTML = `
                <div class="heatmap-title">${e.cls}</div>
                <div class="heatmap-value">${e.value.toFixed(1)}%</div>
                <div class="heatmap-sub">${e.sub} • ${e.total} students</div>
              `;
              div.title = `${e.cls} — Avg: ${e.average.toFixed(1)}%, Excellence: ${e.excellence.toFixed(1)}%, Mastery: ${e.mastery.toFixed(1)}%`;
              div.addEventListener('click', () => {
                populateDrillDown(
                  `<h4 style="margin:0 0 .25rem 0;">${e.cls}</h4>
                   <div style="color:#586e75; margin-bottom:.5rem;">${e.sub} • ${e.value.toFixed(1)}%</div>
                   <ul style="margin:0; padding-left:1rem; color:#073642;">
                     <li>Class Average: ${e.average.toFixed(1)}%</li>
                     <li>Excellence Rate: ${e.excellence.toFixed(1)}%</li>
                     <li>Mastery Rate: ${e.mastery.toFixed(1)}%</li>
                     <li>Students: ${e.total}</li>
                   </ul>`
                );
              });
              container.appendChild(div);
            }
          }

          function viewDetailedAnalysis(grade, stream) {
            const data = Array.isArray(window.performanceData) ? window.performanceData : [];
            const items = data.filter(r => `${r.grade}` === `${grade}` && `${r.stream}` === `${stream}`);
            if (!items.length) {
              populateDrillDown(`<div class="heatmap-empty">No detailed data for ${grade} ${stream}.</div>`);
              return;
            }
            let html = `<h4 style="margin:0 0 .5rem 0;">${grade} ${stream} — Detailed Analysis</h4>`;
            html += '<div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:.75rem;">';
            for (const r of items) {
              const c = r.performance_counts || {};
              html += `
                <div class="analytics-card">
                  <div style="font-weight:700;color:#073642;margin-bottom:.25rem;">Term ${r.term} • ${r.assessment_type}</div>
                  <div style="display:flex;gap:1rem;flex-wrap:wrap;color:#586e75;">
                    <div><strong>Students:</strong> ${r.total_students}</div>
                    <div><strong>Average:</strong> ${Number(r.class_average||0).toFixed(1)}%</div>
                  </div>
                  <div style="margin-top:.5rem;display:grid;grid-template-columns:repeat(4,1fr);gap:.35rem;font-size:.9rem;">
                    <div>EE1: ${c.EE1||0}</div>
                    <div>EE2: ${c.EE2||0}</div>
                    <div>ME1: ${c.ME1||0}</div>
                    <div>ME2: ${c.ME2||0}</div>
                    <div>AE1: ${c.AE1||0}</div>
                    <div>AE2: ${c.AE2||0}</div>
                    <div>BE1: ${c.BE1||0}</div>
                    <div>BE2: ${c.BE2||0}</div>
                  </div>
                </div>`;
            }
            html += '</div>';
            populateDrillDown(html);
          }

          function populateDrillDown(html) {
            const el = document.getElementById('drillDownContainer');
            if (!el) return;
            el.innerHTML = html;
            el.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }

          function generatePerformanceAlerts() {
            const alertsContainer = document.getElementById('performanceAlerts');
            alertsContainer.innerHTML = '<div class="loading">Generating alerts...</div>';

            setTimeout(() => {
              alertsContainer.innerHTML = `
                <div class="performance-alert alert-warning">
                  ⚠️ Grade 8A showing declining trend in Mathematics
                </div>
                <div class="performance-alert alert-info">
                  ℹ️ Grade 10B exceeding expectations in Science
                </div>
              `;
            }, 1000);
          }

          async function exportChartsAsPDF() {
            const exportBtn = document.querySelector('[onclick="exportChartsAsPDF()"]');
            const originalText = exportBtn ? exportBtn.innerHTML : '';
            if (exportBtn) {
              exportBtn.innerHTML = '⟳ Exporting...';
              exportBtn.disabled = true;
            }

            try {
              const { jsPDF } = window.jspdf || {};
              if (!jsPDF) {
                alert('PDF library not loaded.');
                return;
              }

              const cfg = window.dashboardConfig || {};
              const totalStudents = typeof cfg.totalStudents === 'number' ? cfg.totalStudents : 0;
              const topClass = cfg.topClass || 'N/A';
              const schoolAverage = typeof cfg.schoolAverage === 'number' ? cfg.schoolAverage : 0;
              const reportsGenerated = 'N/A';

              const doc = new jsPDF({ orientation: 'portrait', unit: 'pt', format: 'a4' });
              const margin = 40;
              let y = margin;

              // Header
              doc.setFont('helvetica', 'bold');
              doc.setFontSize(18);
              doc.text(cfg.schoolName || 'School Dashboard Report', margin, y);
              y += 24;
              doc.setFont('helvetica', 'normal');
              doc.setFontSize(11);
              doc.text(`Date: ${new Date().toLocaleString()}`, margin, y);
              y += 20;
              doc.text(`Academic Year: ${cfg.currentAcademicYear || 'N/A'}`, margin, y);
              y += 16;
              doc.text(`Current Term: ${cfg.currentTerm || 'N/A'}`, margin, y);
              y += 24;

              // Key stats
              doc.setFont('helvetica', 'bold');
              doc.text('Key Statistics', margin, y);
              y += 16;
              doc.setFont('helvetica', 'normal');
              const stats = [
                [`Total Students`, String(totalStudents)],
                [`School Average`, `${schoolAverage.toFixed ? schoolAverage.toFixed(1) : schoolAverage}%`],
                [`Best Class`, topClass],
                [`Reports Generated`, reportsGenerated]
              ];
              stats.forEach(([k, v]) => {
                doc.text(`${k}: ${v}`, margin, y);
                y += 16;
              });

              // Try capture charts if present
              const donutEl = document.getElementById('performanceDonutChart');
              const barEl = document.getElementById('classComparisonChart');
              const addCanvas = async (canvasEl, title) => {
                if (!canvasEl) return;
                if (typeof html2canvas !== 'function') return;
                try {
                  const canvas = await html2canvas(canvasEl.parentElement, { backgroundColor: '#fff', scale: 2 });
                  const imgData = canvas.toDataURL('image/png');
                  const pageWidth = doc.internal.pageSize.getWidth() - margin * 2;
                  const imgWidth = pageWidth;
                  const ratio = canvas.height / canvas.width;
                  const imgHeight = imgWidth * ratio;
                  if (y + 24 + imgHeight + margin > doc.internal.pageSize.getHeight()) {
                    doc.addPage();
                    y = margin;
                  }
                  doc.setFont('helvetica', 'bold');
                  doc.text(title, margin, y);
                  y += 8;
                  doc.addImage(imgData, 'PNG', margin, y, imgWidth, imgHeight);
                  y += imgHeight + 16;
                } catch (e) {
                  console.warn('Chart capture failed:', e);
                }
              };

              await addCanvas(donutEl, 'Performance Distribution');
              await addCanvas(barEl, 'Class Comparison');

              doc.save(`dashboard_report_${new Date().toISOString().split('T')[0]}.pdf`);
            } finally {
              if (exportBtn) {
                exportBtn.innerHTML = originalText;
                exportBtn.disabled = false;
              }
            }
          }

          // Premium Stats Functions
          function refreshStats() {
            // Show loading state for all stat numbers
            const statNumbers = document.querySelectorAll('.stat-number');
            const originalValues = [];

            statNumbers.forEach((element, index) => {
              originalValues[index] = element.textContent;
              element.innerHTML = '⟳';
            });

            // Simulate refresh with loading effect
            setTimeout(() => {
              statNumbers.forEach((element, index) => {
                element.textContent = originalValues[index];
                element.style.animation = 'pulse 0.5s ease-out';
              });

              // Show success message
              showNotification('Statistics refreshed successfully!', 'success');
            }, 1500);
          }

          function exportStats() {
            // Create CSV content with actual data
            const cfg = window.dashboardConfig || {};
            const csvContent = "data:text/csv;charset=utf-8," + [
              "Metric,Value",
              `Total Students,${typeof cfg.totalStudents === 'number' ? cfg.totalStudents : 0}`,
              `School Average,${(typeof cfg.schoolAverage === 'number' ? cfg.schoolAverage : 0).toFixed(1)}%`,
              `Assessment Types,${typeof cfg.totalAssessments === 'number' ? cfg.totalAssessments : 0}`,
              `Active Teachers,${typeof cfg.totalTeachers === 'number' ? cfg.totalTeachers : 0}`,
              `Active Subjects,${typeof cfg.totalSubjects === 'number' ? cfg.totalSubjects : 0}`,
              `Active Classes,${typeof cfg.totalClasses === 'number' ? cfg.totalClasses : 0}`,
              `Current Term,${cfg.currentTerm || 'N/A'}`,
              `Academic Year,${cfg.currentAcademicYear || 'N/A'}`
            ].join("\n");

            const link = document.createElement("a");
            link.setAttribute("href", encodeURI(csvContent));
            link.setAttribute("download", "school_statistics_" + new Date().toISOString().split('T')[0] + ".csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

      showNotification('Statistics exported successfully!', 'success');
          }

          function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
              ${type === 'success' ? '✅' : 'ℹ️'}
              <span>${message}</span>
            `;

            notification.style.cssText = `
              position: fixed;
              top: 20px;
              right: 20px;
              background: ${type === 'success' ? '#859900' : '#268bd2'};
              color: white;
              padding: 1rem 1.5rem;
              border-radius: 12px;
              box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
              z-index: 9999;
              display: flex;
              align-items: center;
              gap: 0.5rem;
              font-weight: 600;
              animation: slideInRight 0.3s ease-out;
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
              notification.style.animation = 'slideOutRight 0.3s ease-in';
              setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
          }

          // Add CSS for notifications
          const notificationStyles = document.createElement('style');
          notificationStyles.textContent = `
            @keyframes slideInRight {
              from { transform: translateX(100%); opacity: 0; }
              to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
              from { transform: translateX(0); opacity: 1; }
              to { transform: translateX(100%); opacity: 0; }
            }
            @keyframes pulse {
              0% { transform: scale(1); }
              50% { transform: scale(1.05); }
              100% { transform: scale(1); }
            }
          `;
          document.head.appendChild(notificationStyles);

          // Initialize Solar Theme Charts and other functionality
          document.addEventListener('DOMContentLoaded', function() {
            initializeSolarCharts();
            initializePerformanceTable();
            updateHeatmap();
            initMobileDrawer();
          });

          function initializeSolarCharts() {
            // Performance Donut Chart - Use real data or show no data state
            const donutCtx = document.getElementById('performanceDonutChart');
            if (donutCtx) {
              {% if dashboard_stats.performance_distribution %}
              const performanceData = {{ dashboard_stats.performance_distribution | tojson }};
              const chartData = [
                performanceData['EE'] || 0,
                performanceData['ME'] || 0,
                performanceData['AE'] || 0,
                performanceData['BE'] || 0
              ];
              const hasData = chartData.some(value => value > 0);
              {% else %}
              const hasData = false;
              const chartData = [0, 0, 0, 0];
              {% endif %}

              if (hasData) {
                const donutChart = new Chart(donutCtx, {
                  type: 'doughnut',
                  data: {
                    labels: ['Exceeds Expectations', 'Meets Expectations', 'Approaches Expectations', 'Below Expectations'],
                    datasets: [{
                      data: chartData,
                      backgroundColor: [
                        '#859900', // Solar green
                        '#268bd2', // Solar blue
                        '#b58900', // Solar yellow
                        '#dc322f'  // Solar red
                      ],
                      borderColor: '#fdf6e3',
                      borderWidth: 3
                    }]
                  },
                  options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                      legend: {
                        position: 'bottom',
                        labels: {
                          padding: 20,
                          usePointStyle: true,
                          font: {
                            family: 'Source Sans Pro',
                            size: 12
                          }
                        }
                      }
                    }
                  },
                  onClick: (evt, elements) => {
                    const idx = elements && elements[0] ? elements[0].index : undefined;
                    if (typeof idx !== 'number') return;
                    const label = ['Exceeds', 'Meets', 'Approaches', 'Below'][idx] || 'Performance';
                    const value = chartData[idx] || 0;
                    populateDrillDown(`<h4 style=\"margin:0 0 .25rem 0;\">${label} Expectations</h4><div style=\"color:#586e75;\">Count: ${value}</div>`);
                  }
                });
                window.donutChart = donutChart;
              } else {
                // Show no data message
                donutCtx.style.display = 'none';
                const container = donutCtx.parentElement;
                container.innerHTML = `
                  <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 300px; color: #586e75;">
                    📊
                    <h4 style="margin-bottom: 0.5rem;">No Performance Data</h4>
                    <p style="text-align: center; opacity: 0.7;">Performance distribution will appear here once assessment data is available.</p>
                  </div>
                `;
              }
            }

            // Class Comparison Chart - Use real performance data
            const comparisonCtx = document.getElementById('classComparisonChart');
            if (comparisonCtx) {
              {% if performance_data and performance_data|length > 0 %}
              const performanceData = {{ performance_data | tojson }};
              const classLabels = [];
              const classAverages = [];

              // Extract class names and averages from real data
              performanceData.forEach(item => {
                const className = `${item.grade} ${item.stream}`;
                if (!classLabels.includes(className)) {
                  classLabels.push(className);
                  classAverages.push(parseFloat(item.class_average) || 0);
                }
              });

              const hasClassData = classLabels.length > 0;
              {% else %}
              const hasClassData = false;
              const classLabels = [];
              const classAverages = [];
              {% endif %}

              if (hasClassData) {
                const comparisonChart = new Chart(comparisonCtx, {
                  type: 'bar',
                  data: {
                    labels: classLabels,
                    datasets: [{
                      label: 'Class Average',
                      data: classAverages,
                      backgroundColor: 'rgba(181, 137, 0, 0.8)',
                      borderColor: '#b58900',
                      borderWidth: 2,
                      borderRadius: 6,
                      borderSkipped: false,
                    }]
                  },
                  options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                      legend: {
                        display: false
                      }
                    },
                    scales: {
                      y: {
                        beginAtZero: true,
                        max: 100,
                        grid: {
                          color: 'rgba(88, 110, 117, 0.1)'
                        },
                        ticks: {
                          font: {
                            family: 'Source Sans Pro'
                          }
                        }
                      },
                      x: {
                        grid: {
                          display: false
                        },
                        ticks: {
                          font: {
                            family: 'Source Sans Pro'
                          }
                        }
                      }
                    }
                  },
                  onClick: (evt, elements) => {
                    const idx = elements && elements[0] ? elements[0].index : undefined;
                    if (typeof idx !== 'number') return;
                    const cls = classLabels[idx];
                    const avg = classAverages[idx];
                    populateDrillDown(`<h4 style=\"margin:0 0 .25rem 0;\">${cls}</h4><div style=\"color:#586e75;\">Class Average: ${Number(avg||0).toFixed(1)}%</div>`);
                  }
                });
                window.comparisonChart = comparisonChart;
              } else {
                // Show no data message
                comparisonCtx.style.display = 'none';
                const container = comparisonCtx.parentElement;
                container.innerHTML = `
                  <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 300px; color: #586e75;">
                    📊
                    <h4 style="margin-bottom: 0.5rem;">No Class Data</h4>
                    <p style="text-align: center; opacity: 0.7;">Class comparison chart will appear here once assessment data is available.</p>
                  </div>
                `;
              }
            }
          }

          // Pagination state and helpers (mobile-aware)
          const tablePagination = { currentPage: 1, pageSize: 10 };

          function computePageSize() {
            const w = window.innerWidth || 1024;
            if (w <= 520) return 5;
            if (w <= 768) return 8;
            return 10;
          }

          function getFilteredRows() {
            return Array.from(document.querySelectorAll('.performance-row')).filter(r => r.dataset.filtered === '1' || (!('filtered' in r.dataset)));
          }

          function renderPagination() {
            const rows = getFilteredRows();
            const total = rows.length;
            const totalPages = Math.max(1, Math.ceil(total / tablePagination.pageSize));
            const pageNumbers = document.getElementById('page-numbers');
            const paginationInfo = document.getElementById('pagination-info');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            if (paginationInfo) paginationInfo.textContent = `Showing ${total} results`;
            if (pageNumbers) {
              pageNumbers.innerHTML = '';
              for (let i = 1; i <= totalPages; i++) {
                const btn = document.createElement('button');
                btn.className = 'btn-outline' + (i === tablePagination.currentPage ? ' active' : '');
                btn.textContent = String(i);
                btn.addEventListener('click', () => goToPage(i));
                pageNumbers.appendChild(btn);
              }
            }
            if (prevBtn) prevBtn.disabled = tablePagination.currentPage <= 1 || totalPages <= 1;
            if (nextBtn) nextBtn.disabled = tablePagination.currentPage >= totalPages || totalPages <= 1;
          }

          function showPage(page) {
            const rows = getFilteredRows();
            const totalPages = Math.max(1, Math.ceil(rows.length / tablePagination.pageSize));
            const p = Math.min(Math.max(1, page), totalPages);
            tablePagination.currentPage = p;

            // hide all filtered rows first
            rows.forEach(r => { r.style.display = 'none'; });

            const start = (p - 1) * tablePagination.pageSize;
            const end = start + tablePagination.pageSize;
            rows.slice(start, end).forEach(r => { r.style.display = ''; });

            renderPagination();
          }

          function previousPage() { showPage(tablePagination.currentPage - 1); }
          function nextPage() { showPage(tablePagination.currentPage + 1); }
          function goToPage(n) { showPage(n); }

          function initPagination() {
            tablePagination.pageSize = computePageSize();
            tablePagination.currentPage = 1;
            renderPagination();
            showPage(1);
          }

          function applyPagination(reset = false) {
            if (reset) tablePagination.currentPage = 1;
            renderPagination();
            showPage(tablePagination.currentPage);
          }

          function initializePerformanceTable() {
            const table = document.querySelector('.performance-table');
            if (!table) return;
            // Ensure default filtered state on initial load
            document.querySelectorAll('.performance-row').forEach(r => {
              if (!('filtered' in r.dataset)) r.dataset.filtered = '1';
            });
            initPagination();
            // Recompute page size on resize
            let resizeTimer;
            window.addEventListener('resize', () => {
              clearTimeout(resizeTimer);
              resizeTimer = setTimeout(() => {
                const newSize = computePageSize();
                if (newSize !== tablePagination.pageSize) {
                  tablePagination.pageSize = newSize;
                  applyPagination(true);
                }
              }, 150);
            });
          }

          // ===== Mobile Drawer (Headteacher) =====
          function initMobileDrawer() {
            const btn = document.getElementById('hamburgerBtn');
            const drawer = document.getElementById('mobileDrawer');
            const backdrop = document.getElementById('mobileDrawerBackdrop');
            const closeBtn = document.getElementById('drawerCloseBtn');
            const list = document.getElementById('drawerNavList');
            if (!btn || !drawer || !backdrop || !closeBtn || !list) return;

            // Clone navbar items into drawer list
            try {
              const navItems = document.querySelectorAll('.navbar-nav > li > a.nav-link');
              list.innerHTML = '';
              navItems.forEach(a => {
                const li = document.createElement('li');
                const clone = a.cloneNode(true);
                // larger touch targets in drawer
                clone.style.padding = '0.55rem 0.6rem';
                clone.style.border = '1px solid rgba(181,137,0,0.25)';
                clone.style.borderRadius = '8px';
                clone.style.background = 'rgba(0,0,0,0.1)';
                li.appendChild(clone);
                list.appendChild(li);
              });
            } catch (e) {
              console.warn('Drawer link clone failed', e);
            }

            const openDrawer = () => {
              document.body.classList.add('drawer-open');
              btn.setAttribute('aria-expanded', 'true');
            };
            const closeDrawer = () => {
              document.body.classList.remove('drawer-open');
              btn.setAttribute('aria-expanded', 'false');
            };

            btn.addEventListener('click', openDrawer);
            closeBtn.addEventListener('click', closeDrawer);
            backdrop.addEventListener('click', closeDrawer);

            // Trap Esc
            document.addEventListener('keydown', (e) => {
              if (e.key === 'Escape' && document.body.classList.contains('drawer-open')) closeDrawer();
            });

            // Auto-open on mobile immediately on page load
            try {
              const isMobile = (window.innerWidth || 1024) <= 768;
              if (isMobile) {
                setTimeout(() => openDrawer(), 150);
              }
            } catch {}
          }

          // Add fade out animation for alerts
          const style = document.createElement('style');
          style.textContent = `
            @keyframes fadeOut {
              from { opacity: 1; transform: translateX(0); }
              to { opacity: 0; transform: translateX(100%); }
            }
            .performance-alert {
              display: flex;
              align-items: center;
              gap: 0.75rem;
              padding: 1rem;
              margin-bottom: 0.5rem;
              border-radius: 8px;
            }
            .performance-alert.alert-warning {
            }
            .performance-alert.alert-info {
            }
            .loading {
              text-align: center;
              padding: 2rem;
            }
          `;
          document.head.appendChild(style);
    </script>
  </body>
</html>
