<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Report - {{ school_info.school_name or 'Hillview School' }}</title>
    <!-- Inter font for Solar theme -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <style>
      /* Solar Theme Tokens + heroicon base */
      :root {
        --solar-bg-1: #fdf6e3;
        --solar-bg-2: #eee8d5;
        --solar-bg-3: #d6d2c4;
        --solar-primary: #b58900;
        --solar-secondary: #268bd2;
        --solar-green: #859900;
        --solar-red: #dc322f;
        --solar-text-primary: #002b36;
        --solar-text-secondary: #073642;
        --border-color: rgba(238, 232, 213, 0.55);
        --shadow-md: 0 14px 34px rgba(0, 43, 54, 0.12);
        --radius: 16px;
      }
      body {
        background: linear-gradient(
          135deg,
          var(--solar-bg-1) 0%,
          var(--solar-bg-2) 60%,
          var(--solar-bg-3) 100%
        );
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        color: var(--solar-text-primary);
      }
      .heroicon {
        display: inline-block;
        width: 1.1rem;
        height: 1.1rem;
        fill: currentColor;
        vertical-align: middle;
      }
      .heroicon-lg {
        width: 1.6rem;
        height: 1.6rem;
      }
      .heroicon-solar-yellow {
        color: var(--solar-primary);
      }
      .heroicon-solar-blue {
        color: var(--solar-secondary);
      }
      .heroicon-solar-green {
        color: var(--solar-green);
      }

      .report-container {
        max-width: 1200px;
        margin: 40px auto 30px;
        padding: 0 16px;
      }
      .report-header {
        background: linear-gradient(
          145deg,
          rgba(253, 246, 227, 0.95),
          rgba(238, 232, 213, 0.9)
        );
        border: 1px solid var(--border-color);
        border-radius: 24px;
        padding: 22px;
        box-shadow: var(--shadow-md);
        margin-bottom: 20px;
      }
      .report-title {
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--solar-text-primary);
        margin: 0 0 6px;
      }
      .report-subtitle {
        color: var(--solar-text-secondary);
        font-size: 14px;
      }

      .performance-summary {
        background: #fff;
        border-radius: 16px;
        border: 1px solid var(--border-color);
        box-shadow: var(--shadow-md);
        padding: 20px;
        margin-bottom: 26px;
      }
      .summary-title {
        color: var(--solar-text-primary);
        margin: 0 0 12px;
        font-size: 18px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      .summary-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 14px;
      }
      .summary-item {
        padding: 14px;
        border-radius: 12px;
        text-align: center;
        transition: transform 0.2s ease;
        border: 1px solid var(--border-color);
        background: #fff;
      }
      .summary-item:hover {
        transform: translateY(-2px);
      }
      .summary-count {
        font-size: 28px;
        font-weight: 800;
        display: block;
        margin-bottom: 4px;
      }
      .summary-label {
        font-size: 14px;
        color: var(--solar-text-secondary);
      }
      .exceeding {
        background: rgba(133, 153, 0, 0.08);
        border-color: rgba(133, 153, 0, 0.25);
      }
      .meeting {
        background: rgba(38, 139, 210, 0.08);
        border-color: rgba(38, 139, 210, 0.25);
      }
      .approaching {
        background: rgba(181, 137, 0, 0.1);
        border-color: rgba(181, 137, 0, 0.3);
      }
      .below {
        background: rgba(220, 50, 47, 0.08);
        border-color: rgba(220, 50, 47, 0.25);
      }

      .report-table {
        width: 100%;
        border-collapse: collapse;
        margin: 18px 0;
        box-shadow: var(--shadow-md);
        background: #fff;
        border: 1px solid var(--border-color);
        border-radius: 14px;
        overflow: hidden;
      }
      .report-table th,
      .report-table td {
        padding: 12px 14px;
        border-bottom: 1px solid var(--border-color);
        text-align: left;
      }
      .report-table th {
        background: var(--solar-primary);
        color: #fff;
        position: sticky;
        top: 0;
        z-index: 1;
      }
      .report-table tr:nth-child(even) {
        background: rgba(181, 137, 0, 0.05);
      }
      .report-table tbody tr:hover {
        background: rgba(38, 139, 210, 0.08);
      }

      .performance-cell {
        font-weight: 600;
        border-radius: 10px;
        padding: 4px 8px;
        text-align: center;
        display: inline-block;
      }
      .performance-exceeding {
        background-color: rgba(133, 153, 0, 0.2);
        color: var(--solar-green);
      }
      .performance-meeting {
        background-color: rgba(38, 139, 210, 0.2);
        color: var(--solar-secondary);
      }
      .performance-approaching {
        background-color: rgba(181, 137, 0, 0.2);
        color: var(--solar-primary);
      }
      .performance-below {
        background-color: rgba(220, 50, 47, 0.2);
        color: var(--solar-red);
      }

      .download-btn {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        background: var(--solar-secondary);
        color: #fff;
        padding: 10px 16px;
        border-radius: 10px;
        text-decoration: none;
        transition: 0.2s ease;
      }
      .download-btn:hover {
        filter: brightness(0.95);
      }

      footer {
        text-align: center;
        margin: 28px 0;
        color: var(--solar-text-secondary);
      }
    </style>
  </head>
  <body>
    <div class="report-container">
      <div class="report-header">
        <h1 class="report-title">
          <svg
            class="heroicon heroicon-lg heroicon-solar-yellow"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path
              d="M11.7 2.37a.75.75 0 01.6 0l8.25 3.75a.75.75 0 010 1.36L12.3 11.23a.75.75 0 01-.6 0L3.45 7.48a.75.75 0 010-1.36L11.7 2.37z"
            />
          </svg>
          {{ subject }} - Grade {{ grade }} Stream {{ stream[-1] }}
        </h1>
        <div class="report-subtitle">
          {{ education_level }} | {{ term|replace('_', ' ')|title }} | {{
          assessment_type|title }}
        </div>
      </div>

      <div class="performance-summary">
        <h3 class="summary-title">
          <svg
            class="heroicon heroicon-solar-blue"
            viewBox="0 0 24 24"
            fill="currentColor"
          >
            <path
              fill-rule="evenodd"
              d="M3 4.5A1.5 1.5 0 014.5 3h15A1.5 1.5 0 0121 4.5V15a1.5 1.5 0 01-1.5 1.5H12l-3.72 3.72A.75.75 0 017 19.5V16.5H4.5A1.5 1.5 0 013 15V4.5z"
              clip-rule="evenodd"
            />
          </svg>
          Performance Summary
        </h3>
        <div class="summary-grid">
          <div class="summary-item exceeding">
            <span class="summary-count"
              >{{ performance_summary.get('Exceeding Expectation', 0) }}</span
            >
            <span class="summary-label">Exceeding Expectation</span>
          </div>
          <div class="summary-item meeting">
            <span class="summary-count"
              >{{ performance_summary.get('Meeting Expectation', 0) }}</span
            >
            <span class="summary-label">Meeting Expectation</span>
          </div>
          <div class="summary-item approaching">
            <span class="summary-count"
              >{{ performance_summary.get('Approaching Expectation', 0) }}</span
            >
            <span class="summary-label">Approaching Expectation</span>
          </div>
          <div class="summary-item below">
            <span class="summary-count"
              >{{ performance_summary.get('Below Expectation', 0) }}</span
            >
            <span class="summary-label">Below Expectation</span>
          </div>
        </div>
        <div class="mean-score">
          Class Average: {{ "%.2f"|format(mean_score) }} / {{ total_marks }} ({{
          "%.1f"|format(mean_percentage) }}%) -
          <span
            class="performance-{{ mean_performance|replace(' ', '-')|lower }}"
            >{{ mean_performance }}</span
          >
        </div>
      </div>

      <table class="report-table">
        <thead>
          <tr>
            <th>Student Name</th>
            <th>Marks (Out of {{ total_marks }})</th>
            <th>Percentage</th>
            <th>Performance Level</th>
          </tr>
        </thead>
        <tbody>
          {% for item in data %}
          <tr>
            <td>{{ item[0] }}</td>
            <td>{{ item[1] }}</td>
            <td>{{ item[2] }}%</td>
            <td>
              <span
                class="performance-cell performance-{{ item[3]|replace(' ', '-')|lower }}"
                >{{ item[3] }}</span
              >
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="text-center" style="text-align: center; margin-top: 18px">
        <a
          href="{{ url_for('generate_pdf', grade=grade, stream=stream, subject=subject) }}"
          class="download-btn"
        >
          <svg class="heroicon" viewBox="0 0 24 24" fill="currentColor">
            <path
              fill-rule="evenodd"
              d="M12 2.25a.75.75 0 01.75.75v9.19l2.47-2.47a.75.75 0 111.06 1.06l-3.75 3.75a.75.75 0 01-1.06 0l-3.75-3.75a.75.75 0 111.06-1.06l2.47 2.47V3a.75.75 0 01.75-.75z"
              clip-rule="evenodd"
            />
            <path
              d="M4.5 15.75A2.25 2.25 0 016.75 18h10.5a2.25 2.25 0 002.25-2.25V12a.75.75 0 00-1.5 0v3.75c0 .414-.336.75-.75.75H6.75a.75.75 0 01-.75-.75V12a.75.75 0 00-1.5 0v3.75z"
            />
          </svg>
          Download PDF Report
        </a>
      </div>
    </div>

    <footer>
      <p>
        © {{ (now().year if now else 2025) }} {{ school_info.school_name or
        'Hillview School' }} - All Rights Reserved
      </p>
    </footer>
  </body>
</html>
