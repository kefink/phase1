<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Manage Grades and Streams - Hillview School (Class Teacher)</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <!-- Inter font for Solar theme -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Remove conflicting manage_pages_enhanced.css -->
    <!-- (was) <link rel="stylesheet" href="{{ url_for('static', filename='css/manage_pages_enhanced.css') }}" /> -->
    <style>
      /* Solar Theme Tokens + mapping for legacy vars */
      :root {
        --solar-bg-1: #fdf6e3;
        --solar-bg-2: #eee8d5;
        --solar-bg-3: #d6d2c4;
        --solar-primary: #b58900;   /* yellow */
        --solar-secondary: #268bd2; /* blue */
        --solar-green: #859900;     /* green */
        --solar-red: #dc322f;       /* red */
        --solar-text-primary: #002b36;
        --solar-text-secondary: #073642;
        --primary-color: var(--solar-primary) !important;
        --secondary-color: var(--solar-secondary) !important;
        --white: #ffffff !important;
        --border-color: rgba(238, 232, 213, 0.6) !important;
        --shadow-md: 0 12px 30px rgba(0, 43, 54, 0.10) !important;
        --border-radius: 10px !important;
        --border-radius-lg: 16px !important;
        --spacing-sm: 8px !important;
        --spacing-md: 12px !important;
        --spacing-lg: 20px !important;
        --spacing-xl: 32px !important;
        --transition: all .25s ease !important;
      }
      body {
        background: linear-gradient(135deg, var(--solar-bg-1) 0%, var(--solar-bg-2) 60%, var(--solar-bg-3) 100%) !important;
        font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif !important;
        color: var(--solar-text-primary) !important;
      }
      /* Heroicon utilities */
      .heroicon { display:inline-block; width:1.05rem; height:1.05rem; fill:currentColor; vertical-align:middle; }
      .heroicon-lg { width:1.5rem; height:1.5rem; }
      .heroicon-solar-blue { color: var(--solar-secondary); }
      .heroicon-solar-green { color: var(--solar-green); }
      .heroicon-solar-yellow { color: var(--solar-primary); }
      .heroicon-solar-red { color: var(--solar-red); }

      /* Container + Header - Solar glass look */
      .manage-container {
        max-width: 95% !important;
        width: 95% !important;
        margin: 40px auto 60px !important;
        padding: 0 !important;
        background: transparent !important;
      }
      .page-header {
        background: linear-gradient(145deg, rgba(253, 246, 227, 0.95) 0%, rgba(238, 232, 213, 0.9) 100%) !important;
        backdrop-filter: blur(15px);
        padding: 24px !important;
        border-radius: 24px !important;
        box-shadow: 0 20px 40px rgba(0, 43, 54, 0.15) !important;
        border: 1px solid rgba(238, 232, 213, 0.6) !important;
        margin-bottom: 24px !important;
      }
      .page-header h1 { display:flex; align-items:center; gap:10px; color:var(--solar-text-primary) !important; margin:0 0 8px 0 !important; }
      .page-subtitle { margin:0 0 10px 0; color: var(--solar-text-secondary); }
      .nav-links { display:flex; gap:12px; flex-wrap:wrap; }
      .nav-links a { display:inline-flex; align-items:center; gap:8px; color:var(--solar-text-secondary) !important; background: rgba(253,246,227,0.55); padding:8px 14px; border-radius:999px; border:1px solid var(--border-color); text-decoration:none; }
      .nav-links a:hover { transform: translateY(-2px); box-shadow: 0 8px 18px rgba(0,0,0,0.08); }

      /* Cards / Sections */
      .forms-grid { display:grid; grid-template-columns: 1fr 1fr; gap: var(--spacing-xl); margin: var(--spacing-xl) 0; }
      .form-card, .grades-streams-section, .students-section .table-responsive { background:#fff; padding: var(--spacing-lg); border-radius: 16px; box-shadow: var(--shadow-md); border:1px solid var(--border-color); }
      .form-card h2, .grades-streams-section h2, .students-section h2 { display:flex; align-items:center; gap:8px; color: var(--solar-text-primary); margin:0 0 var(--spacing-lg) 0; }

      /* Forms */
      .form-group label { display:block; margin-bottom: var(--spacing-sm); color: var(--solar-text-primary); font-weight:600; }
      .form-control { width:100%; padding: var(--spacing-md); border:1px solid var(--border-color); border-radius: 10px; font-size:1rem; color: var(--solar-text-primary); background:#fff; }
      .form-control:focus { outline:none; border-color: var(--solar-secondary); box-shadow: 0 0 0 3px rgba(38, 139, 210, 0.18); }

      /* Buttons */
      .manage-btn, .edit-btn, .delete-btn, .btn { display:inline-flex; align-items:center; gap:8px; padding: 10px 14px; border-radius: 10px; text-decoration:none; border:none; cursor:pointer; transition: var(--transition); font-weight:700; }
      .manage-btn, .btn { background: var(--solar-secondary); color:#fff; }
      .manage-btn:hover, .btn:hover { filter: brightness(0.95); }
      .delete-btn { background:#fbe3e5; color: var(--solar-red); border:1px solid rgba(220,50,47,0.25); }
      .delete-btn:hover { background:#f8d2d6; }
      .delete-btn.sm { padding: 8px 12px; font-size: 0.85rem; border-radius: 8px; }

      /* Table */
      table { width:100%; min-width:800px; border-collapse: collapse; }
      th, td { padding: var(--spacing-md); text-align:left; border-bottom:1px solid var(--border-color); }
      th { background: var(--solar-primary); color:#fff; font-weight:700; position: sticky; top:0; z-index:1; }
      tr:nth-child(even) { background: rgba(181, 137, 0, 0.05); }
      tr:hover { background: rgba(38, 139, 210, 0.08); }

      .streams-cell { max-width: 350px; }
      .streams-list { display:flex; flex-direction:column; gap: 10px; }
      .stream-item { display:flex; align-items:center; justify-content:space-between; padding:10px; background: rgba(253,246,227,0.6); border-radius: 10px; border:1px solid var(--border-color); }
      .stream-name { font-weight:600; color: var(--solar-text-primary); }
      .stream-id { font-size:0.9rem; color: var(--solar-text-secondary); }

      /* Messages */
      .message { padding: var(--spacing-md); border-radius: 10px; margin-bottom: var(--spacing-lg); }
      .message-error { background: rgba(220, 50, 47, 0.1); border:1px solid var(--solar-red); color: var(--solar-red); }
      .message-success { background: rgba(38, 139, 210, 0.1); border:1px solid var(--solar-secondary); color: var(--solar-text-primary); }

      /* Remove emoji pseudo-element */
      #student-filter label::before { content: none !important; }

      /* Responsive */
      @media (max-width: 900px) { .forms-grid { grid-template-columns: 1fr; } }
    </style>
  </head>
  <body>
    <div class="manage-container">
        <header class="page-header">
          <h1>
            <svg class="heroicon heroicon-lg heroicon-solar-yellow" viewBox="0 0 24 24" fill="currentColor"><path d="M11.7 2.37a.75.75 0 01.6 0l8.25 3.75a.75.75 0 010 1.36L12.3 11.23a.75.75 0 01-.6 0L3.45 7.48a.75.75 0 010-1.36L11.7 2.37z"/><path d="M4.5 12.75v3.38a.75.75 0 00.44.68l6.75 3.05a.75.75 0 00.62 0l6.75-3.05a.75.75 0 00.44-.68v-3.38l-6.59 2.99a2.25 2.25 0 01-1.92 0L4.5 12.75z"/></svg>
            Manage Grades & Streams
          </h1>
          <p class="page-subtitle">Organize your school's academic structure with grades and class streams</p>
          <div class="nav-links">
            <a href="{{ url_for('classteacher.teacher_management_hub') }}">
              <svg class="heroicon heroicon-solar-blue" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M3.375 4.5A2.625 2.625 0 016 1.875h12A2.625 2.625 0 0120.625 4.5v12A2.625 2.625 0 0118 19.125H6A2.625 2.625 0 013.375 16.5v-12zM6 3.375a1.125 1.125 0 00-1.125 1.125v12c0 .621.504 1.125 1.125 1.125h12c.621 0 1.125-.504 1.125-1.125v-12A1.125 1.125 0 0018 3.375H6z" clip-rule="evenodd"/></svg>
              Teacher Hub
            </a>
            <a href="{{ url_for('classteacher.dashboard') }}">
              <svg class="heroicon heroicon-solar-green" viewBox="0 0 24 24" fill="currentColor"><path d="M3 13.5A1.5 1.5 0 014.5 12h15a1.5 1.5 0 010 3h-15A1.5 1.5 0 013 13.5zM3 7.5A1.5 1.5 0 014.5 6h15a1.5 1.5 0 010 3h-15A1.5 1.5 0 013 7.5zM3 19.5A1.5 1.5 0 014.5 18h9a1.5 1.5 0 010 3h-9A1.5 1.5 0 013 19.5z"/></svg>
              Dashboard
            </a>
            <a href="{{ url_for('auth.logout_route') }}">
              <svg class="heroicon heroicon-solar-red" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M3.75 5.25A2.25 2.25 0 016 3h6a2.25 2.25 0 012.25 2.25v2.378a.75.75 0 01-1.5 0V5.25a.75.75 0 00-.75-.75H6a.75.75 0 00-.75.75v13.5c0 .414.336.75.75.75h6a.75.75 0 00.75-.75v-2.378a.75.75 0 011.5 0v2.378A2.25 2.25 0 0112 21H6a2.25 2.25 0 01-2.25-2.25V5.25z" clip-rule="evenodd"/><path fill-rule="evenodd" d="M14.47 15.28a.75.75 0 001.06 0l3-3a.75.75 0 000-1.06l-3-3a.75.75 0 10-1.06 1.06l1.72 1.72H9a.75.75 0 000 1.5h7.19l-1.72 1.72a.75.75 0 000 1.06z" clip-rule="evenodd"/></svg>
              Logout
            </a>
          </div>
        </header>

        <!-- Message container for notifications -->
        <div id="message-container">
          {% if error_message %}
          <div class="message message-error">{{ error_message }}</div>
          {% endif %} {% if success_message %}
          <div class="message message-success">{{ success_message }}</div>
          {% endif %}
        </div>

        <div class="forms-grid">
          <!-- Add Grade Form -->
          <div class="form-card">
            <h2>
              <svg class="heroicon heroicon-solar-yellow" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4.5a1.5 1.5 0 011.5 1.5V9h3a1.5 1.5 0 010 3h-3v3a1.5 1.5 0 01-3 0v-3H6a1.5 1.5 0 010-3h3V6A1.5 1.5 0 0112 4.5z"/></svg>
              Add New Grade
            </h2>
            <form
              method="POST"
              action="{{ url_for('classteacher.manage_grades_streams') }}"
            >
              <input
                type="hidden"
                name="csrf_token"
                value="{{ csrf_token() }}"
              />
              <div class="form-group">
                <label for="grade_level">Grade Level (e.g., 1, 2, ...):</label>
                <input
                  type="text"
                  name="grade_level"
                  id="grade_level"
                  class="form-control"
                  required
                />
              </div>

              <button type="submit" name="add_grade" class="manage-btn">
                <svg class="heroicon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4.5a1.5 1.5 0 011.5 1.5V9h3a1.5 1.5 0 010 3h-3v3a1.5 1.5 0 01-3 0v-3H6a1.5 1.5 0 010-3h3V6A1.5 1.5 0 0112 4.5z"/></svg>
                Add Grade
              </button>
            </form>

            <div class="form-divider"></div>

            <h2>
              <svg class="heroicon heroicon-solar-blue" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4.5a1.5 1.5 0 011.5 1.5V9h3a1.5 1.5 0 010 3h-3v3a1.5 1.5 0 01-3 0v-3H6a1.5 1.5 0 010-3h3V6A1.5 1.5 0 0112 4.5z"/></svg>
              Add New Stream
            </h2>
            <form
              method="POST"
              action="{{ url_for('classteacher.manage_grades_streams') }}"
            >
              <input
                type="hidden"
                name="csrf_token"
                value="{{ csrf_token() }}"
              />
              <div class="form-group">
                <label for="stream_name">Stream Name (e.g., B, G, Y):</label>
                <input
                  type="text"
                  name="stream_name"
                  id="stream_name"
                  class="form-control"
                  required
                />
              </div>

              <div class="form-group">
                <label for="grade_id">Grade:</label>
                <select
                  name="grade_id"
                  id="grade_id"
                  class="form-control"
                  required
                >
                  <option value="">Select Grade</option>
                  {% for grade in grades %}
                  <option value="{{ grade.id }}">{{ grade.name }}</option>
                  {% endfor %}
                </select>
              </div>

              <button type="submit" name="add_stream" class="manage-btn">
                <svg class="heroicon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 4.5a1.5 1.5 0 011.5 1.5V9h3a1.5 1.5 0 010 3h-3v3a1.5 1.5 0 01-3 0v-3H6a1.5 1.5 0 010-3h3V6A1.5 1.5 0 0112 4.5z"/></svg>
                Add Stream
              </button>
            </form>
          </div>

          <!-- Tips section -->
          <div class="form-card">
            <h2>
              <svg class="heroicon heroicon-solar-green" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.25a9.75 9.75 0 100 19.5 9.75 9.75 0 000-19.5zM12 7.5a.75.75 0 01.75.75v3a.75.75 0 01-1.5 0v-3A.75.75 0 0112 7.5zm0 7.5a1.125 1.125 0 100 2.25 1.125 1.125 0 000-2.25z"/></svg>
              Grade & Stream Management Tips
            </h2>
            <div class="tips-content">
              <p>Important guidelines for managing grades and streams:</p>
              <ul>
                <li>
                  Use consistent naming conventions for grades (numbers 1-8)
                </li>
                <li>
                  Use single letter designations for streams (B, G, Y, etc.)
                </li>
                <li>
                  Before deleting a grade, ensure it has no associated streams
                </li>
                <li>
                  Before deleting a stream, make sure no teachers or students
                  are assigned to it
                </li>
                <li>
                  Grade deletions will cascade and remove all associated streams
                </li>
                <li>
                  Setting up proper grade and stream structure is essential for
                  school organization
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Grades and Streams Table -->
        <div class="students-section">
          <h2>
            <svg class="heroicon heroicon-solar-yellow" viewBox="0 0 24 24" fill="currentColor"><path d="M3.75 6A2.25 2.25 0 016 3.75h8.25A2.25 2.25 0 0116.5 6v.75h.75A2.25 2.25 0 0119.5 9v7.5A2.25 2.25 0 0117.25 18H6A2.25 2.25 0 013.75 15.75V6z"/></svg>
            Existing Grades and Streams
          </h2>
          <div id="student-filter">
            <label for="grade-search" style="display:flex; align-items:center; gap:6px;">
              <svg class="heroicon" viewBox="0 0 24 24" fill="currentColor"><path d="M21 21l-3.5-3.5M10.5 18a7.5 7.5 0 100-15 7.5 7.5 0 000 15z"/></svg>
              Search grades:
            </label>
            <input
              type="text"
              id="grade-search"
              onkeyup="searchGrades()"
              placeholder="Type to search..."
            />
          </div>

          <div class="table-responsive">
            <table id="grades-table">
              <thead>
                <tr>
                  <th>Grade ID</th>
                  <th>Grade Level</th>
                  <th>Streams</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for grade in grades %}
                <tr>
                  <td>{{ grade.id }}</td>
                  <td>{{ grade.name }}</td>
                  <td class="streams-cell">
                    {% if grade.streams %}
                    <div class="streams-list">
                      {% for stream in grade.streams %}
                      <div class="stream-item">
                        <span class="stream-name">{{ stream.name }}</span>
                        <span class="stream-id">(ID: {{ stream.id }})</span>
                        <form method="POST" action="{{ url_for('classteacher.manage_grades_streams') }}" class="inline-form">
                          <input
                            type="hidden"
                            name="csrf_token"
                            value="{{ csrf_token() }}"
                          />
                          <input
                            type="hidden"
                            name="stream_id"
                            value="{{ stream.id }}"
                          />
                          <button type="submit" name="delete_stream" class="delete-btn sm">
                            <svg class="heroicon" viewBox="0 0 24 24" fill="currentColor"><path d="M9 3.75A1.75 1.75 0 0110.75 2h2.5A1.75 1.75 0 0115 3.75V5h4.25a.75.75 0 010 1.5H4.75a.75.75 0 010-1.5H9V3.75z"/><path d="M6.75 7.5h10.5l-.7 12.04a1.75 1.75 0 01-1.74 1.71H9.19a1.75 1.75 0 01-1.74-1.71L6.75 7.5z"/></svg>
                            Delete
                          </button>
                        </form>
                      </div>
                      {% endfor %}
                    </div>
                    {% else %}
                    <span class="no-streams">No streams added</span>
                    {% endif %}
                  </td>
                  <td>
                    <form
                      method="POST"
                      action="{{ url_for('classteacher.manage_grades_streams') }}"
                    >
                      <input
                        type="hidden"
                        name="csrf_token"
                        value="{{ csrf_token() }}"
                      />
                      <input
                        type="hidden"
                        name="grade_id"
                        value="{{ grade.id }}"
                      />
                      <button
                        type="submit"
                        name="delete_grade"
                        class="delete-btn"
                      >
                        Delete Grade
                      </button>
                    </form>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Function to search grades by level
      function searchGrades() {
        const searchValue = document
          .getElementById("grade-search")
          .value.toLowerCase();
        const rows = document.querySelectorAll("#grades-table tbody tr");

        rows.forEach((row) => {
          const gradeLevel = row.cells[1].textContent.toLowerCase();
          if (gradeLevel.includes(searchValue)) {
            row.style.display = "";
          } else {
            row.style.display = "none";
          }
        });
      }

      // Function to auto-hide messages after 5 seconds
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(function () {
          const messages = document.querySelectorAll(".message");
          messages.forEach((message) => {
            message.style.display = "none";
          });
        }, 5000);
      });
    </script>
  </body>
</html>
